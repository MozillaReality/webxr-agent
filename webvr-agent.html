<!doctype html>
<html lang="en">
  <head>
    <title>WebVR Agent</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000">
    <style>
      * {
        border-box: box-sizing;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        background: #000;
      }
    </style>
    <script>
      (function () {
        window.addEventListener('message', function (msg) {
          console.log('[webvr-agent.html]: received message:', msg);
          if (msg.data) {
            if (msg.data.type === 'autopresent') {
              autopresent = true;
            }
          }
        });

        function presentToDisplays (displays) {
          var wasPresenting = getPersistedDisplays();
          if (displays.length) {
            displays[0].requestPresent([{source: canvas}]);
          }
          try {
            document.documentElement.requestFullscreen();
          } catch (err) {
            console.warn(err);
          }
        }

        function requestPresent (canvas, scene) {
          if (scene) {
            scene.enterVR();
            return;
          }
          if (canvas) {
            if (navigator.vr && navigator.vr.getDisplays) {
              navigator.vr.getDisplays().then(presentToDisplays);
            } else if (navigator.getVRDisplays) {
              navigator.vr.getVRDisplays().then(persistDisplays);
            }
          }
        }

        window.addEventListener('load', function () {
          var scene = document.querySelector('a-scene');
          if (scene) {
            if (scene.hasLoaded) {
              requestPresent(scene.canvas, scene);
            } else {
              scene.addEventListener('loaded', function () {
                requestPresent(scene.canvas, scene);
              });
            }
          } else {
            requestPresent(document.querySelector('canvas'));
          }
          requestPresent();
        });

        function getPersistedDisplays () {
          try {
            return window.localStorage.wasPresenting === 'true';
          } catch (e) {}
          return false;
        }

        function persistDisplays () {
          try {
            window.localStorage.wasPresenting = true;
          } catch (e) {}
        }

        window.addEventListener('beforeunload', function () {
          if (navigator.vr && navigator.vr.getDisplays) {
            navigator.vr.getDisplays().then(persistDisplays);
          } else if (navigator.getVRDisplays) {
            navigator.vr.getVRDisplays().then(persistDisplays);
          }
          try {
            window.localStorage.wasPresenting = true;
          } catch (e) {}
        });
      })();
    </script>
  </head>
  <body>
  </body>
</html>
