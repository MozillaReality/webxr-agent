/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 5);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

eval("// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3Byb2Nlc3MvYnJvd3Nlci5qcz84MmU0Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLFVBQVUiLCJmaWxlIjoiMC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxudmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9O1xuXG4vLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXRcbi8vIGRvbid0IGJyZWFrIHRoaW5ncy4gIEJ1dCB3ZSBuZWVkIHRvIHdyYXAgaXQgaW4gYSB0cnkgY2F0Y2ggaW4gY2FzZSBpdCBpc1xuLy8gd3JhcHBlZCBpbiBzdHJpY3QgbW9kZSBjb2RlIHdoaWNoIGRvZXNuJ3QgZGVmaW5lIGFueSBnbG9iYWxzLiAgSXQncyBpbnNpZGUgYVxuLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy5cblxudmFyIGNhY2hlZFNldFRpbWVvdXQ7XG52YXIgY2FjaGVkQ2xlYXJUaW1lb3V0O1xuXG5mdW5jdGlvbiBkZWZhdWx0U2V0VGltb3V0KCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuZnVuY3Rpb24gZGVmYXVsdENsZWFyVGltZW91dCAoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTtcbn1cbihmdW5jdGlvbiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXRUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGVhclRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgfVxufSAoKSlcbmZ1bmN0aW9uIHJ1blRpbWVvdXQoZnVuKSB7XG4gICAgaWYgKGNhY2hlZFNldFRpbWVvdXQgPT09IHNldFRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIC8vIGlmIHNldFRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkXG4gICAgaWYgKChjYWNoZWRTZXRUaW1lb3V0ID09PSBkZWZhdWx0U2V0VGltb3V0IHx8ICFjYWNoZWRTZXRUaW1lb3V0KSAmJiBzZXRUaW1lb3V0KSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzXG4gICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfSBjYXRjaChlKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbChudWxsLCBmdW4sIDApO1xuICAgICAgICB9IGNhdGNoKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3JcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG59XG5mdW5jdGlvbiBydW5DbGVhclRpbWVvdXQobWFya2VyKSB7XG4gICAgaWYgKGNhY2hlZENsZWFyVGltZW91dCA9PT0gY2xlYXJUaW1lb3V0KSB7XG4gICAgICAgIC8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9uc1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIC8vIGlmIGNsZWFyVGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKG51bGwsIG1hcmtlcik7XG4gICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IuXG4gICAgICAgICAgICAvLyBTb21lIHZlcnNpb25zIG9mIEkuRS4gaGF2ZSBkaWZmZXJlbnQgcnVsZXMgZm9yIGNsZWFyVGltZW91dCB2cyBzZXRUaW1lb3V0XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwodGhpcywgbWFya2VyKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbn1cbnZhciBxdWV1ZSA9IFtdO1xudmFyIGRyYWluaW5nID0gZmFsc2U7XG52YXIgY3VycmVudFF1ZXVlO1xudmFyIHF1ZXVlSW5kZXggPSAtMTtcblxuZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgfVxuICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgZHJhaW5RdWV1ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGltZW91dCA9IHJ1blRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcbiAgICBkcmFpbmluZyA9IHRydWU7XG5cbiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIHdoaWxlKGxlbikge1xuICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTtcbiAgICAgICAgcXVldWUgPSBbXTtcbiAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRRdWV1ZSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB9XG4gICAgY3VycmVudFF1ZXVlID0gbnVsbDtcbiAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgIHJ1bkNsZWFyVGltZW91dCh0aW1lb3V0KTtcbn1cblxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7XG4gICAgICAgIHJ1blRpbWVvdXQoZHJhaW5RdWV1ZSk7XG4gICAgfVxufTtcblxuLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0c1xuZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7XG4gICAgdGhpcy5mdW4gPSBmdW47XG4gICAgdGhpcy5hcnJheSA9IGFycmF5O1xufVxuSXRlbS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpO1xufTtcbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xucHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5wcm9jZXNzLnZlcnNpb25zID0ge307XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5wcm9jZXNzLm9uID0gbm9vcDtcbnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5vbmNlID0gbm9vcDtcbnByb2Nlc3Mub2ZmID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xucHJvY2Vzcy5lbWl0ID0gbm9vcDtcblxucHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG5wcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJyB9O1xucHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcbnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vcHJvY2Vzcy9icm93c2VyLmpzXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(process) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/* global define, exports, module, process, require */\n\nvar SCENE_ORIGIN = window.location.origin || (window.location.protocol + '//' + window.location.host);\nvar ORIGIN = '';\ntry {\n  ORIGIN = new URL(document.currentScript.src).origin;\n} catch (e) {\n  ORIGIN = SCENE_ORIGIN;\n}\nvar WEBVR_AGENT_ORIGIN = window.location.protocol + '//' + window.location.hostname + ':4040';\nvar WEBVR_AGENT_ORIGIN_PROD = 'https://agent.webvr.rocks';\nvar IS_PROD = process.env.NODE_ENV === 'production';\n\n/* Adapted from source: https://github.com/jonathantneal/document-promises/blob/master/document-promises.es6 */\nvar doc = {};\ndoc.loaded = new Promise(function (resolve) {\n  var listener = function () {\n    if (document.readyState === 'complete') {\n      document.removeEventListener('readystatechange', listener);\n      resolve();\n    }\n  };\n  document.addEventListener('readystatechange', listener);\n  listener();\n});\ndoc.parsed = new Promise(function (resolve) {\n  var listener = function () {\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      document.removeEventListener('readystatechange', listener);\n      resolve();\n    }\n  };\n  document.addEventListener('readystatechange', listener);\n  listener();\n});\ndoc.contentLoaded = new Promise(function (resolve) {\n  var listener = function () {\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      document.removeEventListener('DOMContentLoaded', listener);\n      resolve();\n    }\n  };\n  document.addEventListener('DOMContentLoaded', listener);\n  listener();\n});\ndoc.tryUntilFound = function (functionToCall) {\n  return doc.parsed.then(function () {\n    var done = functionToCall();\n    if (!done) {\n      return doc.contentLoaded.then(functionToCall);\n    }\n  }).then(function (done) {\n    if (!done) {\n      return doc.loaded.then(functionToCall);\n    }\n  });\n};\n\nfunction xhrJSON (opts) {\n  if (typeof opts === 'string') {\n    opts = {url: opts};\n  }\n  opts = opts || {};\n  opts.method = opts.method || 'get';\n  if (typeof opts.data === 'object') {\n    opts.data = JSON.stringify(opts.data);\n  }\n  return new Promise(function (resolve, reject) {\n    var xhr = new XMLHttpRequest();\n    xhr.open(opts.method, opts.url, 'true');\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.addEventListener('load', function () {\n      var data = {};\n      try {\n        // NOTE: Not parsing as JSON using `XMLHttpRequest#responseType` because of incomplete browser support.\n        data = JSON.parse(xhr.responseText || '{}');\n      } catch (e) {\n      }\n      resolve(data);\n    });\n    xhr.addEventListener('error', reject);\n    xhr.send(opts.data);\n  });\n}\n\nfunction setCSSHotspotEl (hotspotEl, opts) {\n  hotspotEl.style.cssText = `height: 61px; width: ${opts.width}; position: absolute; bottom: 0; left: ${opts.left}; right: ${opts.right}; z-index: 999999; cursor: pointer;`;\n}\n\n\n// Adapted from source: https://gist.github.com/mudge/5830382\nfunction EventEmitter () {\n  this.events = {};\n}\nEventEmitter.prototype.on = function (event, listener) {\n  if (typeof this.events[event] !== 'object') {\n    this.events[event] = [];\n  }\n\n  this.events[event].push(listener);\n};\nEventEmitter.prototype.removeListener = function (event, listener) {\n  var idx;\n\n  if (typeof this.events[event] === 'object') {\n    idx = this.events[event].indexOf(listener);\n\n    if (idx > -1) {\n      this.events[event].splice(idx, 1);\n    }\n  }\n};\nEventEmitter.prototype.emit = function (event) {\n  var i;\n  var listeners;\n  var length;\n  var args = Array.prototype.slice.call(arguments, 1);\n\n  if (typeof this.events[event] === 'object') {\n    listeners = this.events[event].slice();\n    length = listeners.length;\n\n    for (i = 0; i < length; i++) {\n      listeners[i].apply(this, args);\n    }\n  }\n};\nEventEmitter.prototype.once = function (event, listener) {\n  this.on(event, function g () {\n    this.removeListener(event, g);\n    listener.apply(this, arguments);\n  });\n};\n\nfunction WebvrAgent (opts) {\n  var self = this;\n  this._inited = false;\n  this._injected = false;\n  this._displayListenersSet = false;\n  this.opts = opts || {};\n  this.timeout = 'timeout' in this.opts ? this.opts.timeout : 0;\n  this.originHost = this.opts.originHost = (this.opts.originHost || ORIGIN || WEBVR_AGENT_ORIGIN || WEBVR_AGENT_ORIGIN_PROD).replace(/\\/+$/g, '');\n  this.uriHost = this.opts.uriHost = this.opts.uriHost || (this.originHost + '/index.html');\n  this.debug = this.opts.debug = 'debug' in this.opts ? !!this.opts.debug : !IS_PROD;\n  this.iframeTimeout = 'optsTimeout' in this.opts ? this.opts.iframeTimeout : 30000;  // Timeout for loading `<iframe>` (time in milliseconds [default: 30 seconds]).\n\n  // TODO: Keep track of multiple displays for the following:\n  // - `connectedDisplay`,\n  // - `disconnectedDisplay`,\n  // - `presentingDisplays`, and\n  // - `notPresentingDisplay`.\n  this.connectedDisplay = null;\n  this.disconnectedDisplay = null;\n  this.presentingDisplay = null;\n  this.notPresentingDisplay = null;\n\n  this.headsets = {\n    htc_vive: {\n      name: 'HTC Vive',\n      slug: 'htc_vive'\n    },\n    oculus_rift: {\n      name: 'Oculus Rift',\n      slug: 'oculus_rift'\n    },\n    google_daydream: {\n      name: 'Google Daydream',\n      slug: 'google_daydream'\n    },\n    samsung_gear_vr: {\n      name: 'Samsung Gear VR',\n      slug: 'samsung_gear_vr'\n    },\n    google_cardboard: {\n      name: 'Google Cardboard',\n      slug: 'google_cardboard'\n    },\n    osvr_hdk2: {\n      name: 'OSVR HDK2',\n      slug: 'osvr_hdk2'\n    }\n  };\n\n  this.gamepads = __webpack_require__(4);\n\n  console.log('gamepads', this.gamepads);\n\n  this.keys = {\n    esc: 27,\n    i: 73,\n    c: 67,\n    f: 70,\n    v: 86\n  };\n\n  this.iframeLoaded = new Promise(function (resolve, reject) {\n    var listener = function (evt) {\n      if (evt.source === window) {\n        return;\n      }\n      var data = evt.data;\n      if (data.src !== 'webvr-agent') {\n        return;\n      }\n      if (data.action === 'loaded') {\n        console.log('[webvr-agent][client] Successfully finished loading iframe: %s', evt.data.url);\n        self.hasLoadedIframe = true;\n        self.postMessage({action: 'loaded'});\n        window.removeEventListener('message', listener);\n        resolve(self.iframe);\n      }\n    };\n    window.addEventListener('message', listener);\n    setTimeout(function () {\n      window.removeEventListener('message', listener);\n      reject(new Error('Message-proxy iframe could not be load'));\n    }, self.iframeTimeout);\n  });\n\n  EventEmitter.call(this);\n}\nObject.create(WebvrAgent, EventEmitter);\nWebvrAgent.prototype.init = function () {\n  if (this._inited) {\n    this._inited = true;\n    return this.inject();\n  }\n};\nWebvrAgent.prototype.url = function (key, params) {\n  // TODO: Construct query-string from the `params` object.\n  var url = this.originHost + '/' + (key || '').replace(/^\\/*/g, '');\n  params = params || {};\n  if (key === 'manifest') {\n    if (params.url) {\n      return url + '/manifest?url=' + params.url;\n    }\n  }\n  return url;\n};\nWebvrAgent.prototype.attemptRequestPresentUponNavigation = function () {\n  if (navigator.doNotTrack === '1' || navigator.doNotTrack === 1) {\n    return Promise.resolve(false);\n  }\n\n  var self = this;\n  return new Promise(function (resolve) {\n    // Polyfill behaviour of `navigator.vr`'s `navigate` event.\n    xhrJSON({\n      method: 'get',\n      url: self.url('sessions')\n    }).then(function (displayId) {\n      if (displayId) {\n        return self.getConnectedDisplay(displayId).then(function (display) {\n          console.log('[webvr-agent][client] Automatically presenting to VR display \"%s\" (id: %s)',\n            self.getDisplayName(display), self.getDisplayId(display));\n          resolve(self.requestPresent(display));\n        });\n      } else {\n        return resolve(null);\n      }\n    }).catch(function (err) {\n      if (err) {\n        console.warn(err);\n      }\n      return resolve(null);\n    });\n  });\n};\nWebvrAgent.prototype.ready = function () {\n  return Promise.all([\n    // this.getConnectedDisplay(),  // NOTE: Workaround for Firefox Nightly to engage VR mode.\n    this.attemptRequestPresentUponNavigation(),\n    this.addUIAndEventListeners(),\n    this.inject()\n  ]);\n};\nWebvrAgent.prototype.postMessage = function (msg) {\n  var self = this;\n  if (typeof msg !== 'object') {\n    throw new Error('`msg` must be an object for calls to `WebvrAgent#postMessage`');\n  }\n  return self.iframeLoaded.then(function () {\n    if (!self.iframe) {\n      return Promise.reject(new Error('Message-proxy iframe not found'));\n    }\n    Object.assign(msg, {src: 'webvr-agent'});\n    self.iframe.contentWindow.postMessage(msg, self.originHost);\n    return Promise.resolve(true);\n  });\n};\nWebvrAgent.prototype.addUIAndEventListeners = function () {\n  var self = this;\n  var toggleVRButtonDimensions = {};\n  var hotspotEl = document.querySelector('#webvr-agent-hotspot');\n  if (!hotspotEl) {\n    hotspotEl = document.createElement('div');\n    hotspotEl.setAttribute('id', 'webvr-agent-hotspot');\n    setCSSHotspotEl(hotspotEl, {width: 0, left: 0, right: 0});\n    document.body.appendChild(hotspotEl);\n  }\n\n  window.addEventListener('message', function (evt) {\n    var data = evt.data;\n    var action = data.action;\n    var src = data.src;\n    if (src !== 'webvr-agent') {\n      return;\n    }\n    if (action === 'resize-iframe') {\n      webvrAgent.iframe.style.height = data.height;\n      console.log('[webvr-agent][client] Resized iframe to %s', data.height);\n    } else if (action === 'display-request-present') {\n      webvrAgent.requestPresent(data.displayId);\n    } else if (action === 'display-exit-present') {\n      webvrAgent.exitPresent(data.displayId);\n    } else if (action === 'resize-toggle-vr-button') {\n      toggleVRButtonDimensions = data.dimensions || {};\n      setCSSHotspotEl(hotspotEl, toggleVRButtonDimensions);\n    }\n  });\n\n  window.addEventListener('mouseover', function (evt) {\n    // Send a message to the `host`, which synthesises a `:hover`-like event.\n    if (evt.target === document.querySelector('#webvr-agent-hotspot') ||\n        (evt.target.closest && evt.target.closest('#webvr-agent-hotspot'))) {\n      self.postMessage({action: 'mouseenter-toggle-vr-button'});\n      return;\n    }\n  });\n\n  window.addEventListener('mouseout', function (evt) {\n    // Send a message to the `host`, which removes the `:hover`-like event.\n    if (evt.target === document.querySelector('#webvr-agent-hotspot') ||\n        (evt.target.closest && evt.target.closest('#webvr-agent-hotspot'))) {\n      self.postMessage({action: 'mouseleave-toggle-vr-button'});\n      return;\n    }\n  });\n\n  window.addEventListener('click', function (evt) {\n    // Workaround for user-gesture requirement to enter VR.\n    if (evt.target === document.querySelector('#webvr-agent-hotspot') ||\n        (evt.target.closest && evt.target.closest('#webvr-agent-hotspot'))) {\n      webvrAgent.requestPresent();\n      return;\n    }\n\n    if (self.isDisplayPresenting(self.connectedDisplay)) {\n      return;\n    }\n    self.postMessage({action: 'close-info'});\n  });\n\n  window.addEventListener('keyup', function (evt) {\n    if (evt.target !== document.body || (evt.shiftKey || evt.metaKey || evt.altKey || evt.ctrlKey)) {\n      return;\n    }\n    if (evt.keyCode === self.keys.esc) {\n      console.log('[webvr-agent][client] `Esc` key pressed');\n      if (self.isDisplayPresenting(self.connectedDisplay)) {\n        self.postMessage({action: 'display-exit-present'});\n      } else {\n        self.postMessage({action: 'close-info'});\n      }\n    } else if (evt.keyCode === self.keys.i) {\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `i` key pressed');\n      if (!self.isDisplayPresenting(self.connectedDisplay)) {\n        self.postMessage({action: 'toggle-info'});\n      }\n    } else if (evt.keyCode === self.keys.c) {\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `c` key pressed');\n      if (self.isDisplayPresenting(self.connectedDisplay)) {\n        self.postMessage({action: 'display-exit-present'});\n      } else {\n        self.postMessage({action: 'close-info'});\n      }\n    } else if (evt.keyCode === self.keys.v) {\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `v` key pressed');\n      if (self.isDisplayPresenting(self.connectedDisplay)) {\n        self.exitPresent();\n      } else {\n        self.requestPresent();\n      }\n    } else if (evt.keyCode === self.keys.f) {\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `f` key pressed');\n      if (self.isDisplayPresenting(self.connectedDisplay)) {\n        self.exitPresent();\n      } else {\n        self.requestPresent();\n      }\n    }\n  });\n\n  // TODO: Handle three.js scenes with `THREE.VREffect`.\n  var setupFunctions = [\n    aframeSceneSetup\n  ];\n\n  setupFunctions.forEach(doc.tryUntilFound);\n\n  function aframeSceneSetup () {\n    var aframeScene = document.querySelector('a-scene');\n    if (!aframeScene) {\n      return;\n    }\n    if (aframeScene.hasLoaded) {\n      aframeHideVRModeUI();\n    } else {\n      aframeScene.addEventListener('loaded', aframeHideVRModeUI);\n    }\n    function aframeHideVRModeUI () {\n      aframeScene.setAttribute('vr-mode-ui', 'enabled: false');\n    }\n    return aframeScene;\n  }\n};\nWebvrAgent.prototype.inject = function () {\n  var self = this;\n  return new Promise(function (resolve, reject) {\n    if (self._injected) {\n      resolve(false);\n      return;\n    }\n    self._injected = true;\n    console.log('[webvr-agent][client] Injecting `<iframe>` for \"%s\"', self.uriHost);\n    var iframe = self.iframe = document.createElement('iframe');\n    iframe.src = self.uriHost + '?url=' + window.location.href;\n    iframe.style.cssText = 'border-width: 0; height: 61px; width: 100%; position: absolute; bottom: 0; right: 0; left: 0; z-index: 99999';\n    iframe.addEventListener('load', function () {\n      // if (self._injected) {\n      //   reject(new Error('Already loaded iframe'));\n      //   return;\n      // }\n      resolve(true);\n      console.log('[webvr-agent][client] Injected `<iframe>` for \"%s\"', self.uriHost);\n    });\n    iframe.addEventListener('error', function (err) {\n      reject(err);\n      console.warn('[webvr-agent][client] Could not load:', err);\n    });\n    doc.tryUntilFound(function () {\n      if (!document.body) {\n        return;\n      }\n      document.body.appendChild(iframe);\n    });\n  });\n};\nWebvrAgent.prototype.requestPresent = function (display, canvas) {\n  var self = this;\n  return doc.loaded.then(function () {\n    return self.getConnectedDisplay(display ? display.id : null, display).then(function (display) {\n      if (!display) {\n        throw new Error('No VR headset detected');\n      }\n\n      // TODO: Handle three.js scenes with `THREE.VREffect`.\n      var aframeScene = canvas && canvas.matches && canvas.matches('a-scene') ? canvas : document.querySelector('a-scene');\n      canvas = canvas || document.querySelector('canvas');\n\n      if (!canvas) {\n        throw new Error('Canvas source empty');\n      }\n\n      if (self.isDisplayPresenting(display)) {\n        throw new Error('VR headset is presenting');\n      }\n\n      if (aframeScene) {\n        if (aframeScene.hasLoaded) {\n          return aframeScene.enterVR().then(function (x) {\n            return display;\n          });\n        } else {\n          aframeScene.addEventListener('loaded', function () {\n            return aframeScene.enterVR().then(function () {\n              return display;\n            });\n          });\n        }\n      }\n\n      return display.requestPresent([{source: canvas}]).then(function () {\n        return display;\n      });\n    }).then(function (display) {\n      var isConnected = self.isDisplayConnected(display);\n      var isDisconnected = !isConnected;\n      var isPresenting = self.isDisplayPresenting(display);\n      return self.postMessage({\n        action: 'display-present-start',\n        displayId: self.getDisplayId(display),\n        displayName: self.getDisplayName(display),\n        displaySlug: self.getDisplaySlug(display),\n        isConnected: isConnected,\n        isDisconnected: isDisconnected,\n        isPresenting: isPresenting\n      });\n    }).catch(function (err) {\n      console.error('[webvr-agent][client] Failed to enter VR presentation' +\n        (err && err.message ? ': ' + err.message : ''),\n        err.stack);\n    });\n  });\n};\nWebvrAgent.prototype.exitPresent = function (display, canvas) {\n  var self = this;\n  return doc.loaded.then(function () {\n    return self.getConnectedDisplay(display ? display.id : null, display).then(function (display) {\n      if (!display) {\n        throw new Error('No VR headset detected');\n      }\n\n      if (!self.isDisplayPresenting(display)) {\n        throw new Error('VR headset is not presenting');\n      }\n\n      // TODO: Handle three.js scenes with `THREE.VREffect`.\n      var aframeScene = canvas && canvas.matches && canvas.matches('a-scene') ? canvas : document.querySelector('a-scene');\n      canvas = canvas || document.querySelector('canvas');\n\n      // TODO: For non-A-Frame scenes, find the VR display being presented which contains a layer for `canvas`.\n\n      if (aframeScene) {\n        if (aframeScene.hasLoaded) {\n          return aframeScene.exitVR().then(function (x) {\n            return display;\n          });\n        } else {\n          aframeScene.addEventListener('loaded', function () {\n            return aframeScene.exitVR().then(function () {\n              return display;\n            });\n          });\n        }\n      }\n\n      return display.exitPresent().then(function () {\n        return display;\n      }, function (err) {\n        return new Error('Failed to exit VR presentation' +\n          (err && err.message ? ': ' + err.message : ''));\n      });\n    }).then(function (display) {\n      var isConnected = self.isDisplayConnected(display);\n      var isDisconnected = !isConnected;\n      var isPresenting = false;\n      return self.postMessage({\n        action: 'display-present-end',\n        displayId: self.getDisplayId(display),\n        displayName: self.getDisplayName(display),\n        displaySlug: self.getDisplaySlug(display),\n        isConnected: isConnected,\n        isDisconnected: isDisconnected,\n        isPresenting: isPresenting\n      });\n    }).catch(function (err) {\n      console.error('[webvr-agent][client] Failed to exit VR presentation' +\n        (err && err.message ? ': ' + err.message : ''));\n      throw err;\n    });\n  });\n};\nWebvrAgent.prototype.isDisplayConnected = function (display) {\n  if (!display) {\n    return false;\n  }\n  if ('isConnected' in display) {\n    return display.isConnected;\n  }\n  if ('connected' in display) {\n    return display.connected;\n  }\n  return false;\n};\nWebvrAgent.prototype.isDisplayPresenting = function (display) {\n  if (display) {\n    if ('isPresenting' in display) {\n      return display.isPresenting;\n    }\n    if ('presenting' in display) {\n      return display.presenting;\n    }\n  }\n  return false;\n};\nWebvrAgent.prototype.getDisplayId = function (display) {\n  if (display) {\n    if ('displayId' in display) {\n      return String(display.displayId);\n    }\n    if ('id' in display) {\n      return String(display.id);\n    }\n  }\n  return null;\n};\nWebvrAgent.prototype.getDisplayName = function (display) {\n  if (display) {\n    if ('displayName' in display) {\n      return display.displayName;\n    }\n    if ('name' in display) {\n      return display.name;\n    }\n  }\n  return null;\n};\nWebvrAgent.prototype.getDisplaySlug = function (display) {\n  if (display) {\n    var displayName = (this.getDisplayName(display) || '').toLowerCase();\n    if (displayName.indexOf('oculus') > -1) {\n      return this.headsets.oculus_rift.slug;\n    } else if (displayName.indexOf('openvr') > -1 || displayName.indexOf('vive') > -1) {\n      return this.headsets.htc_vive.slug;\n    } else if (displayName.indexOf('gear') > -1) {\n      return this.headsets.samsung_gear_vr.slug;\n    } else if (displayName.indexOf('daydream') > -1) {\n      return this.headsets.google_daydream.slug;\n    } else if (displayName.indexOf('osvr') > -1) {\n      return this.headsets.osvr_hdk2.slug;\n    }\n  }\n  return this.headsets.google_cardboard.slug;\n};\nWebvrAgent.prototype.areDisplaysSame = function (displayA, displayB) {\n  return this.getDisplayId(displayA) === this.getDisplayId(displayB) &&\n         this.getDisplayName(displayA) === this.getDisplayName(displayB);\n};\nWebvrAgent.prototype.setDisconnectedDisplay = function (display) {\n  var self = this;\n\n  if (self.areDisplaysSame(display, self.disconnectedDisplay)) {\n    return;\n  }\n\n  var displayName = self.getDisplayName(display);\n  var displayId = self.getDisplayId(display);\n  var displaySlug = self.getDisplaySlug(display);\n\n  self.iframeLoaded.then(function () {\n    console.log('[webvr-agent][client] Display disconnected: %s (ID: %s; slug: %s)',\n      displayName,\n      displayId,\n      displaySlug);\n\n    self.connectedDisplay = display;\n\n    // TODO: Keep track of multiple `disconnectedDisplay`s.\n    self.disconnectedDisplay = display;\n\n    return Promise.all([\n      self.postMessage({\n        action: 'display-disconnected',\n        displayId: displayId,\n        displayName: displayName,\n        displaySlug: displaySlug,\n        isConnected: false,\n        isDisconnected: true,\n        isPresenting: self.isDisplayPresenting(display)\n      })\n    ]);\n  });\n};\nWebvrAgent.prototype.setPresentingDisplay = function (display) {\n  var self = this;\n\n  if (self.areDisplaysSame(display, self.presentingDisplay)) {\n    return;\n  }\n\n  var displayName = self.getDisplayName(display);\n  var displayId = self.getDisplayId(display);\n  var displaySlug = self.getDisplaySlug(display);\n\n  self.iframeLoaded.then(function () {\n    console.log('[webvr-agent][client] Display presenting: %s (ID: %s; slug: %s)',\n      displayName,\n      displayId,\n      displaySlug);\n\n    self.connectedDisplay = display;\n\n    // TODO: Keep track of multiple `presentingDisplay`s.\n    self.presentingDisplay = display;\n\n    var isConnected = self.isDisplayConnected(display);\n    var isDisconnected = !isConnected;\n    var isPresenting = true;\n\n    return Promise.all([\n      self.postMessage({\n        action: 'display-presenting',\n        displayId: displayId,\n        displayName: displayName,\n        displaySlug: displaySlug,\n        isConnected: isConnected,\n        isDisconnected: isDisconnected,\n        isPresenting: isPresenting\n      }),\n      self.postMessage({\n        action: 'display-present-start',\n        displayId: displayId,\n        displayName: displayName,\n        displaySlug: displaySlug,\n        isConnected: isConnected,\n        isDisconnected: isDisconnected,\n        isPresenting: isPresenting\n      }),\n      self.persistVRDisplayPresentationState(display)\n    ]);\n  });\n};\nWebvrAgent.prototype.setNotPresentingDisplay = function (display) {\n  var self = this;\n\n  if (self.areDisplaysSame(display, self.notPresentingDisplay)) {\n    return;\n  }\n\n  var displayName = self.getDisplayName(display);\n  var displayId = self.getDisplayId(display);\n  var displaySlug = self.getDisplaySlug(display);\n\n  self.iframeLoaded.then(function () {\n    console.log('[webvr-agent][client] Display stopped presenting: %s (ID: %s; slug: %s)',\n      displayName,\n      displayId,\n      displaySlug);\n\n    // self.connectedDisplay = display;\n\n    self.presentingDisplay = null;\n\n    // TODO: Keep track of multiple `notPresentingDisplay`s.\n    self.notPresentingDisplay = display;\n\n    return Promise.all([\n      self.postMessage({\n        action: 'display-present-end',\n        displayId: displayId,\n        displayName: displayName,\n        displaySlug: displaySlug,\n        isConnected: self.isDisplayConnected(display),\n        isDisconnected: !self.isDisplayConnected(display),\n        isPresenting: false\n      }),\n      self.persistVRDisplayPresentationState(display)\n    ]);\n  });\n};\nWebvrAgent.prototype.setConnectedDisplay = function (display) {\n  var self = this;\n\n  if (self.areDisplaysSame(display, self.connectedDisplay)) {\n    return;\n  }\n\n  var displayName = self.getDisplayName(display);\n  var displayId = self.getDisplayId(display);\n  var displaySlug = self.getDisplaySlug(display);\n\n  self.iframeLoaded.then(function () {\n    console.log('[webvr-agent][client] Display connected: %s (ID: %s; slug: %s)',\n      displayName,\n      displayId,\n      displaySlug);\n\n    self.disconnectedDisplay = null;\n\n    // TODO: Keep track of multiple `connectedDisplay`s.\n    self.connectedDisplay = display;\n\n    return Promise.all([\n      self.postMessage({\n        action: 'display-connected',\n        displayId: displayId,\n        displayName: displayName,\n        displaySlug: displaySlug,\n        isConnected: true,\n        isDisconnected: false,\n        isPresenting: self.isDisplayPresenting(display)\n      })\n    ]);\n  });\n\n  return display;\n};\nWebvrAgent.prototype.persistVRDisplayPresentationState = function (display) {\n  if (navigator.doNotTrack === '1' || navigator.doNotTrack === 1) {\n    return Promise.resolve(false);\n  }\n\n  // Polyfill behaviour of `navigator.vr`'s `navigate` event.\n  display = display || this.connectedDisplay;\n\n  // Persist state of VR presentation (for `navigator.vr`'s `navigate` event).\n  return xhrJSON({\n    method: 'post',\n    url: this.url('sessions'),\n    data: {\n      docURL: window.location.href,\n      docTitle: document.title,\n      displayId: this.getDisplayId(display),\n      displayName: this.getDisplayName(display),\n      displaySlug: this.getDisplaySlug(display),\n      isConnected: this.isDisplayConnected(display),\n      isDisconnected: !this.isDisplayConnected(display),\n      isPresenting: this.isDisplayPresenting(display),\n    }\n  }).then(function (data) {\n    console.log('[webvr-agent][client] Persisted state of presenting VR display');\n  }).catch(function (err) {\n    if (err) {\n      console.warn(err);\n    }\n  });\n};\nWebvrAgent.prototype.getConnectedDisplay = function (preferredDisplayId, defaultDisplay) {\n  var self = this;\n\n  if (preferredDisplayId) {\n    preferredDisplayId = String(preferredDisplayId);\n  }\n\n  if (!self._displayListenersSet) {\n    if (navigator.vr) {\n      // For WebVR v1.2 API.\n      navigator.vr.addEventListener('displayconnect', handleVREventDisplayConnect);\n      navigator.vr.addEventListener('displaydisconnect', handleVREventDisplayDisconnect);\n      navigator.vr.addEventListener('navigate', handleVREventNavigate);\n\n      // TODO: For each `VRDisplay` instance, add these event listeners:\n      // - `activate`\n      // - `deactivate`\n      // - `blur`\n      // - `blurred`\n      // - `focus`\n      // - `focused`\n      // - `focussed`\n      // - `presentchange`\n\n      // TODO: Support WebVR v2.0 API.\n    } else if (navigator.getVRDisplays) {\n      // For WebVR v1.1 API.\n      window.addEventListener('vrdisplayconnected', handleVREventDisplayConnect);\n      window.addEventListener('vrdisplayconnect', handleVREventDisplayConnect);\n\n      window.addEventListener('vrdisplaydisconnected', handleVREventDisplayDisconnect);\n      window.addEventListener('vrdisplaydisconnect', handleVREventDisplayDisconnect);\n\n      window.addEventListener('vrdisplayactivate', handleVREventDisplayActivate);\n      window.addEventListener('vrdisplayactivated', handleVREventDisplayActivate);\n\n      window.addEventListener('vrdisplaydeactivate', handleVREventDisplayDeactivate);\n      window.addEventListener('vrdisplaydeactivated', handleVREventDisplayDeactivate);\n\n      window.addEventListener('vrdisplayblur', handleVREventDisplayBlur);\n      window.addEventListener('vrdisplayfocus', handleVREventDisplayFocus);\n\n      window.addEventListener('vrdisplaypresentchange', handleVREventDisplayPresentChange);\n    }\n  }\n\n  self._displayListenersSet = true;\n\n  function handleVREventDisplayConnect (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setConnectedDisplay(evt.display);\n    }\n  }\n\n  function handleVREventDisplayDisconnect (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setDisonnectedDisplay(evt.display);\n    }\n  }\n\n  function handleVREventNavigate (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setConnectedDisplay(evt.display);\n    }\n  }\n\n  function handleVREventDisplayActivate (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setConnectedDisplay(evt.display);\n    }\n    if (evt.reason === 'mount' || evt.reason === 'mounted' ||\n        evt.reason === 'requested' ||\n        evt.reason === 'navigation' ||\n        !evt.reason) {\n      if (self.mountedDisplay !== evt.connectedDisplay) {\n        self.mountedDisplay = evt.display;\n      }\n    }\n  }\n\n  function handleVREventDisplayDeactivate (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setConnectedDisplay(null);\n    }\n    if (evt.reason === 'unmount' || evt.reason === 'unmounted' || !evt.reason) {\n      if (self.mountedDisplay === evt.connectedDisplay) {\n        self.mountedDisplay = null;\n      }\n    }\n  }\n\n  function handleVREventDisplayBlur (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setConnectedDisplay(evt.display);\n    }\n  }\n\n  function handleVREventDisplayFocus (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (evt.display) {\n      self.setConnectedDisplay(evt.display);\n    }\n  }\n\n  function handleVREventDisplayPresentChange (evt) {\n    console.log('[webvr-agent][client] Event \"%s\" received:', evt.type, evt);\n    if (!evt.display) {\n      return;\n    }\n    if (self.isDisplayPresenting(evt.display)) {\n      self.setPresentingDisplay(evt.display);\n    } else {\n      self.setNotPresentingDisplay(evt.display);\n    }\n  }\n\n  return new Promise(function (resolve, reject) {\n    var connectedDisplay = self.connectedDisplay;\n    if (connectedDisplay && self.isDisplayConnected(connectedDisplay)) {\n      resolve(connectedDisplay);\n      return;\n    }\n\n    if (navigator.vr) {\n      return navigator.vr.getDisplays().then(findConnectedDisplays).then(resolve);\n    } else if (navigator.getVRDisplays) {\n      return navigator.getVRDisplays().then(findConnectedDisplays).then(resolve);\n    } else {\n      resolve(defaultDisplay || null);\n      return;\n    }\n\n    function findConnectedDisplays (displays) {\n      displays = displays || [];\n      var displayId;\n      var connectedDisplay = preferredDisplayId ? displays.filter(function (display) {\n        displayId = self.getDisplayId(display);\n        if (displayId && displayId === preferredDisplayId) {\n          return self.isDisplayConnected(display);\n        }\n      })[0] : null;\n      connectedDisplay = connectedDisplay || displays.filter(function (display) {\n        return self.isDisplayConnected(display);\n      })[0] || defaultDisplay || null;\n      self.setConnectedDisplay(connectedDisplay);\n      return connectedDisplay;\n    }\n  });\n};\n\nvar webvrAgent = new WebvrAgent();\n\nwebvrAgent.ready().then(function (result) {\n  var presentingDisplay = result[0];\n  var proxy = result[1];\n\n  console.log('[webvr-agent][client] Agent ready');\n  if (presentingDisplay) {\n    console.log('[webvr-agent][client] Presenting to VR display \"%s\" (id: %s)',\n      webvrAgent.getDisplayName(presentingDisplay),\n      webvrAgent.getDisplayId(presentingDisplay));\n  }\n  if (proxy) {\n    console.log('[webvr-agent][client] Message-proxy (%s) ready', proxy.name);\n  }\n  console.log('[webvr-agent][client] Using iframe', webvrAgent.iframe);\n\n  if (!presentingDisplay) {\n    webvrAgent.getConnectedDisplay().then(function (connectedDisplay) {\n      console.log('[webvr-agent][client] Found connected VR display: %s (ID: %s; slug: %s)',\n        webvrAgent.getDisplayName(connectedDisplay),\n        webvrAgent.getDisplayId(connectedDisplay),\n        webvrAgent.getDisplaySlug(connectedDisplay));\n    });\n  }\n}).catch(function (err) {\n  console.error('[webvr-agent][client] Error' +\n    (err && err.message ? ': ' + err.message : ''));\n});\n\nif (true) {\n  !(__WEBPACK_AMD_DEFINE_FACTORY__ = (webvrAgent),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :\n\t\t\t\t__WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n} else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {\n  module.exports = webvrAgent;\n} else if (window) {\n  window.webvrAgent = webvrAgent;\n}\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wdWJsaWMvY2xpZW50LmpzPzg2MjQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IitDQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pELE9BQU87QUFDUDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQSwwQ0FBMEMsVUFBVSxZQUFZLG9CQUFvQixXQUFXLFNBQVMsV0FBVyxVQUFVLFlBQVksaUJBQWlCLGlCQUFpQjtBQUMzSzs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxlQUFlLFlBQVk7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRjs7QUFFcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpQkFBaUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1A7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG1CQUFtQjtBQUMzQztBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsNEJBQTRCO0FBQzVEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixzQ0FBc0M7QUFDOUQ7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isc0NBQXNDO0FBQzlEO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixxQkFBcUI7QUFDM0MsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwrQkFBK0I7QUFDekQsT0FBTztBQUNQLDBCQUEwQixxQkFBcUI7QUFDL0M7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHNCQUFzQjtBQUNoRDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsK0JBQStCO0FBQ3pELE9BQU87QUFDUCwwQkFBMEIscUJBQXFCO0FBQy9DO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxjQUFjLGFBQWEsb0JBQW9CLFdBQVcsVUFBVSxTQUFTO0FBQ3pIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsV0FBVztBQUNYO0FBQ0E7O0FBRUEsc0NBQXNDLGVBQWU7QUFDckQ7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsV0FBVztBQUNYO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx3RUFBd0U7QUFDeEU7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEVBQThFO0FBQzlFO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EscUVBQXFFO0FBQ3JFO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnRkFBZ0Y7QUFDaEY7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgZGVmaW5lLCBleHBvcnRzLCBtb2R1bGUsIHByb2Nlc3MsIHJlcXVpcmUgKi9cblxudmFyIFNDRU5FX09SSUdJTiA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gfHwgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCk7XG52YXIgT1JJR0lOID0gJyc7XG50cnkge1xuICBPUklHSU4gPSBuZXcgVVJMKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjKS5vcmlnaW47XG59IGNhdGNoIChlKSB7XG4gIE9SSUdJTiA9IFNDRU5FX09SSUdJTjtcbn1cbnZhciBXRUJWUl9BR0VOVF9PUklHSU4gPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgJzo0MDQwJztcbnZhciBXRUJWUl9BR0VOVF9PUklHSU5fUFJPRCA9ICdodHRwczovL2FnZW50LndlYnZyLnJvY2tzJztcbnZhciBJU19QUk9EID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJztcblxuLyogQWRhcHRlZCBmcm9tIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2pvbmF0aGFudG5lYWwvZG9jdW1lbnQtcHJvbWlzZXMvYmxvYi9tYXN0ZXIvZG9jdW1lbnQtcHJvbWlzZXMuZXM2ICovXG52YXIgZG9jID0ge307XG5kb2MubG9hZGVkID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgbGlzdGVuZXIpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH1cbiAgfTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGxpc3RlbmVyKTtcbiAgbGlzdGVuZXIoKTtcbn0pO1xuZG9jLnBhcnNlZCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJyB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgbGlzdGVuZXIpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH1cbiAgfTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGxpc3RlbmVyKTtcbiAgbGlzdGVuZXIoKTtcbn0pO1xuZG9jLmNvbnRlbnRMb2FkZWQgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdpbnRlcmFjdGl2ZScgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGxpc3RlbmVyKTtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9XG4gIH07XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBsaXN0ZW5lcik7XG4gIGxpc3RlbmVyKCk7XG59KTtcbmRvYy50cnlVbnRpbEZvdW5kID0gZnVuY3Rpb24gKGZ1bmN0aW9uVG9DYWxsKSB7XG4gIHJldHVybiBkb2MucGFyc2VkLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBkb25lID0gZnVuY3Rpb25Ub0NhbGwoKTtcbiAgICBpZiAoIWRvbmUpIHtcbiAgICAgIHJldHVybiBkb2MuY29udGVudExvYWRlZC50aGVuKGZ1bmN0aW9uVG9DYWxsKTtcbiAgICB9XG4gIH0pLnRoZW4oZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBpZiAoIWRvbmUpIHtcbiAgICAgIHJldHVybiBkb2MubG9hZGVkLnRoZW4oZnVuY3Rpb25Ub0NhbGwpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5mdW5jdGlvbiB4aHJKU09OIChvcHRzKSB7XG4gIGlmICh0eXBlb2Ygb3B0cyA9PT0gJ3N0cmluZycpIHtcbiAgICBvcHRzID0ge3VybDogb3B0c307XG4gIH1cbiAgb3B0cyA9IG9wdHMgfHwge307XG4gIG9wdHMubWV0aG9kID0gb3B0cy5tZXRob2QgfHwgJ2dldCc7XG4gIGlmICh0eXBlb2Ygb3B0cy5kYXRhID09PSAnb2JqZWN0Jykge1xuICAgIG9wdHMuZGF0YSA9IEpTT04uc3RyaW5naWZ5KG9wdHMuZGF0YSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgeGhyLm9wZW4ob3B0cy5tZXRob2QsIG9wdHMudXJsLCAndHJ1ZScpO1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIE5PVEU6IE5vdCBwYXJzaW5nIGFzIEpTT04gdXNpbmcgYFhNTEh0dHBSZXF1ZXN0I3Jlc3BvbnNlVHlwZWAgYmVjYXVzZSBvZiBpbmNvbXBsZXRlIGJyb3dzZXIgc3VwcG9ydC5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCB8fCAne30nKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgfSk7XG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgcmVqZWN0KTtcbiAgICB4aHIuc2VuZChvcHRzLmRhdGEpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gc2V0Q1NTSG90c3BvdEVsIChob3RzcG90RWwsIG9wdHMpIHtcbiAgaG90c3BvdEVsLnN0eWxlLmNzc1RleHQgPSBgaGVpZ2h0OiA2MXB4OyB3aWR0aDogJHtvcHRzLndpZHRofTsgcG9zaXRpb246IGFic29sdXRlOyBib3R0b206IDA7IGxlZnQ6ICR7b3B0cy5sZWZ0fTsgcmlnaHQ6ICR7b3B0cy5yaWdodH07IHotaW5kZXg6IDk5OTk5OTsgY3Vyc29yOiBwb2ludGVyO2A7XG59XG5cblxuLy8gQWRhcHRlZCBmcm9tIHNvdXJjZTogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vbXVkZ2UvNTgzMDM4MlxuZnVuY3Rpb24gRXZlbnRFbWl0dGVyICgpIHtcbiAgdGhpcy5ldmVudHMgPSB7fTtcbn1cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gIGlmICh0eXBlb2YgdGhpcy5ldmVudHNbZXZlbnRdICE9PSAnb2JqZWN0Jykge1xuICAgIHRoaXMuZXZlbnRzW2V2ZW50XSA9IFtdO1xuICB9XG5cbiAgdGhpcy5ldmVudHNbZXZlbnRdLnB1c2gobGlzdGVuZXIpO1xufTtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gIHZhciBpZHg7XG5cbiAgaWYgKHR5cGVvZiB0aGlzLmV2ZW50c1tldmVudF0gPT09ICdvYmplY3QnKSB7XG4gICAgaWR4ID0gdGhpcy5ldmVudHNbZXZlbnRdLmluZGV4T2YobGlzdGVuZXIpO1xuXG4gICAgaWYgKGlkeCA+IC0xKSB7XG4gICAgICB0aGlzLmV2ZW50c1tldmVudF0uc3BsaWNlKGlkeCwgMSk7XG4gICAgfVxuICB9XG59O1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHZhciBpO1xuICB2YXIgbGlzdGVuZXJzO1xuICB2YXIgbGVuZ3RoO1xuICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG5cbiAgaWYgKHR5cGVvZiB0aGlzLmV2ZW50c1tldmVudF0gPT09ICdvYmplY3QnKSB7XG4gICAgbGlzdGVuZXJzID0gdGhpcy5ldmVudHNbZXZlbnRdLnNsaWNlKCk7XG4gICAgbGVuZ3RoID0gbGlzdGVuZXJzLmxlbmd0aDtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgbGlzdGVuZXJzW2ldLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cbiAgfVxufTtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIChldmVudCwgbGlzdGVuZXIpIHtcbiAgdGhpcy5vbihldmVudCwgZnVuY3Rpb24gZyAoKSB7XG4gICAgdGhpcy5yZW1vdmVMaXN0ZW5lcihldmVudCwgZyk7XG4gICAgbGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfSk7XG59O1xuXG5mdW5jdGlvbiBXZWJ2ckFnZW50IChvcHRzKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5faW5pdGVkID0gZmFsc2U7XG4gIHRoaXMuX2luamVjdGVkID0gZmFsc2U7XG4gIHRoaXMuX2Rpc3BsYXlMaXN0ZW5lcnNTZXQgPSBmYWxzZTtcbiAgdGhpcy5vcHRzID0gb3B0cyB8fCB7fTtcbiAgdGhpcy50aW1lb3V0ID0gJ3RpbWVvdXQnIGluIHRoaXMub3B0cyA/IHRoaXMub3B0cy50aW1lb3V0IDogMDtcbiAgdGhpcy5vcmlnaW5Ib3N0ID0gdGhpcy5vcHRzLm9yaWdpbkhvc3QgPSAodGhpcy5vcHRzLm9yaWdpbkhvc3QgfHwgT1JJR0lOIHx8IFdFQlZSX0FHRU5UX09SSUdJTiB8fCBXRUJWUl9BR0VOVF9PUklHSU5fUFJPRCkucmVwbGFjZSgvXFwvKyQvZywgJycpO1xuICB0aGlzLnVyaUhvc3QgPSB0aGlzLm9wdHMudXJpSG9zdCA9IHRoaXMub3B0cy51cmlIb3N0IHx8ICh0aGlzLm9yaWdpbkhvc3QgKyAnL2luZGV4Lmh0bWwnKTtcbiAgdGhpcy5kZWJ1ZyA9IHRoaXMub3B0cy5kZWJ1ZyA9ICdkZWJ1ZycgaW4gdGhpcy5vcHRzID8gISF0aGlzLm9wdHMuZGVidWcgOiAhSVNfUFJPRDtcbiAgdGhpcy5pZnJhbWVUaW1lb3V0ID0gJ29wdHNUaW1lb3V0JyBpbiB0aGlzLm9wdHMgPyB0aGlzLm9wdHMuaWZyYW1lVGltZW91dCA6IDMwMDAwOyAgLy8gVGltZW91dCBmb3IgbG9hZGluZyBgPGlmcmFtZT5gICh0aW1lIGluIG1pbGxpc2Vjb25kcyBbZGVmYXVsdDogMzAgc2Vjb25kc10pLlxuXG4gIC8vIFRPRE86IEtlZXAgdHJhY2sgb2YgbXVsdGlwbGUgZGlzcGxheXMgZm9yIHRoZSBmb2xsb3dpbmc6XG4gIC8vIC0gYGNvbm5lY3RlZERpc3BsYXlgLFxuICAvLyAtIGBkaXNjb25uZWN0ZWREaXNwbGF5YCxcbiAgLy8gLSBgcHJlc2VudGluZ0Rpc3BsYXlzYCwgYW5kXG4gIC8vIC0gYG5vdFByZXNlbnRpbmdEaXNwbGF5YC5cbiAgdGhpcy5jb25uZWN0ZWREaXNwbGF5ID0gbnVsbDtcbiAgdGhpcy5kaXNjb25uZWN0ZWREaXNwbGF5ID0gbnVsbDtcbiAgdGhpcy5wcmVzZW50aW5nRGlzcGxheSA9IG51bGw7XG4gIHRoaXMubm90UHJlc2VudGluZ0Rpc3BsYXkgPSBudWxsO1xuXG4gIHRoaXMuaGVhZHNldHMgPSB7XG4gICAgaHRjX3ZpdmU6IHtcbiAgICAgIG5hbWU6ICdIVEMgVml2ZScsXG4gICAgICBzbHVnOiAnaHRjX3ZpdmUnXG4gICAgfSxcbiAgICBvY3VsdXNfcmlmdDoge1xuICAgICAgbmFtZTogJ09jdWx1cyBSaWZ0JyxcbiAgICAgIHNsdWc6ICdvY3VsdXNfcmlmdCdcbiAgICB9LFxuICAgIGdvb2dsZV9kYXlkcmVhbToge1xuICAgICAgbmFtZTogJ0dvb2dsZSBEYXlkcmVhbScsXG4gICAgICBzbHVnOiAnZ29vZ2xlX2RheWRyZWFtJ1xuICAgIH0sXG4gICAgc2Ftc3VuZ19nZWFyX3ZyOiB7XG4gICAgICBuYW1lOiAnU2Ftc3VuZyBHZWFyIFZSJyxcbiAgICAgIHNsdWc6ICdzYW1zdW5nX2dlYXJfdnInXG4gICAgfSxcbiAgICBnb29nbGVfY2FyZGJvYXJkOiB7XG4gICAgICBuYW1lOiAnR29vZ2xlIENhcmRib2FyZCcsXG4gICAgICBzbHVnOiAnZ29vZ2xlX2NhcmRib2FyZCdcbiAgICB9LFxuICAgIG9zdnJfaGRrMjoge1xuICAgICAgbmFtZTogJ09TVlIgSERLMicsXG4gICAgICBzbHVnOiAnb3N2cl9oZGsyJ1xuICAgIH1cbiAgfTtcblxuICB0aGlzLmdhbWVwYWRzID0gcmVxdWlyZSgnLi9saWIvZ2FtZXBhZHMuanMnKTtcblxuICBjb25zb2xlLmxvZygnZ2FtZXBhZHMnLCB0aGlzLmdhbWVwYWRzKTtcblxuICB0aGlzLmtleXMgPSB7XG4gICAgZXNjOiAyNyxcbiAgICBpOiA3MyxcbiAgICBjOiA2NyxcbiAgICBmOiA3MCxcbiAgICB2OiA4NlxuICB9O1xuXG4gIHRoaXMuaWZyYW1lTG9hZGVkID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uIChldnQpIHtcbiAgICAgIGlmIChldnQuc291cmNlID09PSB3aW5kb3cpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGRhdGEgPSBldnQuZGF0YTtcbiAgICAgIGlmIChkYXRhLnNyYyAhPT0gJ3dlYnZyLWFnZW50Jykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5hY3Rpb24gPT09ICdsb2FkZWQnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gU3VjY2Vzc2Z1bGx5IGZpbmlzaGVkIGxvYWRpbmcgaWZyYW1lOiAlcycsIGV2dC5kYXRhLnVybCk7XG4gICAgICAgIHNlbGYuaGFzTG9hZGVkSWZyYW1lID0gdHJ1ZTtcbiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7YWN0aW9uOiAnbG9hZGVkJ30pO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RlbmVyKTtcbiAgICAgICAgcmVzb2x2ZShzZWxmLmlmcmFtZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RlbmVyKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdGVuZXIpO1xuICAgICAgcmVqZWN0KG5ldyBFcnJvcignTWVzc2FnZS1wcm94eSBpZnJhbWUgY291bGQgbm90IGJlIGxvYWQnKSk7XG4gICAgfSwgc2VsZi5pZnJhbWVUaW1lb3V0KTtcbiAgfSk7XG5cbiAgRXZlbnRFbWl0dGVyLmNhbGwodGhpcyk7XG59XG5PYmplY3QuY3JlYXRlKFdlYnZyQWdlbnQsIEV2ZW50RW1pdHRlcik7XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5faW5pdGVkKSB7XG4gICAgdGhpcy5faW5pdGVkID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcy5pbmplY3QoKTtcbiAgfVxufTtcbldlYnZyQWdlbnQucHJvdG90eXBlLnVybCA9IGZ1bmN0aW9uIChrZXksIHBhcmFtcykge1xuICAvLyBUT0RPOiBDb25zdHJ1Y3QgcXVlcnktc3RyaW5nIGZyb20gdGhlIGBwYXJhbXNgIG9iamVjdC5cbiAgdmFyIHVybCA9IHRoaXMub3JpZ2luSG9zdCArICcvJyArIChrZXkgfHwgJycpLnJlcGxhY2UoL15cXC8qL2csICcnKTtcbiAgcGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICBpZiAoa2V5ID09PSAnbWFuaWZlc3QnKSB7XG4gICAgaWYgKHBhcmFtcy51cmwpIHtcbiAgICAgIHJldHVybiB1cmwgKyAnL21hbmlmZXN0P3VybD0nICsgcGFyYW1zLnVybDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVybDtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5hdHRlbXB0UmVxdWVzdFByZXNlbnRVcG9uTmF2aWdhdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKG5hdmlnYXRvci5kb05vdFRyYWNrID09PSAnMScgfHwgbmF2aWdhdG9yLmRvTm90VHJhY2sgPT09IDEpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcbiAgfVxuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgLy8gUG9seWZpbGwgYmVoYXZpb3VyIG9mIGBuYXZpZ2F0b3IudnJgJ3MgYG5hdmlnYXRlYCBldmVudC5cbiAgICB4aHJKU09OKHtcbiAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICB1cmw6IHNlbGYudXJsKCdzZXNzaW9ucycpXG4gICAgfSkudGhlbihmdW5jdGlvbiAoZGlzcGxheUlkKSB7XG4gICAgICBpZiAoZGlzcGxheUlkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldENvbm5lY3RlZERpc3BsYXkoZGlzcGxheUlkKS50aGVuKGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBBdXRvbWF0aWNhbGx5IHByZXNlbnRpbmcgdG8gVlIgZGlzcGxheSBcIiVzXCIgKGlkOiAlcyknLFxuICAgICAgICAgICAgc2VsZi5nZXREaXNwbGF5TmFtZShkaXNwbGF5KSwgc2VsZi5nZXREaXNwbGF5SWQoZGlzcGxheSkpO1xuICAgICAgICAgIHJlc29sdmUoc2VsZi5yZXF1ZXN0UHJlc2VudChkaXNwbGF5KSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XG4gICAgICB9XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjb25zb2xlLndhcm4oZXJyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNvbHZlKG51bGwpO1xuICAgIH0pO1xuICB9KTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5yZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAvLyB0aGlzLmdldENvbm5lY3RlZERpc3BsYXkoKSwgIC8vIE5PVEU6IFdvcmthcm91bmQgZm9yIEZpcmVmb3ggTmlnaHRseSB0byBlbmdhZ2UgVlIgbW9kZS5cbiAgICB0aGlzLmF0dGVtcHRSZXF1ZXN0UHJlc2VudFVwb25OYXZpZ2F0aW9uKCksXG4gICAgdGhpcy5hZGRVSUFuZEV2ZW50TGlzdGVuZXJzKCksXG4gICAgdGhpcy5pbmplY3QoKVxuICBdKTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5wb3N0TWVzc2FnZSA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAodHlwZW9mIG1zZyAhPT0gJ29iamVjdCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2Btc2dgIG11c3QgYmUgYW4gb2JqZWN0IGZvciBjYWxscyB0byBgV2VidnJBZ2VudCNwb3N0TWVzc2FnZWAnKTtcbiAgfVxuICByZXR1cm4gc2VsZi5pZnJhbWVMb2FkZWQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCFzZWxmLmlmcmFtZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignTWVzc2FnZS1wcm94eSBpZnJhbWUgbm90IGZvdW5kJykpO1xuICAgIH1cbiAgICBPYmplY3QuYXNzaWduKG1zZywge3NyYzogJ3dlYnZyLWFnZW50J30pO1xuICAgIHNlbGYuaWZyYW1lLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UobXNnLCBzZWxmLm9yaWdpbkhvc3QpO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XG4gIH0pO1xufTtcbldlYnZyQWdlbnQucHJvdG90eXBlLmFkZFVJQW5kRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHRvZ2dsZVZSQnV0dG9uRGltZW5zaW9ucyA9IHt9O1xuICB2YXIgaG90c3BvdEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3dlYnZyLWFnZW50LWhvdHNwb3QnKTtcbiAgaWYgKCFob3RzcG90RWwpIHtcbiAgICBob3RzcG90RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBob3RzcG90RWwuc2V0QXR0cmlidXRlKCdpZCcsICd3ZWJ2ci1hZ2VudC1ob3RzcG90Jyk7XG4gICAgc2V0Q1NTSG90c3BvdEVsKGhvdHNwb3RFbCwge3dpZHRoOiAwLCBsZWZ0OiAwLCByaWdodDogMH0pO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaG90c3BvdEVsKTtcbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIHZhciBkYXRhID0gZXZ0LmRhdGE7XG4gICAgdmFyIGFjdGlvbiA9IGRhdGEuYWN0aW9uO1xuICAgIHZhciBzcmMgPSBkYXRhLnNyYztcbiAgICBpZiAoc3JjICE9PSAnd2VidnItYWdlbnQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChhY3Rpb24gPT09ICdyZXNpemUtaWZyYW1lJykge1xuICAgICAgd2VidnJBZ2VudC5pZnJhbWUuc3R5bGUuaGVpZ2h0ID0gZGF0YS5oZWlnaHQ7XG4gICAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIFJlc2l6ZWQgaWZyYW1lIHRvICVzJywgZGF0YS5oZWlnaHQpO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnZGlzcGxheS1yZXF1ZXN0LXByZXNlbnQnKSB7XG4gICAgICB3ZWJ2ckFnZW50LnJlcXVlc3RQcmVzZW50KGRhdGEuZGlzcGxheUlkKTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2Rpc3BsYXktZXhpdC1wcmVzZW50Jykge1xuICAgICAgd2VidnJBZ2VudC5leGl0UHJlc2VudChkYXRhLmRpc3BsYXlJZCk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdyZXNpemUtdG9nZ2xlLXZyLWJ1dHRvbicpIHtcbiAgICAgIHRvZ2dsZVZSQnV0dG9uRGltZW5zaW9ucyA9IGRhdGEuZGltZW5zaW9ucyB8fCB7fTtcbiAgICAgIHNldENTU0hvdHNwb3RFbChob3RzcG90RWwsIHRvZ2dsZVZSQnV0dG9uRGltZW5zaW9ucyk7XG4gICAgfVxuICB9KTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIC8vIFNlbmQgYSBtZXNzYWdlIHRvIHRoZSBgaG9zdGAsIHdoaWNoIHN5bnRoZXNpc2VzIGEgYDpob3ZlcmAtbGlrZSBldmVudC5cbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3dlYnZyLWFnZW50LWhvdHNwb3QnKSB8fFxuICAgICAgICAoZXZ0LnRhcmdldC5jbG9zZXN0ICYmIGV2dC50YXJnZXQuY2xvc2VzdCgnI3dlYnZyLWFnZW50LWhvdHNwb3QnKSkpIHtcbiAgICAgIHNlbGYucG9zdE1lc3NhZ2Uoe2FjdGlvbjogJ21vdXNlZW50ZXItdG9nZ2xlLXZyLWJ1dHRvbid9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAvLyBTZW5kIGEgbWVzc2FnZSB0byB0aGUgYGhvc3RgLCB3aGljaCByZW1vdmVzIHRoZSBgOmhvdmVyYC1saWtlIGV2ZW50LlxuICAgIGlmIChldnQudGFyZ2V0ID09PSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd2VidnItYWdlbnQtaG90c3BvdCcpIHx8XG4gICAgICAgIChldnQudGFyZ2V0LmNsb3Nlc3QgJiYgZXZ0LnRhcmdldC5jbG9zZXN0KCcjd2VidnItYWdlbnQtaG90c3BvdCcpKSkge1xuICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7YWN0aW9uOiAnbW91c2VsZWF2ZS10b2dnbGUtdnItYnV0dG9uJ30pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIC8vIFdvcmthcm91bmQgZm9yIHVzZXItZ2VzdHVyZSByZXF1aXJlbWVudCB0byBlbnRlciBWUi5cbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3dlYnZyLWFnZW50LWhvdHNwb3QnKSB8fFxuICAgICAgICAoZXZ0LnRhcmdldC5jbG9zZXN0ICYmIGV2dC50YXJnZXQuY2xvc2VzdCgnI3dlYnZyLWFnZW50LWhvdHNwb3QnKSkpIHtcbiAgICAgIHdlYnZyQWdlbnQucmVxdWVzdFByZXNlbnQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKHNlbGYuY29ubmVjdGVkRGlzcGxheSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2VsZi5wb3N0TWVzc2FnZSh7YWN0aW9uOiAnY2xvc2UtaW5mbyd9KTtcbiAgfSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIGlmIChldnQudGFyZ2V0ICE9PSBkb2N1bWVudC5ib2R5IHx8IChldnQuc2hpZnRLZXkgfHwgZXZ0Lm1ldGFLZXkgfHwgZXZ0LmFsdEtleSB8fCBldnQuY3RybEtleSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2dC5rZXlDb2RlID09PSBzZWxmLmtleXMuZXNjKSB7XG4gICAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIGBFc2NgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAoc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKHNlbGYuY29ubmVjdGVkRGlzcGxheSkpIHtcbiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7YWN0aW9uOiAnZGlzcGxheS1leGl0LXByZXNlbnQnfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHthY3Rpb246ICdjbG9zZS1pbmZvJ30pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT09IHNlbGYua2V5cy5pKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYGlgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAoIXNlbGYuaXNEaXNwbGF5UHJlc2VudGluZyhzZWxmLmNvbm5lY3RlZERpc3BsYXkpKSB7XG4gICAgICAgIHNlbGYucG9zdE1lc3NhZ2Uoe2FjdGlvbjogJ3RvZ2dsZS1pbmZvJ30pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT09IHNlbGYua2V5cy5jKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYGNgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAoc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKHNlbGYuY29ubmVjdGVkRGlzcGxheSkpIHtcbiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7YWN0aW9uOiAnZGlzcGxheS1leGl0LXByZXNlbnQnfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHthY3Rpb246ICdjbG9zZS1pbmZvJ30pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT09IHNlbGYua2V5cy52KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYHZgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAoc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKHNlbGYuY29ubmVjdGVkRGlzcGxheSkpIHtcbiAgICAgICAgc2VsZi5leGl0UHJlc2VudCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5yZXF1ZXN0UHJlc2VudCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT09IHNlbGYua2V5cy5mKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYGZgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAoc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKHNlbGYuY29ubmVjdGVkRGlzcGxheSkpIHtcbiAgICAgICAgc2VsZi5leGl0UHJlc2VudCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5yZXF1ZXN0UHJlc2VudCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLy8gVE9ETzogSGFuZGxlIHRocmVlLmpzIHNjZW5lcyB3aXRoIGBUSFJFRS5WUkVmZmVjdGAuXG4gIHZhciBzZXR1cEZ1bmN0aW9ucyA9IFtcbiAgICBhZnJhbWVTY2VuZVNldHVwXG4gIF07XG5cbiAgc2V0dXBGdW5jdGlvbnMuZm9yRWFjaChkb2MudHJ5VW50aWxGb3VuZCk7XG5cbiAgZnVuY3Rpb24gYWZyYW1lU2NlbmVTZXR1cCAoKSB7XG4gICAgdmFyIGFmcmFtZVNjZW5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYS1zY2VuZScpO1xuICAgIGlmICghYWZyYW1lU2NlbmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGFmcmFtZVNjZW5lLmhhc0xvYWRlZCkge1xuICAgICAgYWZyYW1lSGlkZVZSTW9kZVVJKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFmcmFtZVNjZW5lLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZCcsIGFmcmFtZUhpZGVWUk1vZGVVSSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFmcmFtZUhpZGVWUk1vZGVVSSAoKSB7XG4gICAgICBhZnJhbWVTY2VuZS5zZXRBdHRyaWJ1dGUoJ3ZyLW1vZGUtdWknLCAnZW5hYmxlZDogZmFsc2UnKTtcbiAgICB9XG4gICAgcmV0dXJuIGFmcmFtZVNjZW5lO1xuICB9XG59O1xuV2VidnJBZ2VudC5wcm90b3R5cGUuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgaWYgKHNlbGYuX2luamVjdGVkKSB7XG4gICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2VsZi5faW5qZWN0ZWQgPSB0cnVlO1xuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gSW5qZWN0aW5nIGA8aWZyYW1lPmAgZm9yIFwiJXNcIicsIHNlbGYudXJpSG9zdCk7XG4gICAgdmFyIGlmcmFtZSA9IHNlbGYuaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgaWZyYW1lLnNyYyA9IHNlbGYudXJpSG9zdCArICc/dXJsPScgKyB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBpZnJhbWUuc3R5bGUuY3NzVGV4dCA9ICdib3JkZXItd2lkdGg6IDA7IGhlaWdodDogNjFweDsgd2lkdGg6IDEwMCU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgYm90dG9tOiAwOyByaWdodDogMDsgbGVmdDogMDsgei1pbmRleDogOTk5OTknO1xuICAgIGlmcmFtZS5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gaWYgKHNlbGYuX2luamVjdGVkKSB7XG4gICAgICAvLyAgIHJlamVjdChuZXcgRXJyb3IoJ0FscmVhZHkgbG9hZGVkIGlmcmFtZScpKTtcbiAgICAgIC8vICAgcmV0dXJuO1xuICAgICAgLy8gfVxuICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gSW5qZWN0ZWQgYDxpZnJhbWU+YCBmb3IgXCIlc1wiJywgc2VsZi51cmlIb3N0KTtcbiAgICB9KTtcbiAgICBpZnJhbWUuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICAgIGNvbnNvbGUud2FybignW3dlYnZyLWFnZW50XVtjbGllbnRdIENvdWxkIG5vdCBsb2FkOicsIGVycik7XG4gICAgfSk7XG4gICAgZG9jLnRyeVVudGlsRm91bmQoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCFkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuV2VidnJBZ2VudC5wcm90b3R5cGUucmVxdWVzdFByZXNlbnQgPSBmdW5jdGlvbiAoZGlzcGxheSwgY2FudmFzKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgcmV0dXJuIGRvYy5sb2FkZWQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHNlbGYuZ2V0Q29ubmVjdGVkRGlzcGxheShkaXNwbGF5ID8gZGlzcGxheS5pZCA6IG51bGwsIGRpc3BsYXkpLnRoZW4oZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgICAgIGlmICghZGlzcGxheSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFZSIGhlYWRzZXQgZGV0ZWN0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgLy8gVE9ETzogSGFuZGxlIHRocmVlLmpzIHNjZW5lcyB3aXRoIGBUSFJFRS5WUkVmZmVjdGAuXG4gICAgICB2YXIgYWZyYW1lU2NlbmUgPSBjYW52YXMgJiYgY2FudmFzLm1hdGNoZXMgJiYgY2FudmFzLm1hdGNoZXMoJ2Etc2NlbmUnKSA/IGNhbnZhcyA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Etc2NlbmUnKTtcbiAgICAgIGNhbnZhcyA9IGNhbnZhcyB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcblxuICAgICAgaWYgKCFjYW52YXMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW52YXMgc291cmNlIGVtcHR5Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzZWxmLmlzRGlzcGxheVByZXNlbnRpbmcoZGlzcGxheSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWUiBoZWFkc2V0IGlzIHByZXNlbnRpbmcnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGFmcmFtZVNjZW5lKSB7XG4gICAgICAgIGlmIChhZnJhbWVTY2VuZS5oYXNMb2FkZWQpIHtcbiAgICAgICAgICByZXR1cm4gYWZyYW1lU2NlbmUuZW50ZXJWUigpLnRoZW4oZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIHJldHVybiBkaXNwbGF5O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFmcmFtZVNjZW5lLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBhZnJhbWVTY2VuZS5lbnRlclZSKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkaXNwbGF5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRpc3BsYXkucmVxdWVzdFByZXNlbnQoW3tzb3VyY2U6IGNhbnZhc31dKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRpc3BsYXk7XG4gICAgICB9KTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgICB2YXIgaXNDb25uZWN0ZWQgPSBzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KTtcbiAgICAgIHZhciBpc0Rpc2Nvbm5lY3RlZCA9ICFpc0Nvbm5lY3RlZDtcbiAgICAgIHZhciBpc1ByZXNlbnRpbmcgPSBzZWxmLmlzRGlzcGxheVByZXNlbnRpbmcoZGlzcGxheSk7XG4gICAgICByZXR1cm4gc2VsZi5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGFjdGlvbjogJ2Rpc3BsYXktcHJlc2VudC1zdGFydCcsXG4gICAgICAgIGRpc3BsYXlJZDogc2VsZi5nZXREaXNwbGF5SWQoZGlzcGxheSksXG4gICAgICAgIGRpc3BsYXlOYW1lOiBzZWxmLmdldERpc3BsYXlOYW1lKGRpc3BsYXkpLFxuICAgICAgICBkaXNwbGF5U2x1Zzogc2VsZi5nZXREaXNwbGF5U2x1ZyhkaXNwbGF5KSxcbiAgICAgICAgaXNDb25uZWN0ZWQ6IGlzQ29ubmVjdGVkLFxuICAgICAgICBpc0Rpc2Nvbm5lY3RlZDogaXNEaXNjb25uZWN0ZWQsXG4gICAgICAgIGlzUHJlc2VudGluZzogaXNQcmVzZW50aW5nXG4gICAgICB9KTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbd2VidnItYWdlbnRdW2NsaWVudF0gRmFpbGVkIHRvIGVudGVyIFZSIHByZXNlbnRhdGlvbicgK1xuICAgICAgICAoZXJyICYmIGVyci5tZXNzYWdlID8gJzogJyArIGVyci5tZXNzYWdlIDogJycpLFxuICAgICAgICBlcnIuc3RhY2spO1xuICAgIH0pO1xuICB9KTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5leGl0UHJlc2VudCA9IGZ1bmN0aW9uIChkaXNwbGF5LCBjYW52YXMpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICByZXR1cm4gZG9jLmxvYWRlZC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gc2VsZi5nZXRDb25uZWN0ZWREaXNwbGF5KGRpc3BsYXkgPyBkaXNwbGF5LmlkIDogbnVsbCwgZGlzcGxheSkudGhlbihmdW5jdGlvbiAoZGlzcGxheSkge1xuICAgICAgaWYgKCFkaXNwbGF5KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVlIgaGVhZHNldCBkZXRlY3RlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXNlbGYuaXNEaXNwbGF5UHJlc2VudGluZyhkaXNwbGF5KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZSIGhlYWRzZXQgaXMgbm90IHByZXNlbnRpbmcnKTtcbiAgICAgIH1cblxuICAgICAgLy8gVE9ETzogSGFuZGxlIHRocmVlLmpzIHNjZW5lcyB3aXRoIGBUSFJFRS5WUkVmZmVjdGAuXG4gICAgICB2YXIgYWZyYW1lU2NlbmUgPSBjYW52YXMgJiYgY2FudmFzLm1hdGNoZXMgJiYgY2FudmFzLm1hdGNoZXMoJ2Etc2NlbmUnKSA/IGNhbnZhcyA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Etc2NlbmUnKTtcbiAgICAgIGNhbnZhcyA9IGNhbnZhcyB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcblxuICAgICAgLy8gVE9ETzogRm9yIG5vbi1BLUZyYW1lIHNjZW5lcywgZmluZCB0aGUgVlIgZGlzcGxheSBiZWluZyBwcmVzZW50ZWQgd2hpY2ggY29udGFpbnMgYSBsYXllciBmb3IgYGNhbnZhc2AuXG5cbiAgICAgIGlmIChhZnJhbWVTY2VuZSkge1xuICAgICAgICBpZiAoYWZyYW1lU2NlbmUuaGFzTG9hZGVkKSB7XG4gICAgICAgICAgcmV0dXJuIGFmcmFtZVNjZW5lLmV4aXRWUigpLnRoZW4oZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIHJldHVybiBkaXNwbGF5O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFmcmFtZVNjZW5lLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBhZnJhbWVTY2VuZS5leGl0VlIoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGlzcGxheS5leGl0UHJlc2VudCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZGlzcGxheTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBFcnJvcignRmFpbGVkIHRvIGV4aXQgVlIgcHJlc2VudGF0aW9uJyArXG4gICAgICAgICAgKGVyciAmJiBlcnIubWVzc2FnZSA/ICc6ICcgKyBlcnIubWVzc2FnZSA6ICcnKSk7XG4gICAgICB9KTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgICB2YXIgaXNDb25uZWN0ZWQgPSBzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KTtcbiAgICAgIHZhciBpc0Rpc2Nvbm5lY3RlZCA9ICFpc0Nvbm5lY3RlZDtcbiAgICAgIHZhciBpc1ByZXNlbnRpbmcgPSBmYWxzZTtcbiAgICAgIHJldHVybiBzZWxmLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgYWN0aW9uOiAnZGlzcGxheS1wcmVzZW50LWVuZCcsXG4gICAgICAgIGRpc3BsYXlJZDogc2VsZi5nZXREaXNwbGF5SWQoZGlzcGxheSksXG4gICAgICAgIGRpc3BsYXlOYW1lOiBzZWxmLmdldERpc3BsYXlOYW1lKGRpc3BsYXkpLFxuICAgICAgICBkaXNwbGF5U2x1Zzogc2VsZi5nZXREaXNwbGF5U2x1ZyhkaXNwbGF5KSxcbiAgICAgICAgaXNDb25uZWN0ZWQ6IGlzQ29ubmVjdGVkLFxuICAgICAgICBpc0Rpc2Nvbm5lY3RlZDogaXNEaXNjb25uZWN0ZWQsXG4gICAgICAgIGlzUHJlc2VudGluZzogaXNQcmVzZW50aW5nXG4gICAgICB9KTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbd2VidnItYWdlbnRdW2NsaWVudF0gRmFpbGVkIHRvIGV4aXQgVlIgcHJlc2VudGF0aW9uJyArXG4gICAgICAgIChlcnIgJiYgZXJyLm1lc3NhZ2UgPyAnOiAnICsgZXJyLm1lc3NhZ2UgOiAnJykpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH0pO1xuICB9KTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5pc0Rpc3BsYXlDb25uZWN0ZWQgPSBmdW5jdGlvbiAoZGlzcGxheSkge1xuICBpZiAoIWRpc3BsYXkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKCdpc0Nvbm5lY3RlZCcgaW4gZGlzcGxheSkge1xuICAgIHJldHVybiBkaXNwbGF5LmlzQ29ubmVjdGVkO1xuICB9XG4gIGlmICgnY29ubmVjdGVkJyBpbiBkaXNwbGF5KSB7XG4gICAgcmV0dXJuIGRpc3BsYXkuY29ubmVjdGVkO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5pc0Rpc3BsYXlQcmVzZW50aW5nID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgaWYgKGRpc3BsYXkpIHtcbiAgICBpZiAoJ2lzUHJlc2VudGluZycgaW4gZGlzcGxheSkge1xuICAgICAgcmV0dXJuIGRpc3BsYXkuaXNQcmVzZW50aW5nO1xuICAgIH1cbiAgICBpZiAoJ3ByZXNlbnRpbmcnIGluIGRpc3BsYXkpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5LnByZXNlbnRpbmc7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5nZXREaXNwbGF5SWQgPSBmdW5jdGlvbiAoZGlzcGxheSkge1xuICBpZiAoZGlzcGxheSkge1xuICAgIGlmICgnZGlzcGxheUlkJyBpbiBkaXNwbGF5KSB7XG4gICAgICByZXR1cm4gU3RyaW5nKGRpc3BsYXkuZGlzcGxheUlkKTtcbiAgICB9XG4gICAgaWYgKCdpZCcgaW4gZGlzcGxheSkge1xuICAgICAgcmV0dXJuIFN0cmluZyhkaXNwbGF5LmlkKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuV2VidnJBZ2VudC5wcm90b3R5cGUuZ2V0RGlzcGxheU5hbWUgPSBmdW5jdGlvbiAoZGlzcGxheSkge1xuICBpZiAoZGlzcGxheSkge1xuICAgIGlmICgnZGlzcGxheU5hbWUnIGluIGRpc3BsYXkpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5LmRpc3BsYXlOYW1lO1xuICAgIH1cbiAgICBpZiAoJ25hbWUnIGluIGRpc3BsYXkpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5Lm5hbWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcbldlYnZyQWdlbnQucHJvdG90eXBlLmdldERpc3BsYXlTbHVnID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgaWYgKGRpc3BsYXkpIHtcbiAgICB2YXIgZGlzcGxheU5hbWUgPSAodGhpcy5nZXREaXNwbGF5TmFtZShkaXNwbGF5KSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoZGlzcGxheU5hbWUuaW5kZXhPZignb2N1bHVzJykgPiAtMSkge1xuICAgICAgcmV0dXJuIHRoaXMuaGVhZHNldHMub2N1bHVzX3JpZnQuc2x1ZztcbiAgICB9IGVsc2UgaWYgKGRpc3BsYXlOYW1lLmluZGV4T2YoJ29wZW52cicpID4gLTEgfHwgZGlzcGxheU5hbWUuaW5kZXhPZigndml2ZScpID4gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlYWRzZXRzLmh0Y192aXZlLnNsdWc7XG4gICAgfSBlbHNlIGlmIChkaXNwbGF5TmFtZS5pbmRleE9mKCdnZWFyJykgPiAtMSkge1xuICAgICAgcmV0dXJuIHRoaXMuaGVhZHNldHMuc2Ftc3VuZ19nZWFyX3ZyLnNsdWc7XG4gICAgfSBlbHNlIGlmIChkaXNwbGF5TmFtZS5pbmRleE9mKCdkYXlkcmVhbScpID4gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlYWRzZXRzLmdvb2dsZV9kYXlkcmVhbS5zbHVnO1xuICAgIH0gZWxzZSBpZiAoZGlzcGxheU5hbWUuaW5kZXhPZignb3N2cicpID4gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlYWRzZXRzLm9zdnJfaGRrMi5zbHVnO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcy5oZWFkc2V0cy5nb29nbGVfY2FyZGJvYXJkLnNsdWc7XG59O1xuV2VidnJBZ2VudC5wcm90b3R5cGUuYXJlRGlzcGxheXNTYW1lID0gZnVuY3Rpb24gKGRpc3BsYXlBLCBkaXNwbGF5Qikge1xuICByZXR1cm4gdGhpcy5nZXREaXNwbGF5SWQoZGlzcGxheUEpID09PSB0aGlzLmdldERpc3BsYXlJZChkaXNwbGF5QikgJiZcbiAgICAgICAgIHRoaXMuZ2V0RGlzcGxheU5hbWUoZGlzcGxheUEpID09PSB0aGlzLmdldERpc3BsYXlOYW1lKGRpc3BsYXlCKTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5zZXREaXNjb25uZWN0ZWREaXNwbGF5ID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIGlmIChzZWxmLmFyZURpc3BsYXlzU2FtZShkaXNwbGF5LCBzZWxmLmRpc2Nvbm5lY3RlZERpc3BsYXkpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGRpc3BsYXlOYW1lID0gc2VsZi5nZXREaXNwbGF5TmFtZShkaXNwbGF5KTtcbiAgdmFyIGRpc3BsYXlJZCA9IHNlbGYuZ2V0RGlzcGxheUlkKGRpc3BsYXkpO1xuICB2YXIgZGlzcGxheVNsdWcgPSBzZWxmLmdldERpc3BsYXlTbHVnKGRpc3BsYXkpO1xuXG4gIHNlbGYuaWZyYW1lTG9hZGVkLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gRGlzcGxheSBkaXNjb25uZWN0ZWQ6ICVzIChJRDogJXM7IHNsdWc6ICVzKScsXG4gICAgICBkaXNwbGF5TmFtZSxcbiAgICAgIGRpc3BsYXlJZCxcbiAgICAgIGRpc3BsYXlTbHVnKTtcblxuICAgIHNlbGYuY29ubmVjdGVkRGlzcGxheSA9IGRpc3BsYXk7XG5cbiAgICAvLyBUT0RPOiBLZWVwIHRyYWNrIG9mIG11bHRpcGxlIGBkaXNjb25uZWN0ZWREaXNwbGF5YHMuXG4gICAgc2VsZi5kaXNjb25uZWN0ZWREaXNwbGF5ID0gZGlzcGxheTtcblxuICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICBzZWxmLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgYWN0aW9uOiAnZGlzcGxheS1kaXNjb25uZWN0ZWQnLFxuICAgICAgICBkaXNwbGF5SWQ6IGRpc3BsYXlJZCxcbiAgICAgICAgZGlzcGxheU5hbWU6IGRpc3BsYXlOYW1lLFxuICAgICAgICBkaXNwbGF5U2x1ZzogZGlzcGxheVNsdWcsXG4gICAgICAgIGlzQ29ubmVjdGVkOiBmYWxzZSxcbiAgICAgICAgaXNEaXNjb25uZWN0ZWQ6IHRydWUsXG4gICAgICAgIGlzUHJlc2VudGluZzogc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKGRpc3BsYXkpXG4gICAgICB9KVxuICAgIF0pO1xuICB9KTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5zZXRQcmVzZW50aW5nRGlzcGxheSA9IGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICBpZiAoc2VsZi5hcmVEaXNwbGF5c1NhbWUoZGlzcGxheSwgc2VsZi5wcmVzZW50aW5nRGlzcGxheSkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZGlzcGxheU5hbWUgPSBzZWxmLmdldERpc3BsYXlOYW1lKGRpc3BsYXkpO1xuICB2YXIgZGlzcGxheUlkID0gc2VsZi5nZXREaXNwbGF5SWQoZGlzcGxheSk7XG4gIHZhciBkaXNwbGF5U2x1ZyA9IHNlbGYuZ2V0RGlzcGxheVNsdWcoZGlzcGxheSk7XG5cbiAgc2VsZi5pZnJhbWVMb2FkZWQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBEaXNwbGF5IHByZXNlbnRpbmc6ICVzIChJRDogJXM7IHNsdWc6ICVzKScsXG4gICAgICBkaXNwbGF5TmFtZSxcbiAgICAgIGRpc3BsYXlJZCxcbiAgICAgIGRpc3BsYXlTbHVnKTtcblxuICAgIHNlbGYuY29ubmVjdGVkRGlzcGxheSA9IGRpc3BsYXk7XG5cbiAgICAvLyBUT0RPOiBLZWVwIHRyYWNrIG9mIG11bHRpcGxlIGBwcmVzZW50aW5nRGlzcGxheWBzLlxuICAgIHNlbGYucHJlc2VudGluZ0Rpc3BsYXkgPSBkaXNwbGF5O1xuXG4gICAgdmFyIGlzQ29ubmVjdGVkID0gc2VsZi5pc0Rpc3BsYXlDb25uZWN0ZWQoZGlzcGxheSk7XG4gICAgdmFyIGlzRGlzY29ubmVjdGVkID0gIWlzQ29ubmVjdGVkO1xuICAgIHZhciBpc1ByZXNlbnRpbmcgPSB0cnVlO1xuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAgIHNlbGYucG9zdE1lc3NhZ2Uoe1xuICAgICAgICBhY3Rpb246ICdkaXNwbGF5LXByZXNlbnRpbmcnLFxuICAgICAgICBkaXNwbGF5SWQ6IGRpc3BsYXlJZCxcbiAgICAgICAgZGlzcGxheU5hbWU6IGRpc3BsYXlOYW1lLFxuICAgICAgICBkaXNwbGF5U2x1ZzogZGlzcGxheVNsdWcsXG4gICAgICAgIGlzQ29ubmVjdGVkOiBpc0Nvbm5lY3RlZCxcbiAgICAgICAgaXNEaXNjb25uZWN0ZWQ6IGlzRGlzY29ubmVjdGVkLFxuICAgICAgICBpc1ByZXNlbnRpbmc6IGlzUHJlc2VudGluZ1xuICAgICAgfSksXG4gICAgICBzZWxmLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgYWN0aW9uOiAnZGlzcGxheS1wcmVzZW50LXN0YXJ0JyxcbiAgICAgICAgZGlzcGxheUlkOiBkaXNwbGF5SWQsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBkaXNwbGF5TmFtZSxcbiAgICAgICAgZGlzcGxheVNsdWc6IGRpc3BsYXlTbHVnLFxuICAgICAgICBpc0Nvbm5lY3RlZDogaXNDb25uZWN0ZWQsXG4gICAgICAgIGlzRGlzY29ubmVjdGVkOiBpc0Rpc2Nvbm5lY3RlZCxcbiAgICAgICAgaXNQcmVzZW50aW5nOiBpc1ByZXNlbnRpbmdcbiAgICAgIH0pLFxuICAgICAgc2VsZi5wZXJzaXN0VlJEaXNwbGF5UHJlc2VudGF0aW9uU3RhdGUoZGlzcGxheSlcbiAgICBdKTtcbiAgfSk7XG59O1xuV2VidnJBZ2VudC5wcm90b3R5cGUuc2V0Tm90UHJlc2VudGluZ0Rpc3BsYXkgPSBmdW5jdGlvbiAoZGlzcGxheSkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgaWYgKHNlbGYuYXJlRGlzcGxheXNTYW1lKGRpc3BsYXksIHNlbGYubm90UHJlc2VudGluZ0Rpc3BsYXkpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGRpc3BsYXlOYW1lID0gc2VsZi5nZXREaXNwbGF5TmFtZShkaXNwbGF5KTtcbiAgdmFyIGRpc3BsYXlJZCA9IHNlbGYuZ2V0RGlzcGxheUlkKGRpc3BsYXkpO1xuICB2YXIgZGlzcGxheVNsdWcgPSBzZWxmLmdldERpc3BsYXlTbHVnKGRpc3BsYXkpO1xuXG4gIHNlbGYuaWZyYW1lTG9hZGVkLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gRGlzcGxheSBzdG9wcGVkIHByZXNlbnRpbmc6ICVzIChJRDogJXM7IHNsdWc6ICVzKScsXG4gICAgICBkaXNwbGF5TmFtZSxcbiAgICAgIGRpc3BsYXlJZCxcbiAgICAgIGRpc3BsYXlTbHVnKTtcblxuICAgIC8vIHNlbGYuY29ubmVjdGVkRGlzcGxheSA9IGRpc3BsYXk7XG5cbiAgICBzZWxmLnByZXNlbnRpbmdEaXNwbGF5ID0gbnVsbDtcblxuICAgIC8vIFRPRE86IEtlZXAgdHJhY2sgb2YgbXVsdGlwbGUgYG5vdFByZXNlbnRpbmdEaXNwbGF5YHMuXG4gICAgc2VsZi5ub3RQcmVzZW50aW5nRGlzcGxheSA9IGRpc3BsYXk7XG5cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGFjdGlvbjogJ2Rpc3BsYXktcHJlc2VudC1lbmQnLFxuICAgICAgICBkaXNwbGF5SWQ6IGRpc3BsYXlJZCxcbiAgICAgICAgZGlzcGxheU5hbWU6IGRpc3BsYXlOYW1lLFxuICAgICAgICBkaXNwbGF5U2x1ZzogZGlzcGxheVNsdWcsXG4gICAgICAgIGlzQ29ubmVjdGVkOiBzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KSxcbiAgICAgICAgaXNEaXNjb25uZWN0ZWQ6ICFzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KSxcbiAgICAgICAgaXNQcmVzZW50aW5nOiBmYWxzZVxuICAgICAgfSksXG4gICAgICBzZWxmLnBlcnNpc3RWUkRpc3BsYXlQcmVzZW50YXRpb25TdGF0ZShkaXNwbGF5KVxuICAgIF0pO1xuICB9KTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5zZXRDb25uZWN0ZWREaXNwbGF5ID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIGlmIChzZWxmLmFyZURpc3BsYXlzU2FtZShkaXNwbGF5LCBzZWxmLmNvbm5lY3RlZERpc3BsYXkpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGRpc3BsYXlOYW1lID0gc2VsZi5nZXREaXNwbGF5TmFtZShkaXNwbGF5KTtcbiAgdmFyIGRpc3BsYXlJZCA9IHNlbGYuZ2V0RGlzcGxheUlkKGRpc3BsYXkpO1xuICB2YXIgZGlzcGxheVNsdWcgPSBzZWxmLmdldERpc3BsYXlTbHVnKGRpc3BsYXkpO1xuXG4gIHNlbGYuaWZyYW1lTG9hZGVkLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gRGlzcGxheSBjb25uZWN0ZWQ6ICVzIChJRDogJXM7IHNsdWc6ICVzKScsXG4gICAgICBkaXNwbGF5TmFtZSxcbiAgICAgIGRpc3BsYXlJZCxcbiAgICAgIGRpc3BsYXlTbHVnKTtcblxuICAgIHNlbGYuZGlzY29ubmVjdGVkRGlzcGxheSA9IG51bGw7XG5cbiAgICAvLyBUT0RPOiBLZWVwIHRyYWNrIG9mIG11bHRpcGxlIGBjb25uZWN0ZWREaXNwbGF5YHMuXG4gICAgc2VsZi5jb25uZWN0ZWREaXNwbGF5ID0gZGlzcGxheTtcblxuICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICBzZWxmLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgYWN0aW9uOiAnZGlzcGxheS1jb25uZWN0ZWQnLFxuICAgICAgICBkaXNwbGF5SWQ6IGRpc3BsYXlJZCxcbiAgICAgICAgZGlzcGxheU5hbWU6IGRpc3BsYXlOYW1lLFxuICAgICAgICBkaXNwbGF5U2x1ZzogZGlzcGxheVNsdWcsXG4gICAgICAgIGlzQ29ubmVjdGVkOiB0cnVlLFxuICAgICAgICBpc0Rpc2Nvbm5lY3RlZDogZmFsc2UsXG4gICAgICAgIGlzUHJlc2VudGluZzogc2VsZi5pc0Rpc3BsYXlQcmVzZW50aW5nKGRpc3BsYXkpXG4gICAgICB9KVxuICAgIF0pO1xuICB9KTtcblxuICByZXR1cm4gZGlzcGxheTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5wZXJzaXN0VlJEaXNwbGF5UHJlc2VudGF0aW9uU3RhdGUgPSBmdW5jdGlvbiAoZGlzcGxheSkge1xuICBpZiAobmF2aWdhdG9yLmRvTm90VHJhY2sgPT09ICcxJyB8fCBuYXZpZ2F0b3IuZG9Ob3RUcmFjayA9PT0gMSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xuICB9XG5cbiAgLy8gUG9seWZpbGwgYmVoYXZpb3VyIG9mIGBuYXZpZ2F0b3IudnJgJ3MgYG5hdmlnYXRlYCBldmVudC5cbiAgZGlzcGxheSA9IGRpc3BsYXkgfHwgdGhpcy5jb25uZWN0ZWREaXNwbGF5O1xuXG4gIC8vIFBlcnNpc3Qgc3RhdGUgb2YgVlIgcHJlc2VudGF0aW9uIChmb3IgYG5hdmlnYXRvci52cmAncyBgbmF2aWdhdGVgIGV2ZW50KS5cbiAgcmV0dXJuIHhockpTT04oe1xuICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgIHVybDogdGhpcy51cmwoJ3Nlc3Npb25zJyksXG4gICAgZGF0YToge1xuICAgICAgZG9jVVJMOiB3aW5kb3cubG9jYXRpb24uaHJlZixcbiAgICAgIGRvY1RpdGxlOiBkb2N1bWVudC50aXRsZSxcbiAgICAgIGRpc3BsYXlJZDogdGhpcy5nZXREaXNwbGF5SWQoZGlzcGxheSksXG4gICAgICBkaXNwbGF5TmFtZTogdGhpcy5nZXREaXNwbGF5TmFtZShkaXNwbGF5KSxcbiAgICAgIGRpc3BsYXlTbHVnOiB0aGlzLmdldERpc3BsYXlTbHVnKGRpc3BsYXkpLFxuICAgICAgaXNDb25uZWN0ZWQ6IHRoaXMuaXNEaXNwbGF5Q29ubmVjdGVkKGRpc3BsYXkpLFxuICAgICAgaXNEaXNjb25uZWN0ZWQ6ICF0aGlzLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KSxcbiAgICAgIGlzUHJlc2VudGluZzogdGhpcy5pc0Rpc3BsYXlQcmVzZW50aW5nKGRpc3BsYXkpLFxuICAgIH1cbiAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gUGVyc2lzdGVkIHN0YXRlIG9mIHByZXNlbnRpbmcgVlIgZGlzcGxheScpO1xuICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS53YXJuKGVycik7XG4gICAgfVxuICB9KTtcbn07XG5XZWJ2ckFnZW50LnByb3RvdHlwZS5nZXRDb25uZWN0ZWREaXNwbGF5ID0gZnVuY3Rpb24gKHByZWZlcnJlZERpc3BsYXlJZCwgZGVmYXVsdERpc3BsYXkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIGlmIChwcmVmZXJyZWREaXNwbGF5SWQpIHtcbiAgICBwcmVmZXJyZWREaXNwbGF5SWQgPSBTdHJpbmcocHJlZmVycmVkRGlzcGxheUlkKTtcbiAgfVxuXG4gIGlmICghc2VsZi5fZGlzcGxheUxpc3RlbmVyc1NldCkge1xuICAgIGlmIChuYXZpZ2F0b3IudnIpIHtcbiAgICAgIC8vIEZvciBXZWJWUiB2MS4yIEFQSS5cbiAgICAgIG5hdmlnYXRvci52ci5hZGRFdmVudExpc3RlbmVyKCdkaXNwbGF5Y29ubmVjdCcsIGhhbmRsZVZSRXZlbnREaXNwbGF5Q29ubmVjdCk7XG4gICAgICBuYXZpZ2F0b3IudnIuYWRkRXZlbnRMaXN0ZW5lcignZGlzcGxheWRpc2Nvbm5lY3QnLCBoYW5kbGVWUkV2ZW50RGlzcGxheURpc2Nvbm5lY3QpO1xuICAgICAgbmF2aWdhdG9yLnZyLmFkZEV2ZW50TGlzdGVuZXIoJ25hdmlnYXRlJywgaGFuZGxlVlJFdmVudE5hdmlnYXRlKTtcblxuICAgICAgLy8gVE9ETzogRm9yIGVhY2ggYFZSRGlzcGxheWAgaW5zdGFuY2UsIGFkZCB0aGVzZSBldmVudCBsaXN0ZW5lcnM6XG4gICAgICAvLyAtIGBhY3RpdmF0ZWBcbiAgICAgIC8vIC0gYGRlYWN0aXZhdGVgXG4gICAgICAvLyAtIGBibHVyYFxuICAgICAgLy8gLSBgYmx1cnJlZGBcbiAgICAgIC8vIC0gYGZvY3VzYFxuICAgICAgLy8gLSBgZm9jdXNlZGBcbiAgICAgIC8vIC0gYGZvY3Vzc2VkYFxuICAgICAgLy8gLSBgcHJlc2VudGNoYW5nZWBcblxuICAgICAgLy8gVE9ETzogU3VwcG9ydCBXZWJWUiB2Mi4wIEFQSS5cbiAgICB9IGVsc2UgaWYgKG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKSB7XG4gICAgICAvLyBGb3IgV2ViVlIgdjEuMSBBUEkuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5Y29ubmVjdGVkJywgaGFuZGxlVlJFdmVudERpc3BsYXlDb25uZWN0KTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXljb25uZWN0JywgaGFuZGxlVlJFdmVudERpc3BsYXlDb25uZWN0KTtcblxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheWRpc2Nvbm5lY3RlZCcsIGhhbmRsZVZSRXZlbnREaXNwbGF5RGlzY29ubmVjdCk7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5ZGlzY29ubmVjdCcsIGhhbmRsZVZSRXZlbnREaXNwbGF5RGlzY29ubmVjdCk7XG5cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlhY3RpdmF0ZScsIGhhbmRsZVZSRXZlbnREaXNwbGF5QWN0aXZhdGUpO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheWFjdGl2YXRlZCcsIGhhbmRsZVZSRXZlbnREaXNwbGF5QWN0aXZhdGUpO1xuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5ZGVhY3RpdmF0ZScsIGhhbmRsZVZSRXZlbnREaXNwbGF5RGVhY3RpdmF0ZSk7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5ZGVhY3RpdmF0ZWQnLCBoYW5kbGVWUkV2ZW50RGlzcGxheURlYWN0aXZhdGUpO1xuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5Ymx1cicsIGhhbmRsZVZSRXZlbnREaXNwbGF5Qmx1cik7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5Zm9jdXMnLCBoYW5kbGVWUkV2ZW50RGlzcGxheUZvY3VzKTtcblxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCBoYW5kbGVWUkV2ZW50RGlzcGxheVByZXNlbnRDaGFuZ2UpO1xuICAgIH1cbiAgfVxuXG4gIHNlbGYuX2Rpc3BsYXlMaXN0ZW5lcnNTZXQgPSB0cnVlO1xuXG4gIGZ1bmN0aW9uIGhhbmRsZVZSRXZlbnREaXNwbGF5Q29ubmVjdCAoZXZ0KSB7XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBFdmVudCBcIiVzXCIgcmVjZWl2ZWQ6JywgZXZ0LnR5cGUsIGV2dCk7XG4gICAgaWYgKGV2dC5kaXNwbGF5KSB7XG4gICAgICBzZWxmLnNldENvbm5lY3RlZERpc3BsYXkoZXZ0LmRpc3BsYXkpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVZSRXZlbnREaXNwbGF5RGlzY29ubmVjdCAoZXZ0KSB7XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBFdmVudCBcIiVzXCIgcmVjZWl2ZWQ6JywgZXZ0LnR5cGUsIGV2dCk7XG4gICAgaWYgKGV2dC5kaXNwbGF5KSB7XG4gICAgICBzZWxmLnNldERpc29ubmVjdGVkRGlzcGxheShldnQuZGlzcGxheSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlVlJFdmVudE5hdmlnYXRlIChldnQpIHtcbiAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIEV2ZW50IFwiJXNcIiByZWNlaXZlZDonLCBldnQudHlwZSwgZXZ0KTtcbiAgICBpZiAoZXZ0LmRpc3BsYXkpIHtcbiAgICAgIHNlbGYuc2V0Q29ubmVjdGVkRGlzcGxheShldnQuZGlzcGxheSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlVlJFdmVudERpc3BsYXlBY3RpdmF0ZSAoZXZ0KSB7XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBFdmVudCBcIiVzXCIgcmVjZWl2ZWQ6JywgZXZ0LnR5cGUsIGV2dCk7XG4gICAgaWYgKGV2dC5kaXNwbGF5KSB7XG4gICAgICBzZWxmLnNldENvbm5lY3RlZERpc3BsYXkoZXZ0LmRpc3BsYXkpO1xuICAgIH1cbiAgICBpZiAoZXZ0LnJlYXNvbiA9PT0gJ21vdW50JyB8fCBldnQucmVhc29uID09PSAnbW91bnRlZCcgfHxcbiAgICAgICAgZXZ0LnJlYXNvbiA9PT0gJ3JlcXVlc3RlZCcgfHxcbiAgICAgICAgZXZ0LnJlYXNvbiA9PT0gJ25hdmlnYXRpb24nIHx8XG4gICAgICAgICFldnQucmVhc29uKSB7XG4gICAgICBpZiAoc2VsZi5tb3VudGVkRGlzcGxheSAhPT0gZXZ0LmNvbm5lY3RlZERpc3BsYXkpIHtcbiAgICAgICAgc2VsZi5tb3VudGVkRGlzcGxheSA9IGV2dC5kaXNwbGF5O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVZSRXZlbnREaXNwbGF5RGVhY3RpdmF0ZSAoZXZ0KSB7XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBFdmVudCBcIiVzXCIgcmVjZWl2ZWQ6JywgZXZ0LnR5cGUsIGV2dCk7XG4gICAgaWYgKGV2dC5kaXNwbGF5KSB7XG4gICAgICBzZWxmLnNldENvbm5lY3RlZERpc3BsYXkobnVsbCk7XG4gICAgfVxuICAgIGlmIChldnQucmVhc29uID09PSAndW5tb3VudCcgfHwgZXZ0LnJlYXNvbiA9PT0gJ3VubW91bnRlZCcgfHwgIWV2dC5yZWFzb24pIHtcbiAgICAgIGlmIChzZWxmLm1vdW50ZWREaXNwbGF5ID09PSBldnQuY29ubmVjdGVkRGlzcGxheSkge1xuICAgICAgICBzZWxmLm1vdW50ZWREaXNwbGF5ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVWUkV2ZW50RGlzcGxheUJsdXIgKGV2dCkge1xuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gRXZlbnQgXCIlc1wiIHJlY2VpdmVkOicsIGV2dC50eXBlLCBldnQpO1xuICAgIGlmIChldnQuZGlzcGxheSkge1xuICAgICAgc2VsZi5zZXRDb25uZWN0ZWREaXNwbGF5KGV2dC5kaXNwbGF5KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVWUkV2ZW50RGlzcGxheUZvY3VzIChldnQpIHtcbiAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIEV2ZW50IFwiJXNcIiByZWNlaXZlZDonLCBldnQudHlwZSwgZXZ0KTtcbiAgICBpZiAoZXZ0LmRpc3BsYXkpIHtcbiAgICAgIHNlbGYuc2V0Q29ubmVjdGVkRGlzcGxheShldnQuZGlzcGxheSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlVlJFdmVudERpc3BsYXlQcmVzZW50Q2hhbmdlIChldnQpIHtcbiAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIEV2ZW50IFwiJXNcIiByZWNlaXZlZDonLCBldnQudHlwZSwgZXZ0KTtcbiAgICBpZiAoIWV2dC5kaXNwbGF5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzZWxmLmlzRGlzcGxheVByZXNlbnRpbmcoZXZ0LmRpc3BsYXkpKSB7XG4gICAgICBzZWxmLnNldFByZXNlbnRpbmdEaXNwbGF5KGV2dC5kaXNwbGF5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5zZXROb3RQcmVzZW50aW5nRGlzcGxheShldnQuZGlzcGxheSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgY29ubmVjdGVkRGlzcGxheSA9IHNlbGYuY29ubmVjdGVkRGlzcGxheTtcbiAgICBpZiAoY29ubmVjdGVkRGlzcGxheSAmJiBzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChjb25uZWN0ZWREaXNwbGF5KSkge1xuICAgICAgcmVzb2x2ZShjb25uZWN0ZWREaXNwbGF5KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAobmF2aWdhdG9yLnZyKSB7XG4gICAgICByZXR1cm4gbmF2aWdhdG9yLnZyLmdldERpc3BsYXlzKCkudGhlbihmaW5kQ29ubmVjdGVkRGlzcGxheXMpLnRoZW4ocmVzb2x2ZSk7XG4gICAgfSBlbHNlIGlmIChuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cykge1xuICAgICAgcmV0dXJuIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKCkudGhlbihmaW5kQ29ubmVjdGVkRGlzcGxheXMpLnRoZW4ocmVzb2x2ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc29sdmUoZGVmYXVsdERpc3BsYXkgfHwgbnVsbCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZmluZENvbm5lY3RlZERpc3BsYXlzIChkaXNwbGF5cykge1xuICAgICAgZGlzcGxheXMgPSBkaXNwbGF5cyB8fCBbXTtcbiAgICAgIHZhciBkaXNwbGF5SWQ7XG4gICAgICB2YXIgY29ubmVjdGVkRGlzcGxheSA9IHByZWZlcnJlZERpc3BsYXlJZCA/IGRpc3BsYXlzLmZpbHRlcihmdW5jdGlvbiAoZGlzcGxheSkge1xuICAgICAgICBkaXNwbGF5SWQgPSBzZWxmLmdldERpc3BsYXlJZChkaXNwbGF5KTtcbiAgICAgICAgaWYgKGRpc3BsYXlJZCAmJiBkaXNwbGF5SWQgPT09IHByZWZlcnJlZERpc3BsYXlJZCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KTtcbiAgICAgICAgfVxuICAgICAgfSlbMF0gOiBudWxsO1xuICAgICAgY29ubmVjdGVkRGlzcGxheSA9IGNvbm5lY3RlZERpc3BsYXkgfHwgZGlzcGxheXMuZmlsdGVyKGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgICAgIHJldHVybiBzZWxmLmlzRGlzcGxheUNvbm5lY3RlZChkaXNwbGF5KTtcbiAgICAgIH0pWzBdIHx8IGRlZmF1bHREaXNwbGF5IHx8IG51bGw7XG4gICAgICBzZWxmLnNldENvbm5lY3RlZERpc3BsYXkoY29ubmVjdGVkRGlzcGxheSk7XG4gICAgICByZXR1cm4gY29ubmVjdGVkRGlzcGxheTtcbiAgICB9XG4gIH0pO1xufTtcblxudmFyIHdlYnZyQWdlbnQgPSBuZXcgV2VidnJBZ2VudCgpO1xuXG53ZWJ2ckFnZW50LnJlYWR5KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gIHZhciBwcmVzZW50aW5nRGlzcGxheSA9IHJlc3VsdFswXTtcbiAgdmFyIHByb3h5ID0gcmVzdWx0WzFdO1xuXG4gIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gQWdlbnQgcmVhZHknKTtcbiAgaWYgKHByZXNlbnRpbmdEaXNwbGF5KSB7XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBQcmVzZW50aW5nIHRvIFZSIGRpc3BsYXkgXCIlc1wiIChpZDogJXMpJyxcbiAgICAgIHdlYnZyQWdlbnQuZ2V0RGlzcGxheU5hbWUocHJlc2VudGluZ0Rpc3BsYXkpLFxuICAgICAgd2VidnJBZ2VudC5nZXREaXNwbGF5SWQocHJlc2VudGluZ0Rpc3BsYXkpKTtcbiAgfVxuICBpZiAocHJveHkpIHtcbiAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIE1lc3NhZ2UtcHJveHkgKCVzKSByZWFkeScsIHByb3h5Lm5hbWUpO1xuICB9XG4gIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gVXNpbmcgaWZyYW1lJywgd2VidnJBZ2VudC5pZnJhbWUpO1xuXG4gIGlmICghcHJlc2VudGluZ0Rpc3BsYXkpIHtcbiAgICB3ZWJ2ckFnZW50LmdldENvbm5lY3RlZERpc3BsYXkoKS50aGVuKGZ1bmN0aW9uIChjb25uZWN0ZWREaXNwbGF5KSB7XG4gICAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIEZvdW5kIGNvbm5lY3RlZCBWUiBkaXNwbGF5OiAlcyAoSUQ6ICVzOyBzbHVnOiAlcyknLFxuICAgICAgICB3ZWJ2ckFnZW50LmdldERpc3BsYXlOYW1lKGNvbm5lY3RlZERpc3BsYXkpLFxuICAgICAgICB3ZWJ2ckFnZW50LmdldERpc3BsYXlJZChjb25uZWN0ZWREaXNwbGF5KSxcbiAgICAgICAgd2VidnJBZ2VudC5nZXREaXNwbGF5U2x1Zyhjb25uZWN0ZWREaXNwbGF5KSk7XG4gICAgfSk7XG4gIH1cbn0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgY29uc29sZS5lcnJvcignW3dlYnZyLWFnZW50XVtjbGllbnRdIEVycm9yJyArXG4gICAgKGVyciAmJiBlcnIubWVzc2FnZSA/ICc6ICcgKyBlcnIubWVzc2FnZSA6ICcnKSk7XG59KTtcblxuaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICBkZWZpbmUoJ3dlYnZyLWFnZW50Jywgd2VidnJBZ2VudCk7XG59IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICBtb2R1bGUuZXhwb3J0cyA9IHdlYnZyQWdlbnQ7XG59IGVsc2UgaWYgKHdpbmRvdykge1xuICB3aW5kb3cud2VidnJBZ2VudCA9IHdlYnZyQWdlbnQ7XG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3B1YmxpYy9jbGllbnQuanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(process) {/* global process, require, URL */\n\nvar SCENE_ORIGIN = window.location.origin || (window.location.protocol + '//' + window.location.host);\nvar ORIGIN = '';\ntry {\n  ORIGIN = new URL(window.location.href).origin;\n} catch (e) {\n  ORIGIN = SCENE_ORIGIN;\n}\n// var WEBVR_AGENT_ORIGIN = window.location.protocol + '//' + window.location.hostname + ':4040';\n// var WEBVR_AGENT_ORIGIN_PROD = 'https://agent.webvr.rocks';\nvar IS_PROD = process.env.NODE_ENV === 'production';\nvar SITE_URL = (window.location.search.match(/[?&]url=(.+)/) || [])[1];\nvar SITE_ORIGIN = '*';\ntry {\n  SITE_ORIGIN = new URL(SITE_URL).origin;\n} catch (e) {\n}\nvar BOUNDING_CLIENT_RECT_KEYS = ['bottom', 'height', 'left', 'right', 'top', 'width'];\n\nvar ariaListbox = __webpack_require__(3);\n// var feathers = require('feathers-client');\n// var Frdialogmodal = require('fr-dialogmodal');\n\nconst Frdialogmodal = function ({\n    selector: selector = '.js-fr-dialogmodal',\n    modalSelector: modalSelector = '.js-fr-dialogmodal-modal',\n    openSelector: openSelector = '.js-fr-dialogmodal-open',\n    closeSelector: closeSelector = '.js-fr-dialogmodal-close',\n    isAlert: isAlert = false,\n    readyClass: readyClass = 'fr-dialogmodal--is-ready',\n    activeClass: activeClass = 'fr-dialogmodal--is-active'\n  } = {}) {\n\n\n  // CONSTANTS\n  const doc = document;\n  const docEl = doc.documentElement;\n  const _q = (el, ctx = doc) => [].slice.call(ctx.querySelectorAll(el));\n\n\n  // SUPPORTS\n  if (!('querySelector' in doc) || !('addEventListener' in window) || !docEl.classList) return;\n\n\n  // SETUP\n  // set dialog modal element NodeLists\n  const containers = _q(selector);\n  const focusableSelectors = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])'];\n  //  TEMP\n  let currButtonOpen = null;\n  let currModal = null;\n  //  elements within modal\n  let focusableElements = null;\n\n\n  //  UTILS\n  function _defer (fn) {\n    //  wrapped in setTimeout to delay binding until previous rendering has completed\n    if (typeof fn === 'function') setTimeout(fn, 0);\n  }\n\n\n  //  A11Y\n  function _addA11y (container) {\n    let modal = _q(modalSelector, container)[0];\n    let role = isAlert ? 'alertdialog' : 'dialog';\n    //  add relevant roles and properties\n    container.setAttribute('aria-hidden', true);\n    modal.setAttribute('role', role);\n  }\n  function _removeA11y (container) {\n    let modal = _q(modalSelector, container)[0];\n    //  add relevant roles and properties\n    container.removeAttribute('aria-hidden');\n    modal.removeAttribute('role');\n  }\n\n\n  //  ACTIONS\n  function _showModal (container, modal) {\n    //  show container and focus the modal\n    container.setAttribute('aria-hidden', false);\n    modal.setAttribute('tabindex', -1);\n    //  set first/last focusable elements\n    focusableElements = _q(focusableSelectors.join(), modal);\n    //  focus first element if exists, otherwise focus modal element\n    if (focusableElements.length) focusableElements[0].focus();\n    else modal.focus();\n    //  update bound events\n    _defer(_bindDocKey);\n    _defer(_bindClosePointer);\n    //  if contents are not interactive, bind click off\n    if (!isAlert) _defer(_bindContainerPointer);\n    //  reset scroll\n    modal.scrollTop = 0;\n    //  update style hook\n    container.classList.add(activeClass);\n  }\n  function _hideModal (modal, returnfocus = true) {\n    //  get container element\n    let container = modal.parentElement;\n    //  show container and focus the modal\n    container.setAttribute('aria-hidden', true);\n    modal.removeAttribute('tabindex');\n    //  update bound events\n    _unbindDocKey();\n    _unbindClosePointer();\n    //  if contents are not interactive, unbind click off\n    if (!isAlert) _unbindContainerPointer();\n    //  update style hook\n    container.classList.remove(activeClass);\n    //  return focus to button that opened the modal and reset the reference\n    if (returnfocus) {\n      currButtonOpen.focus();\n      currButtonOpen = null;\n    }\n  }\n  function _handleTabEvent (e) {\n    //  get the index of the current active element within the modal\n    let focusedIndex = focusableElements.indexOf(doc.activeElement);\n    //  handle TAB event if need to skip\n    //  if first element is focused and shiftkey is in use\n    if (e.shiftKey && (focusedIndex === 0 || focusedIndex === -1)) {\n      //  focus last item within modal\n      focusableElements[focusableElements.length - 1].focus();\n      e.preventDefault();\n    //  if last element is focused and shiftkey is not in use\n    } else if (!e.shiftKey && focusedIndex === focusableElements.length - 1) {\n      //  focus first item within modal\n      focusableElements[0].focus();\n      e.preventDefault();\n    }\n  }\n\n\n  //  EVENTS\n  function _eventOpenPointer (e) {\n    //  get related elements\n    let button = e.currentTarget;\n    let container = doc.getElementById(button.getAttribute('aria-controls'));\n    let modal = _q(modalSelector, container)[0];\n    //  save element references\n    currButtonOpen = button;\n    currModal = modal;\n    //  show modal\n    _showModal(container, modal);\n  }\n  function _eventClosePointer () {\n    _hideModal(currModal);\n  }\n  function _eventContainerPointer (e) {\n    let container = currModal.parentElement;\n    //  check if target is modal container (but not modal)\n    if (e.target === container) _hideModal(currModal);\n  }\n  function _eventDocKey (e) {\n    //  ESC key\n    if (e.keyCode === 27) _hideModal(currModal);\n    //  TAB key\n    if (e.keyCode === 9) _handleTabEvent(e);\n  }\n\n\n  //  BIND EVENTS\n  function _bindOpenPointers (container) {\n    let id = container.getAttribute('id');\n    let buttons = _q(`${openSelector}[aria-controls=\"${id}\"]`);\n    buttons.forEach(button => button.addEventListener('click', _eventOpenPointer));\n  }\n  function _bindClosePointer (modal = currModal) {\n    let button = _q(closeSelector, modal)[0];\n    button.addEventListener('click', _eventClosePointer);\n  }\n  function _bindContainerPointer (modal = currModal) {\n    let container = modal.parentElement;\n    container.addEventListener('click', _eventContainerPointer);\n  }\n  function _bindDocKey () {\n    doc.addEventListener('keydown', _eventDocKey);\n  }\n\n\n  //  UNBIND EVENTS\n  function _unbindOpenPointers (container) {\n    let id = container.getAttribute('id');\n    let buttons = doc.querySelectorAll(`${openSelector}[aria-controls=\"${id}\"]`);\n    buttons.forEach(button => button.removeEventListener('click', _eventOpenPointer));\n  }\n  function _unbindClosePointer (modal = currModal) {\n    let button = _q(closeSelector, modal)[0];\n    button.removeEventListener('click', _eventClosePointer);\n  }\n  function _unbindContainerPointer () {\n    let container = currModal.parentElement;\n    container.removeEventListener('click', _eventContainerPointer);\n  }\n  function _unbindDocKey () {\n    doc.removeEventListener('keydown', _eventDocKey);\n  }\n\n\n  //  DESTROY\n  function destroy () {\n    //  loop through available modals\n    containers.forEach(container => {\n      let modal = _q(modalSelector, container)[0];\n      modal.removeAttribute('tabindex');\n      _removeA11y(container);\n      _unbindOpenPointers(container);\n      _unbindClosePointer(modal);\n      _unbindContainerPointer(modal);\n      //  remove ready, active style hooks\n      container.classList.remove(readyClass, activeClass);\n    });\n    _unbindDocKey();\n  }\n\n\n  //  INIT\n  function init () {\n    //  cancel if no modals found\n    if (!containers.length) return;\n    //  loop through available modals\n    containers.forEach(container => {\n      _addA11y(container);\n      _bindOpenPointers(container);\n      // set ready style hook\n      container.classList.add(readyClass);\n    });\n  }\n  init();\n\n\n  // REVEAL API\n  return {\n    init,\n    destroy\n  }\n\n}\n\nvar toArray = function (items) {\n  return Array.prototype.slice.call(items);\n};\n\n/* Adapted from source: https://github.com/jonathantneal/document-promises/blob/master/document-promises.es6 */\nvar doc = {};\ndoc.loaded = new Promise(function (resolve) {\n  var listener = function () {\n    if (document.readyState === 'complete') {\n      document.removeEventListener('readystatechange', listener);\n      resolve();\n    }\n  };\n  document.addEventListener('readystatechange', listener);\n  listener();\n});\ndoc.parsed = new Promise(function (resolve) {\n  var listener = function () {\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      document.removeEventListener('readystatechange', listener);\n      resolve();\n    }\n  };\n  document.addEventListener('readystatechange', listener);\n  listener();\n});\ndoc.contentLoaded = new Promise(function (resolve) {\n  var listener = function () {\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      document.removeEventListener('DOMContentLoaded', listener);\n      resolve();\n    }\n  };\n  document.addEventListener('DOMContentLoaded', listener);\n  listener();\n});\n\nvar webvrAgentHost = {\n  originHost: SITE_ORIGIN,\n  steam: {\n    username: null,\n    password: null,\n    authenticated: false,\n    friends: [],\n    matches: []\n  },\n  state: {\n    displays: [],\n    displaysById: {},\n    displaysConnected: [],\n    displaysConnectedBySlug: {},\n    displaysPresenting: [],\n    displaysPresentingBySlug: {}\n  },\n  keys: {\n    esc: 27,\n    i: 73,\n    c: 67,\n    f: 70,\n    v: 86\n  },\n  headsetsPresentTimeout: 10000  // Timeout for showing VR status `<iframe>` (time in milliseconds [default: 10 seconds]).\n};\nwindow.webvrAgentHost = webvrAgentHost;\nwebvrAgentHost.updateState = function (displayId, displayState) {\n  displayId = String(displayId);\n  displayState = displayState || {};\n  var display = webvrAgentHost.state.displaysById[displayId];\n  var newDisplayState = Object.assign({}, display, displayState);\n  var otherDisplayState = {};\n  if (display) {\n    webvrAgentHost.state.displays[display._idx] = newDisplayState;\n    webvrAgentHost.state.displaysById[displayId] = newDisplayState;\n  } else {\n    newDisplayState._idx = webvrAgentHost.state.displays.push(newDisplayState);\n    webvrAgentHost.state.displaysById[displayId] = newDisplayState;\n  }\n  webvrAgentHost.state.displaysConnected = [];\n  webvrAgentHost.state.displaysConnectedBySlug = {};\n  webvrAgentHost.state.displaysPresenting = [];\n  webvrAgentHost.state.displaysPresentingBySlug = {};\n  Object.keys(webvrAgentHost.state.displays).forEach(function (otherDisplayId) {\n    otherDisplayState = webvrAgentHost.state.displays[otherDisplayId];\n    if (otherDisplayState.isConnected) {\n      webvrAgentHost.state.displaysConnected.push(otherDisplayState);\n      if (webvrAgentHost.state.displaysConnectedBySlug[otherDisplayState.displaySlug]) {\n        webvrAgentHost.state.displaysConnectedBySlug[otherDisplayState.displaySlug].push(otherDisplayState);\n      } else {\n        webvrAgentHost.state.displaysConnectedBySlug[otherDisplayState.displaySlug] = [otherDisplayState];\n      }\n    }\n    if (otherDisplayState.isPresenting) {\n      webvrAgentHost.state.displaysPresenting.push(otherDisplayState);\n      if (webvrAgentHost.state.displaysPresentingBySlug[otherDisplayState.displaySlug]) {\n        webvrAgentHost.state.displaysPresentingBySlug[otherDisplayState.displaySlug].push(otherDisplayState);\n      } else {\n        webvrAgentHost.state.displaysPresentingBySlug[otherDisplayState.displaySlug] = [otherDisplayState];\n      }\n    }\n  });\n  return webvrAgentHost.state;\n};\nwebvrAgentHost.state.displayIsConnected = function (headsetSlug) {\n  return !!(webvrAgentHost.state.displaysConnectedBySlug[headsetSlug] &&\n            webvrAgentHost.state.displaysConnectedBySlug[headsetSlug].length);\n};\nwebvrAgentHost.state.displayIsPresenting = function (headsetSlug) {\n  return !!(webvrAgentHost.state.displaysPresentingBySlug[headsetSlug] &&\n            webvrAgentHost.state.displaysPresentingBySlug[headsetSlug].length);\n};\nwebvrAgentHost.getDisplayId = function (display) {\n  if (display) {\n    if ('displayId' in display) {\n      return String(display.displayId);\n    }\n    if ('id' in display) {\n      return String(display.id);\n    }\n  }\n  return null;\n};\nwebvrAgentHost.getDisplayName = function (display) {\n  if (display) {\n    if ('displayName' in display) {\n      return display.displayName;\n    }\n    if ('name' in display) {\n      return display.name;\n    }\n  }\n  return null;\n};\nwebvrAgentHost.postMessage = function (msg, origin) {\n  var self = this;\n  if (typeof msg !== 'object') {\n    throw new Error('`msg` must be an object for calls to `WebvrAgent#postMessage`');\n  }\n  if (window.parent === window) {\n    // Not in an `<iframe>`.\n    return Promise.reject(new Error('Message-proxy iframe not found'));\n  }\n  Object.assign(msg, {src: 'webvr-agent'});\n  window.top.postMessage(msg, origin || self.originHost);\n};\n\nvar url = function (key, params) {\n  params = params || {};\n  if (key === 'manifest') {\n    if (params.url) {\n      return ORIGIN + '/manifest?url=' + params.url;\n    }\n  }\n  return ORIGIN;\n};\n\nif (IS_PROD && 'serviceWorker' in navigator) {\n  // Check if the application is installed by checking the controller.\n  // If there is a Service Worker controlling this page, then let's\n  // assume the application is installed.\n  navigator.serviceWorker.getRegistration().then(function (registration) {\n    if (!registration || !registration.active) {\n      return;\n    }\n    console.log('[webvr-agent][host] Service Worker already active');\n    swLoad();\n  });\n\n  // During installation, once the Service Worker is active, we show\n  // the image dynamic loader.\n  navigator.serviceWorker.addEventListener('controllerchange', function () {\n    this.controller.addEventListener('statechange', function () {\n      if (this.state !== 'activated') {\n        return;\n      }\n      swLoad();\n    });\n    if (!navigator.serviceWorker.controller) {\n      return;\n    }\n    console.log('[webvr-agent][host] Service Worker installed');\n    swLoad();\n  });\n  navigator.serviceWorker.register('service-worker.js');\n}\n\nfunction swLoad () {\n  console.log('[webvr-agent][host] Service Worker loaded');\n}\n\nfunction xhrJSON (opts) {\n  if (typeof opts === 'string') {\n    opts = {url: opts};\n  }\n  opts = opts || {};\n  opts.method = opts.method || 'get';\n  if (typeof opts.data === 'object') {\n    opts.data = JSON.stringify(opts.data);\n  }\n  return new Promise(function (resolve, reject) {\n    var xhr = new XMLHttpRequest();\n    xhr.open(opts.method, opts.url, 'true');\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.addEventListener('load', function () {\n      var data = {};\n      try {\n        // NOTE: Not parsing as JSON using `XMLHttpRequest#responseType` because of incomplete browser support.\n        data = JSON.parse(xhr.responseText || '{}');\n      } catch (e) {\n      }\n      resolve(data);\n    });\n    xhr.addEventListener('error', reject);\n    xhr.send(opts.data);\n  });\n}\n\nfunction removeHash () {\n  window.history.replaceState({}, document.title, window.location.pathname +\n    window.location.search);\n}\n\nfunction sendDisplayRequestPresentMsg (opts) {\n  if (window.parent === window) {\n    return;\n  }\n  opts = opts || {};\n  webvrAgentHost.postMessage({\n    action: 'display-request-present',\n    displaySlug: opts.displaySlug,\n    displayId: opts.displayId,\n    displayName: opts.displayName\n  });\n}\n\nfunction sendDisplayExitPresentMsg (opts) {\n  if (window.parent === window) {\n    return;\n  }\n  opts = opts || {};\n  webvrAgentHost.postMessage({\n    action: 'display-exit-present',\n    displaySlug: opts.displaySlug,\n    displayId: opts.displayId,\n    displayName: opts.displayName\n  }, ORIGIN);\n}\n\nfunction getSiblings (el, sel) {\n  var parentEl = el.parentNode;\n  if (!parentEl) {\n    return [];\n  }\n  sel = sel || '*';\n  var siblings = toArray(parentEl.querySelectorAll(sel));\n  return Array.prototype.filter.call(siblings, function (el) {\n    if (el.parentNode !== parentEl) {\n      return;\n    }\n    if (!sel || (el.matches && el.matches(sel))) {\n      return el;\n    }\n  });\n}\n\nfunction getBoundingClientRectObject (el) {\n  if (!el) {\n    return {};\n  }\n\n  var rect;\n  try {\n    rect = el.getBoundingClientRect();\n  } catch (err) {\n    return {};\n  }\n\n  var obj = {};\n  BOUNDING_CLIENT_RECT_KEYS.forEach(function (key) {\n    if (typeof rect[key] === 'number') {\n      obj[key] = Math.ceil(rect[key]) + 'px';\n    } else {\n      obj[key] = rect[key];\n    }\n  });\n  return obj;\n}\n\ndoc.loaded.then(function () {\n  var html = document.documentElement;\n  var supportsTouch = 'ontouchstart' in window;\n  var hash = window.location.hash;\n  var hashKey = 'data-aria-expanded__' + hashId;\n  // var steamModal = Frdialogmodal();\n  var toggleCloseEl;\n  var toggleInfoEl;\n  var webvrAgentEl = document.querySelector('#webvr-agent');\n  var webvrAgentHeadsetsEl = webvrAgentEl.querySelector('#webvr-agent-headsets');\n\n  var getHeight = function () {\n    return html.getClientRects()[0].height;\n  };\n\n  var getToggleVRButtonDimensions = function () {\n    return getBoundingClientRectObject(toggleVRButtonEl);\n  };\n\n  var hashId = hash.substr(1);\n\n  var defaultHeight = getHeight() + 10;\n  var expandedHeight = 160;\n  var lastSentHeight = null;\n\n  var toggleVRButtonEl = webvrAgentEl.querySelector('#webvr-agent-headsets-controls');\n  var defaultToggleVRButtonDimensions = getToggleVRButtonDimensions();\n  var lastSentToggleVRButtonDimensions = null;\n\n  html.dataset.supportsTouch = supportsTouch;\n\n  window.addEventListener('resize', function () {\n    sendResizeIframeMsg();\n    sendResizeToggleVRButtonMsg();\n  });\n\n  // steamModal.init();\n\n  window.addEventListener('beforeunload', function () {\n    // steamModal.destroy();\n  });\n\n  sendResizeIframeMsg(defaultHeight);\n\n  sendResizeToggleVRButtonMsg(defaultToggleVRButtonDimensions);\n\n  function sendResizeIframeMsg (height, origin) {\n    if (window.parent === window) {\n      return;\n    }\n    if (typeof height === 'undefined') {\n      height = getHeight();\n    }\n    if (height === lastSentHeight) {\n      return;\n    }\n    webvrAgentHost.postMessage({\n      action: 'resize-iframe',\n      height: height + 'px'\n    }, SITE_ORIGIN);\n    lastSentHeight = height;\n    return height;\n  }\n\n  function sendResizeToggleVRButtonMsg (dimensions, origin) {\n    if (window.parent === window) {\n      return;\n    }\n    if (typeof dimensions === 'undefined') {\n      dimensions = getToggleVRButtonDimensions();\n    }\n    if (dimensions === lastSentToggleVRButtonDimensions) {\n      return;\n    }\n    webvrAgentHost.postMessage({\n      action: 'resize-toggle-vr-button',\n      dimensions: dimensions\n    }, origin || SITE_ORIGIN);\n    lastSentToggleVRButtonDimensions = dimensions;\n    return dimensions;\n  }\n\n  sendResizeToggleVRButtonMsg();\n\n  function handleExpanders (evt, hash) {\n    hash = hash || window.location.hash;\n    if (!hash) {\n      return;\n    }\n    hashId = hash.substr(1);\n    hashKey = 'data-aria-expanded__' + hashId;\n    toggleCloseEl = toggleInfoEl = null;\n    var el = document.querySelector(hash);\n    var ariaExpandedState = html.getAttribute(hashKey) || null;\n    if (!el ||\n        (el.matches && el.matches(':empty')) ||\n        !document.querySelector('[aria-expands=\"' + hashId + '\"]')) {\n      return;\n    }\n    ariaExpandedState = (el.getAttribute('aria-expanded') || '').trim().toLowerCase();\n    ariaExpandedState = ariaExpandedState === 'true' ? true : false;\n    if (ariaExpandedState !== null) {\n      if (evt) {\n        evt.preventDefault();\n      }\n      ariaExpandedState = !ariaExpandedState;\n      html.setAttribute(hashKey, ariaExpandedState);\n      el.setAttribute('aria-expanded', ariaExpandedState);\n      toggleCloseEl = getSiblings(el, '[aria-roledescription=\"close\"]')[0];\n      toggleInfoEl = getSiblings(el, '[aria-roledescription=\"info\"]')[0];\n      if (toggleCloseEl && toggleInfoEl) {\n        if (ariaExpandedState) {\n          toggleCloseEl.setAttribute('aria-expanded', true);\n          toggleInfoEl.setAttribute('aria-expanded', false);\n          sendResizeIframeMsg(expandedHeight);\n        } else {\n          toggleCloseEl.setAttribute('aria-expanded', false);\n          toggleInfoEl.setAttribute('aria-expanded', true);\n          sendResizeIframeMsg(defaultHeight);\n        }\n        setTimeout(function () {\n          sendResizeIframeMsg();\n        }, 500);\n      }\n      removeHash();\n    }\n  }\n\n  window.addEventListener('hashchange', handleExpanders);\n  handleExpanders();\n\n  xhrJSON(url('manifest', {url: SITE_URL})).then(function (manifest) {\n    if (!manifest || !manifest.name) {\n      return;\n    }\n\n    webvrAgentEl.classList.remove('loading');\n\n    var image = webvrAgentEl.querySelector('.webvr-agent-image[data-setAttribute-href]');\n    var imageStyleBackgroundImage = image.getAttribute('data-style-backgroundImage');\n    var imageStyleBackgroundImageObject = manifest[imageStyleBackgroundImage];\n    if (imageStyleBackgroundImageObject) {\n      var imageStyleBackgroundImageValue = manifest[imageStyleBackgroundImage].src;\n      image.style.backgroundImage = `url(${imageStyleBackgroundImageValue})`;\n    }\n\n    var imageHrefKey = image.getAttribute('data-setAttribute-href');\n    var imageHrefValue = manifest[imageHrefKey];\n    if (imageHrefValue) {\n      image.setAttribute('href', imageHrefValue);\n    }\n\n    var name = webvrAgentEl.querySelector('.webvr-agent-name[data-textContent]');\n    var nameTextContentKey = name.getAttribute('data-textContent');\n    var nameValue = manifest[nameTextContentKey];\n    if (nameValue) {\n      name.textContent = nameValue;\n    }\n\n    var description = webvrAgentEl.querySelector('.webvr-agent-description[data-textContent]');\n    var descriptionTextContentKey = description.getAttribute('data-textContent');\n    var descriptionValue = manifest[descriptionTextContentKey];\n    if (descriptionValue) {\n      description.insertAdjacentText('afterbegin', descriptionValue);\n    } else {\n      webvrAgentEl.querySelector('[aria-expands=\"webvr-agent-description\"]').removeAttribute('aria-expands');\n    }\n\n    webvrAgentHost.postMessage({\n      action: 'loaded',\n      url: window.location.href\n    });\n  });\n\n  window.addEventListener('keyup', function (evt) {\n    if (evt.target !== document.body || evt.shiftKey || evt.metaKey || evt.altKey || evt.ctrlKey) {\n      return;\n    }\n    if (evt.keyCode === webvrAgentHost.keys.esc) {  // `Esc` key.\n      console.log('[webvr-agent][client] `Esc` key pressed');\n      if (webvrAgentHost.state.displaysConnected) {\n        if (webvrAgentHost.state.displaysPresenting.length) {\n          sendDisplayExitPresentMsg();\n        }\n      }\n      closeInfo();\n    } else if (evt.keyCode === webvrAgentHost.keys.i) {  // `i` key.\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `i` key pressed');\n      toggleInfo();\n    } else if (evt.keyCode === webvrAgentHost.keys.c) {  // `c` key.\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `c` key pressed');\n      closeInfo();\n    } else if (evt.keyCode === webvrAgentHost.keys.v) {\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `v` key pressed');\n      if (webvrAgentHost.state.displaysConnected) {\n        if (webvrAgentHost.state.displaysPresenting.length) {\n          sendDisplayExitPresentMsg();\n        } else {\n          sendDisplayRequestPresentMsg();\n        }\n      }\n    } else if (evt.keyCode === webvrAgentHost.keys.f) {\n      evt.preventDefault();\n      console.log('[webvr-agent][client] `f` key pressed');\n      if (webvrAgentHost.state.displaysConnected) {\n        if (webvrAgentHost.state.displaysPresenting.length) {\n          sendDisplayExitPresentMsg();\n        } else {\n          sendDisplayRequestPresentMsg();\n        }\n      }\n    }\n  });\n\n  var headsetsControlsEl = webvrAgentEl.querySelector('#webvr-agent-headsets-controls');\n  if (headsetsControlsEl) {\n    ariaListbox(headsetsControlsEl, {\n      nextKeys: [\n        's',\n        'd',\n        37,\n        38\n      ],\n      prevKeys: [\n        'a',\n        'w',\n        39,\n        40\n      ]\n    });\n  }\n\n  document.body.addEventListener('click', function (evt) {\n    var el = evt.target;\n\n    if (!el || !el.closest) {\n      return;\n    }\n\n    if (el.closest('#webvr-agent-details') ||\n        el.closest('#webvr-agent-description')) {\n      var ariaExpandsEls = webvrAgentEl.querySelectorAll('[aria-expands]');\n      Array.prototype.forEach.call(ariaExpandsEls, function (el) {\n        handleExpanders(evt, '#' + el.getAttribute('aria-expands'));\n      });\n    } else {\n      var closedInfo = closeInfo();\n      if (closedInfo) {\n        return;\n      }\n    }\n\n    if (el.closest('[data-headset-slug]')) {\n      var displayId = el.closest('[data-headset-slug]').getAttribute('data-headset-id');\n      var display = webvrAgentHost.state.displaysById[displayId];\n      var displayOpts = {\n        displaySlug: el.getAttribute('data-headset-slug'),\n        displayName: el.getAttribute('data-headset-name'),\n        displayId: displayId,\n        isConnected: display && 'isConnected' in display ? display.isConnected : false,\n        isPresenting: display && 'isPresenting' in display ? display.isPresenting : false\n      };\n      if (displayOpts.isPresenting) {\n        sendDisplayExitPresentMsg(displayOpts);\n      } else if (displayOpts.isConnected) {\n        sendDisplayRequestPresentMsg(displayOpts);\n      }\n      return;\n    }\n\n    if (el.closest('#webvr-agent-steam-link')) {\n      evt.preventDefault();\n      el.blur();\n      document.documentElement.focus();\n      // TODO: Authenticate against REST API (`/steam/auth`).\n    }\n  });\n\n  var steamForm = document.querySelector('#webvr-agent-form-steam');\n  steamForm.addEventListener('submit', function (evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n    webvrAgentHost.steam.username = steamForm.querySelector('input[name=\"steam_username\"]').value;\n    // webvrAgentHost.steam.password = steamForm.querySelector('input[name=\"steam_password\"]').value;\n    document.querySelector('.webvr-agent-steam-label').textContent = 'Signed in as cvanw';\n    console.log(webvrAgentHost.steam);\n    webvrAgentHost.postMessage({\n      action: 'steam-user-authenticated',\n      username: webvrAgentHost.steam.username,\n      src: 'webvr-agent'\n    }, SITE_ORIGIN);\n    if (document.activeElement) {\n      document.activeElement.blur();\n    }\n    document.body.focus();\n  });\n\n  function closeInfo () {\n    var closeEl = document.querySelector('#webvr-agent-details-toggle-close[aria-expanded=\"true\"]');\n    if (closeEl) {\n      console.log('[webvr-agent][client] Hiding description');\n      closeEl.click();\n      return true;\n    }\n    return false;\n  }\n\n  function openInfo () {\n    var openEl = document.querySelector('#webvr-agent-details-toggle-info[aria-expanded=\"true\"]');\n    if (openEl) {\n      console.log('[webvr-agent][client] Opening description');\n      openEl.click();\n      return true;\n    }\n    return false;\n  }\n\n  function toggleInfo () {\n    console.log('[webvr-agent][client] Toggling description');\n    var toggleEl = document.querySelector('.webvr-agent-details-toggle[aria-expanded=\"true\"]');\n    if (toggleEl) {\n      toggleEl.click();\n      return true;\n    }\n    return false;\n  }\n\n  var headsetsPresentEl = webvrAgentEl.querySelector('#webvr-agent-headsets-present');\n\n  function updateHeadsets (connectedDisplayIfAvailable, retry) {\n    if (typeof retry === 'undefined') {\n      retry = true;\n    }\n\n    var headsetEls = webvrAgentEl.querySelectorAll('[data-headset-slug]');\n\n    Array.prototype.forEach.call(headsetEls, function (el) {\n      var headsetSlug = el.getAttribute('data-headset-slug');\n      var headsetLabelEnterVREl = el.querySelector('.webvr-agent-headset-label-enter-vr');\n      var headsetLabelExitVREl = el.querySelector('.webvr-agent-headset-label-exit-vr');\n      var displayIsConnected = webvrAgentHost.state.displayIsConnected(headsetSlug);\n      var displayIsPresenting = webvrAgentHost.state.displayIsPresenting(headsetSlug);\n      if (connectedDisplayIfAvailable && connectedDisplayIfAvailable.displaySlug === headsetSlug) {\n        el.setAttribute('data-headset-id', connectedDisplayIfAvailable.displayId);\n        el.setAttribute('data-headset-name', connectedDisplayIfAvailable.displayName);\n        el.setAttribute('title', connectedDisplayIfAvailable.displayName);\n      }\n      el.setAttribute('data-headset-connected', displayIsConnected);\n      el.setAttribute('data-headset-presenting', displayIsPresenting);\n      el.setAttribute('data-headset-ready', displayIsConnected && !displayIsPresenting);\n      el.setAttribute('data-headset-timeout', displayIsConnected);\n      el.setAttribute('aria-hidden', displayIsConnected || displayIsPresenting ? 'false' : 'true');\n      if (headsetLabelEnterVREl) {\n        headsetLabelEnterVREl.setAttribute('aria-hidden', displayIsPresenting ? 'true' : 'false');\n      }\n      if (headsetLabelExitVREl) {\n        headsetLabelExitVREl.setAttribute('aria-hidden', displayIsPresenting ? 'false' : 'true');\n      }\n    });\n\n    var anyDisplaysConnected = webvrAgentHost.state.displaysConnected.length > 0;\n    var anyDisplaysPresenting = webvrAgentHost.state.displaysPresenting.length > 0;\n\n    var jsonDisplaysConnected = JSON.stringify(webvrAgentHost.state.displaysConnected);\n\n    if (anyDisplaysConnected) {\n      html.setAttribute('data-connected-displays', jsonDisplaysConnected);\n      html.setAttribute('data-missing-displays', 'false');\n      html.setAttribute('data-timeout-displays', 'false');\n    } else {\n      html.removeAttribute('data-connected-displays');\n      headsetsPresentEl.innerHTML = 'Detecting VR headset&hellip;';\n    }\n\n    if (anyDisplaysPresenting) {\n      var jsonDisplaysPresenting = JSON.stringify(webvrAgentHost.state.displaysPresenting);\n      html.setAttribute('data-presenting-displays', jsonDisplaysPresenting);\n      html.removeAttribute('data-ready-displays');\n      html.setAttribute('data-missing-displays', 'false');\n      headsetsPresentEl.innerHTML = '';\n    } else {\n      html.removeAttribute('data-presenting-displays');\n      if (anyDisplaysConnected) {\n        html.setAttribute('data-ready-displays', jsonDisplaysConnected);\n        headsetsPresentEl.innerHTML = '';\n      } else if (!retry) {\n        html.setAttribute('data-missing-displays', 'true');\n        html.removeAttribute('data-ready-displays');\n        headsetsPresentEl.innerHTML = 'No VR headset detected';\n      }\n    }\n\n    if (retry) {\n      setTimeout(function () {\n        updateHeadsets(connectedDisplayIfAvailable, false);\n      }, webvrAgentHost.headsetsPresentTimeout);\n    }\n  }\n\n  function updateDisplayConnected (displayState) {\n    webvrAgentHost.updateState(displayState.displayId, displayState);\n\n    updateHeadsets(displayState);\n  }\n\n  function updateDisplayDisconnected (displayState) {\n    webvrAgentHost.updateState(displayState.displayId, displayState);\n\n    updateHeadsets();\n  }\n\n  function updateDisplayPresentStart (displayState) {\n    webvrAgentHost.updateState(displayState.displayId, displayState);\n\n    updateHeadsets(displayState);\n  }\n\n  function updateDisplayPresentEnd (displayState) {\n    webvrAgentHost.updateState(displayState.displayId, displayState);\n\n    updateHeadsets();\n  }\n\n  window.addEventListener('message', function (evt) {\n    var data = evt.data;\n    var action = data.action;\n    var src = data.src;\n    if (src !== 'webvr-agent') {\n      return;\n    }\n    if (action === 'loaded') {\n      updateHeadsets();\n    } else if (action === 'open-info') {\n      openInfo();\n    } else if (action === 'close-info') {\n      closeInfo();\n    } else if (action === 'toggle-info') {\n      toggleInfo();\n    } else if (action === 'display-connected') {\n      updateDisplayConnected(data);\n    } else if (action === 'display-disconnected') {\n      updateDisplayDisconnected(data);\n    } else if (action === 'display-present-start') {\n      updateDisplayPresentStart(data);\n    } else if (action === 'display-present-end') {\n      updateDisplayPresentEnd(data);\n    } else if (action === 'mouseenter-toggle-vr-button') {\n      if (webvrAgentHeadsetsEl) {\n        webvrAgentHeadsetsEl.classList.add('hover');\n      }\n    } else if (action === 'mouseleave-toggle-vr-button') {\n      if (webvrAgentHeadsetsEl) {\n        webvrAgentHeadsetsEl.classList.remove('hover');\n      }\n    }\n  });\n});\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wdWJsaWMvaG9zdC5qcz9lYjBkIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxLQUFLOzs7QUFHUjtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsYUFBYSxrQkFBa0IsR0FBRztBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGFBQWEsa0JBQWtCLEdBQUc7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixtQkFBbUI7QUFDekM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQ7QUFDakQsT0FBTztBQUNQO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsMkJBQTJCLGNBQWM7QUFDekM7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsK0JBQStCO0FBQzFFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRDtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssa0RBQWtEO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBLEtBQUssa0RBQWtEO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsaUVBQWlFO0FBQ2pFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILENBQUMiLCJmaWxlIjoiMi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBwcm9jZXNzLCByZXF1aXJlLCBVUkwgKi9cblxudmFyIFNDRU5FX09SSUdJTiA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gfHwgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCk7XG52YXIgT1JJR0lOID0gJyc7XG50cnkge1xuICBPUklHSU4gPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKS5vcmlnaW47XG59IGNhdGNoIChlKSB7XG4gIE9SSUdJTiA9IFNDRU5FX09SSUdJTjtcbn1cbi8vIHZhciBXRUJWUl9BR0VOVF9PUklHSU4gPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgJzo0MDQwJztcbi8vIHZhciBXRUJWUl9BR0VOVF9PUklHSU5fUFJPRCA9ICdodHRwczovL2FnZW50LndlYnZyLnJvY2tzJztcbnZhciBJU19QUk9EID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJztcbnZhciBTSVRFX1VSTCA9ICh3aW5kb3cubG9jYXRpb24uc2VhcmNoLm1hdGNoKC9bPyZddXJsPSguKykvKSB8fCBbXSlbMV07XG52YXIgU0lURV9PUklHSU4gPSAnKic7XG50cnkge1xuICBTSVRFX09SSUdJTiA9IG5ldyBVUkwoU0lURV9VUkwpLm9yaWdpbjtcbn0gY2F0Y2ggKGUpIHtcbn1cbnZhciBCT1VORElOR19DTElFTlRfUkVDVF9LRVlTID0gWydib3R0b20nLCAnaGVpZ2h0JywgJ2xlZnQnLCAncmlnaHQnLCAndG9wJywgJ3dpZHRoJ107XG5cbnZhciBhcmlhTGlzdGJveCA9IHJlcXVpcmUoJ2FyaWEtbGlzdGJveCcpO1xuLy8gdmFyIGZlYXRoZXJzID0gcmVxdWlyZSgnZmVhdGhlcnMtY2xpZW50Jyk7XG4vLyB2YXIgRnJkaWFsb2dtb2RhbCA9IHJlcXVpcmUoJ2ZyLWRpYWxvZ21vZGFsJyk7XG5cbmNvbnN0IEZyZGlhbG9nbW9kYWwgPSBmdW5jdGlvbiAoe1xuICAgIHNlbGVjdG9yOiBzZWxlY3RvciA9ICcuanMtZnItZGlhbG9nbW9kYWwnLFxuICAgIG1vZGFsU2VsZWN0b3I6IG1vZGFsU2VsZWN0b3IgPSAnLmpzLWZyLWRpYWxvZ21vZGFsLW1vZGFsJyxcbiAgICBvcGVuU2VsZWN0b3I6IG9wZW5TZWxlY3RvciA9ICcuanMtZnItZGlhbG9nbW9kYWwtb3BlbicsXG4gICAgY2xvc2VTZWxlY3RvcjogY2xvc2VTZWxlY3RvciA9ICcuanMtZnItZGlhbG9nbW9kYWwtY2xvc2UnLFxuICAgIGlzQWxlcnQ6IGlzQWxlcnQgPSBmYWxzZSxcbiAgICByZWFkeUNsYXNzOiByZWFkeUNsYXNzID0gJ2ZyLWRpYWxvZ21vZGFsLS1pcy1yZWFkeScsXG4gICAgYWN0aXZlQ2xhc3M6IGFjdGl2ZUNsYXNzID0gJ2ZyLWRpYWxvZ21vZGFsLS1pcy1hY3RpdmUnXG4gIH0gPSB7fSkge1xuXG5cbiAgLy8gQ09OU1RBTlRTXG4gIGNvbnN0IGRvYyA9IGRvY3VtZW50O1xuICBjb25zdCBkb2NFbCA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG4gIGNvbnN0IF9xID0gKGVsLCBjdHggPSBkb2MpID0+IFtdLnNsaWNlLmNhbGwoY3R4LnF1ZXJ5U2VsZWN0b3JBbGwoZWwpKTtcblxuXG4gIC8vIFNVUFBPUlRTXG4gIGlmICghKCdxdWVyeVNlbGVjdG9yJyBpbiBkb2MpIHx8ICEoJ2FkZEV2ZW50TGlzdGVuZXInIGluIHdpbmRvdykgfHwgIWRvY0VsLmNsYXNzTGlzdCkgcmV0dXJuO1xuXG5cbiAgLy8gU0VUVVBcbiAgLy8gc2V0IGRpYWxvZyBtb2RhbCBlbGVtZW50IE5vZGVMaXN0c1xuICBjb25zdCBjb250YWluZXJzID0gX3Eoc2VsZWN0b3IpO1xuICBjb25zdCBmb2N1c2FibGVTZWxlY3RvcnMgPSBbJ2FbaHJlZl0nLCAnYXJlYVtocmVmXScsICdpbnB1dDpub3QoW2Rpc2FibGVkXSknLCAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKScsICdpZnJhbWUnLCAnb2JqZWN0JywgJ2VtYmVkJywgJ1tjb250ZW50ZWRpdGFibGVdJywgJ1t0YWJpbmRleF06bm90KFt0YWJpbmRleF49XCItXCJdKSddO1xuICAvLyAgVEVNUFxuICBsZXQgY3VyckJ1dHRvbk9wZW4gPSBudWxsO1xuICBsZXQgY3Vyck1vZGFsID0gbnVsbDtcbiAgLy8gIGVsZW1lbnRzIHdpdGhpbiBtb2RhbFxuICBsZXQgZm9jdXNhYmxlRWxlbWVudHMgPSBudWxsO1xuXG5cbiAgLy8gIFVUSUxTXG4gIGZ1bmN0aW9uIF9kZWZlciAoZm4pIHtcbiAgICAvLyAgd3JhcHBlZCBpbiBzZXRUaW1lb3V0IHRvIGRlbGF5IGJpbmRpbmcgdW50aWwgcHJldmlvdXMgcmVuZGVyaW5nIGhhcyBjb21wbGV0ZWRcbiAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSBzZXRUaW1lb3V0KGZuLCAwKTtcbiAgfVxuXG5cbiAgLy8gIEExMVlcbiAgZnVuY3Rpb24gX2FkZEExMXkgKGNvbnRhaW5lcikge1xuICAgIGxldCBtb2RhbCA9IF9xKG1vZGFsU2VsZWN0b3IsIGNvbnRhaW5lcilbMF07XG4gICAgbGV0IHJvbGUgPSBpc0FsZXJ0ID8gJ2FsZXJ0ZGlhbG9nJyA6ICdkaWFsb2cnO1xuICAgIC8vICBhZGQgcmVsZXZhbnQgcm9sZXMgYW5kIHByb3BlcnRpZXNcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgIG1vZGFsLnNldEF0dHJpYnV0ZSgncm9sZScsIHJvbGUpO1xuICB9XG4gIGZ1bmN0aW9uIF9yZW1vdmVBMTF5IChjb250YWluZXIpIHtcbiAgICBsZXQgbW9kYWwgPSBfcShtb2RhbFNlbGVjdG9yLCBjb250YWluZXIpWzBdO1xuICAgIC8vICBhZGQgcmVsZXZhbnQgcm9sZXMgYW5kIHByb3BlcnRpZXNcbiAgICBjb250YWluZXIucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWhpZGRlbicpO1xuICAgIG1vZGFsLnJlbW92ZUF0dHJpYnV0ZSgncm9sZScpO1xuICB9XG5cblxuICAvLyAgQUNUSU9OU1xuICBmdW5jdGlvbiBfc2hvd01vZGFsIChjb250YWluZXIsIG1vZGFsKSB7XG4gICAgLy8gIHNob3cgY29udGFpbmVyIGFuZCBmb2N1cyB0aGUgbW9kYWxcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcbiAgICBtb2RhbC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgLTEpO1xuICAgIC8vICBzZXQgZmlyc3QvbGFzdCBmb2N1c2FibGUgZWxlbWVudHNcbiAgICBmb2N1c2FibGVFbGVtZW50cyA9IF9xKGZvY3VzYWJsZVNlbGVjdG9ycy5qb2luKCksIG1vZGFsKTtcbiAgICAvLyAgZm9jdXMgZmlyc3QgZWxlbWVudCBpZiBleGlzdHMsIG90aGVyd2lzZSBmb2N1cyBtb2RhbCBlbGVtZW50XG4gICAgaWYgKGZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCkgZm9jdXNhYmxlRWxlbWVudHNbMF0uZm9jdXMoKTtcbiAgICBlbHNlIG1vZGFsLmZvY3VzKCk7XG4gICAgLy8gIHVwZGF0ZSBib3VuZCBldmVudHNcbiAgICBfZGVmZXIoX2JpbmREb2NLZXkpO1xuICAgIF9kZWZlcihfYmluZENsb3NlUG9pbnRlcik7XG4gICAgLy8gIGlmIGNvbnRlbnRzIGFyZSBub3QgaW50ZXJhY3RpdmUsIGJpbmQgY2xpY2sgb2ZmXG4gICAgaWYgKCFpc0FsZXJ0KSBfZGVmZXIoX2JpbmRDb250YWluZXJQb2ludGVyKTtcbiAgICAvLyAgcmVzZXQgc2Nyb2xsXG4gICAgbW9kYWwuc2Nyb2xsVG9wID0gMDtcbiAgICAvLyAgdXBkYXRlIHN0eWxlIGhvb2tcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChhY3RpdmVDbGFzcyk7XG4gIH1cbiAgZnVuY3Rpb24gX2hpZGVNb2RhbCAobW9kYWwsIHJldHVybmZvY3VzID0gdHJ1ZSkge1xuICAgIC8vICBnZXQgY29udGFpbmVyIGVsZW1lbnRcbiAgICBsZXQgY29udGFpbmVyID0gbW9kYWwucGFyZW50RWxlbWVudDtcbiAgICAvLyAgc2hvdyBjb250YWluZXIgYW5kIGZvY3VzIHRoZSBtb2RhbFxuICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgbW9kYWwucmVtb3ZlQXR0cmlidXRlKCd0YWJpbmRleCcpO1xuICAgIC8vICB1cGRhdGUgYm91bmQgZXZlbnRzXG4gICAgX3VuYmluZERvY0tleSgpO1xuICAgIF91bmJpbmRDbG9zZVBvaW50ZXIoKTtcbiAgICAvLyAgaWYgY29udGVudHMgYXJlIG5vdCBpbnRlcmFjdGl2ZSwgdW5iaW5kIGNsaWNrIG9mZlxuICAgIGlmICghaXNBbGVydCkgX3VuYmluZENvbnRhaW5lclBvaW50ZXIoKTtcbiAgICAvLyAgdXBkYXRlIHN0eWxlIGhvb2tcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShhY3RpdmVDbGFzcyk7XG4gICAgLy8gIHJldHVybiBmb2N1cyB0byBidXR0b24gdGhhdCBvcGVuZWQgdGhlIG1vZGFsIGFuZCByZXNldCB0aGUgcmVmZXJlbmNlXG4gICAgaWYgKHJldHVybmZvY3VzKSB7XG4gICAgICBjdXJyQnV0dG9uT3Blbi5mb2N1cygpO1xuICAgICAgY3VyckJ1dHRvbk9wZW4gPSBudWxsO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBfaGFuZGxlVGFiRXZlbnQgKGUpIHtcbiAgICAvLyAgZ2V0IHRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBhY3RpdmUgZWxlbWVudCB3aXRoaW4gdGhlIG1vZGFsXG4gICAgbGV0IGZvY3VzZWRJbmRleCA9IGZvY3VzYWJsZUVsZW1lbnRzLmluZGV4T2YoZG9jLmFjdGl2ZUVsZW1lbnQpO1xuICAgIC8vICBoYW5kbGUgVEFCIGV2ZW50IGlmIG5lZWQgdG8gc2tpcFxuICAgIC8vICBpZiBmaXJzdCBlbGVtZW50IGlzIGZvY3VzZWQgYW5kIHNoaWZ0a2V5IGlzIGluIHVzZVxuICAgIGlmIChlLnNoaWZ0S2V5ICYmIChmb2N1c2VkSW5kZXggPT09IDAgfHwgZm9jdXNlZEluZGV4ID09PSAtMSkpIHtcbiAgICAgIC8vICBmb2N1cyBsYXN0IGl0ZW0gd2l0aGluIG1vZGFsXG4gICAgICBmb2N1c2FibGVFbGVtZW50c1tmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLSAxXS5mb2N1cygpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vICBpZiBsYXN0IGVsZW1lbnQgaXMgZm9jdXNlZCBhbmQgc2hpZnRrZXkgaXMgbm90IGluIHVzZVxuICAgIH0gZWxzZSBpZiAoIWUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSBmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLSAxKSB7XG4gICAgICAvLyAgZm9jdXMgZmlyc3QgaXRlbSB3aXRoaW4gbW9kYWxcbiAgICAgIGZvY3VzYWJsZUVsZW1lbnRzWzBdLmZvY3VzKCk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG5cblxuICAvLyAgRVZFTlRTXG4gIGZ1bmN0aW9uIF9ldmVudE9wZW5Qb2ludGVyIChlKSB7XG4gICAgLy8gIGdldCByZWxhdGVkIGVsZW1lbnRzXG4gICAgbGV0IGJ1dHRvbiA9IGUuY3VycmVudFRhcmdldDtcbiAgICBsZXQgY29udGFpbmVyID0gZG9jLmdldEVsZW1lbnRCeUlkKGJ1dHRvbi5nZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnKSk7XG4gICAgbGV0IG1vZGFsID0gX3EobW9kYWxTZWxlY3RvciwgY29udGFpbmVyKVswXTtcbiAgICAvLyAgc2F2ZSBlbGVtZW50IHJlZmVyZW5jZXNcbiAgICBjdXJyQnV0dG9uT3BlbiA9IGJ1dHRvbjtcbiAgICBjdXJyTW9kYWwgPSBtb2RhbDtcbiAgICAvLyAgc2hvdyBtb2RhbFxuICAgIF9zaG93TW9kYWwoY29udGFpbmVyLCBtb2RhbCk7XG4gIH1cbiAgZnVuY3Rpb24gX2V2ZW50Q2xvc2VQb2ludGVyICgpIHtcbiAgICBfaGlkZU1vZGFsKGN1cnJNb2RhbCk7XG4gIH1cbiAgZnVuY3Rpb24gX2V2ZW50Q29udGFpbmVyUG9pbnRlciAoZSkge1xuICAgIGxldCBjb250YWluZXIgPSBjdXJyTW9kYWwucGFyZW50RWxlbWVudDtcbiAgICAvLyAgY2hlY2sgaWYgdGFyZ2V0IGlzIG1vZGFsIGNvbnRhaW5lciAoYnV0IG5vdCBtb2RhbClcbiAgICBpZiAoZS50YXJnZXQgPT09IGNvbnRhaW5lcikgX2hpZGVNb2RhbChjdXJyTW9kYWwpO1xuICB9XG4gIGZ1bmN0aW9uIF9ldmVudERvY0tleSAoZSkge1xuICAgIC8vICBFU0Mga2V5XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMjcpIF9oaWRlTW9kYWwoY3Vyck1vZGFsKTtcbiAgICAvLyAgVEFCIGtleVxuICAgIGlmIChlLmtleUNvZGUgPT09IDkpIF9oYW5kbGVUYWJFdmVudChlKTtcbiAgfVxuXG5cbiAgLy8gIEJJTkQgRVZFTlRTXG4gIGZ1bmN0aW9uIF9iaW5kT3BlblBvaW50ZXJzIChjb250YWluZXIpIHtcbiAgICBsZXQgaWQgPSBjb250YWluZXIuZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAgIGxldCBidXR0b25zID0gX3EoYCR7b3BlblNlbGVjdG9yfVthcmlhLWNvbnRyb2xzPVwiJHtpZH1cIl1gKTtcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF9ldmVudE9wZW5Qb2ludGVyKSk7XG4gIH1cbiAgZnVuY3Rpb24gX2JpbmRDbG9zZVBvaW50ZXIgKG1vZGFsID0gY3Vyck1vZGFsKSB7XG4gICAgbGV0IGJ1dHRvbiA9IF9xKGNsb3NlU2VsZWN0b3IsIG1vZGFsKVswXTtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfZXZlbnRDbG9zZVBvaW50ZXIpO1xuICB9XG4gIGZ1bmN0aW9uIF9iaW5kQ29udGFpbmVyUG9pbnRlciAobW9kYWwgPSBjdXJyTW9kYWwpIHtcbiAgICBsZXQgY29udGFpbmVyID0gbW9kYWwucGFyZW50RWxlbWVudDtcbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfZXZlbnRDb250YWluZXJQb2ludGVyKTtcbiAgfVxuICBmdW5jdGlvbiBfYmluZERvY0tleSAoKSB7XG4gICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBfZXZlbnREb2NLZXkpO1xuICB9XG5cblxuICAvLyAgVU5CSU5EIEVWRU5UU1xuICBmdW5jdGlvbiBfdW5iaW5kT3BlblBvaW50ZXJzIChjb250YWluZXIpIHtcbiAgICBsZXQgaWQgPSBjb250YWluZXIuZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAgIGxldCBidXR0b25zID0gZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoYCR7b3BlblNlbGVjdG9yfVthcmlhLWNvbnRyb2xzPVwiJHtpZH1cIl1gKTtcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIF9ldmVudE9wZW5Qb2ludGVyKSk7XG4gIH1cbiAgZnVuY3Rpb24gX3VuYmluZENsb3NlUG9pbnRlciAobW9kYWwgPSBjdXJyTW9kYWwpIHtcbiAgICBsZXQgYnV0dG9uID0gX3EoY2xvc2VTZWxlY3RvciwgbW9kYWwpWzBdO1xuICAgIGJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIF9ldmVudENsb3NlUG9pbnRlcik7XG4gIH1cbiAgZnVuY3Rpb24gX3VuYmluZENvbnRhaW5lclBvaW50ZXIgKCkge1xuICAgIGxldCBjb250YWluZXIgPSBjdXJyTW9kYWwucGFyZW50RWxlbWVudDtcbiAgICBjb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfZXZlbnRDb250YWluZXJQb2ludGVyKTtcbiAgfVxuICBmdW5jdGlvbiBfdW5iaW5kRG9jS2V5ICgpIHtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIF9ldmVudERvY0tleSk7XG4gIH1cblxuXG4gIC8vICBERVNUUk9ZXG4gIGZ1bmN0aW9uIGRlc3Ryb3kgKCkge1xuICAgIC8vICBsb29wIHRocm91Z2ggYXZhaWxhYmxlIG1vZGFsc1xuICAgIGNvbnRhaW5lcnMuZm9yRWFjaChjb250YWluZXIgPT4ge1xuICAgICAgbGV0IG1vZGFsID0gX3EobW9kYWxTZWxlY3RvciwgY29udGFpbmVyKVswXTtcbiAgICAgIG1vZGFsLnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcbiAgICAgIF9yZW1vdmVBMTF5KGNvbnRhaW5lcik7XG4gICAgICBfdW5iaW5kT3BlblBvaW50ZXJzKGNvbnRhaW5lcik7XG4gICAgICBfdW5iaW5kQ2xvc2VQb2ludGVyKG1vZGFsKTtcbiAgICAgIF91bmJpbmRDb250YWluZXJQb2ludGVyKG1vZGFsKTtcbiAgICAgIC8vICByZW1vdmUgcmVhZHksIGFjdGl2ZSBzdHlsZSBob29rc1xuICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUocmVhZHlDbGFzcywgYWN0aXZlQ2xhc3MpO1xuICAgIH0pO1xuICAgIF91bmJpbmREb2NLZXkoKTtcbiAgfVxuXG5cbiAgLy8gIElOSVRcbiAgZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgLy8gIGNhbmNlbCBpZiBubyBtb2RhbHMgZm91bmRcbiAgICBpZiAoIWNvbnRhaW5lcnMubGVuZ3RoKSByZXR1cm47XG4gICAgLy8gIGxvb3AgdGhyb3VnaCBhdmFpbGFibGUgbW9kYWxzXG4gICAgY29udGFpbmVycy5mb3JFYWNoKGNvbnRhaW5lciA9PiB7XG4gICAgICBfYWRkQTExeShjb250YWluZXIpO1xuICAgICAgX2JpbmRPcGVuUG9pbnRlcnMoY29udGFpbmVyKTtcbiAgICAgIC8vIHNldCByZWFkeSBzdHlsZSBob29rXG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChyZWFkeUNsYXNzKTtcbiAgICB9KTtcbiAgfVxuICBpbml0KCk7XG5cblxuICAvLyBSRVZFQUwgQVBJXG4gIHJldHVybiB7XG4gICAgaW5pdCxcbiAgICBkZXN0cm95XG4gIH1cblxufVxuXG52YXIgdG9BcnJheSA9IGZ1bmN0aW9uIChpdGVtcykge1xuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoaXRlbXMpO1xufTtcblxuLyogQWRhcHRlZCBmcm9tIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2pvbmF0aGFudG5lYWwvZG9jdW1lbnQtcHJvbWlzZXMvYmxvYi9tYXN0ZXIvZG9jdW1lbnQtcHJvbWlzZXMuZXM2ICovXG52YXIgZG9jID0ge307XG5kb2MubG9hZGVkID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgbGlzdGVuZXIpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH1cbiAgfTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGxpc3RlbmVyKTtcbiAgbGlzdGVuZXIoKTtcbn0pO1xuZG9jLnBhcnNlZCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJyB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgbGlzdGVuZXIpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH1cbiAgfTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGxpc3RlbmVyKTtcbiAgbGlzdGVuZXIoKTtcbn0pO1xuZG9jLmNvbnRlbnRMb2FkZWQgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdpbnRlcmFjdGl2ZScgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGxpc3RlbmVyKTtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9XG4gIH07XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBsaXN0ZW5lcik7XG4gIGxpc3RlbmVyKCk7XG59KTtcblxudmFyIHdlYnZyQWdlbnRIb3N0ID0ge1xuICBvcmlnaW5Ib3N0OiBTSVRFX09SSUdJTixcbiAgc3RlYW06IHtcbiAgICB1c2VybmFtZTogbnVsbCxcbiAgICBwYXNzd29yZDogbnVsbCxcbiAgICBhdXRoZW50aWNhdGVkOiBmYWxzZSxcbiAgICBmcmllbmRzOiBbXSxcbiAgICBtYXRjaGVzOiBbXVxuICB9LFxuICBzdGF0ZToge1xuICAgIGRpc3BsYXlzOiBbXSxcbiAgICBkaXNwbGF5c0J5SWQ6IHt9LFxuICAgIGRpc3BsYXlzQ29ubmVjdGVkOiBbXSxcbiAgICBkaXNwbGF5c0Nvbm5lY3RlZEJ5U2x1Zzoge30sXG4gICAgZGlzcGxheXNQcmVzZW50aW5nOiBbXSxcbiAgICBkaXNwbGF5c1ByZXNlbnRpbmdCeVNsdWc6IHt9XG4gIH0sXG4gIGtleXM6IHtcbiAgICBlc2M6IDI3LFxuICAgIGk6IDczLFxuICAgIGM6IDY3LFxuICAgIGY6IDcwLFxuICAgIHY6IDg2XG4gIH0sXG4gIGhlYWRzZXRzUHJlc2VudFRpbWVvdXQ6IDEwMDAwICAvLyBUaW1lb3V0IGZvciBzaG93aW5nIFZSIHN0YXR1cyBgPGlmcmFtZT5gICh0aW1lIGluIG1pbGxpc2Vjb25kcyBbZGVmYXVsdDogMTAgc2Vjb25kc10pLlxufTtcbndpbmRvdy53ZWJ2ckFnZW50SG9zdCA9IHdlYnZyQWdlbnRIb3N0O1xud2VidnJBZ2VudEhvc3QudXBkYXRlU3RhdGUgPSBmdW5jdGlvbiAoZGlzcGxheUlkLCBkaXNwbGF5U3RhdGUpIHtcbiAgZGlzcGxheUlkID0gU3RyaW5nKGRpc3BsYXlJZCk7XG4gIGRpc3BsYXlTdGF0ZSA9IGRpc3BsYXlTdGF0ZSB8fCB7fTtcbiAgdmFyIGRpc3BsYXkgPSB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c0J5SWRbZGlzcGxheUlkXTtcbiAgdmFyIG5ld0Rpc3BsYXlTdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIGRpc3BsYXksIGRpc3BsYXlTdGF0ZSk7XG4gIHZhciBvdGhlckRpc3BsYXlTdGF0ZSA9IHt9O1xuICBpZiAoZGlzcGxheSkge1xuICAgIHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzW2Rpc3BsYXkuX2lkeF0gPSBuZXdEaXNwbGF5U3RhdGU7XG4gICAgd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNCeUlkW2Rpc3BsYXlJZF0gPSBuZXdEaXNwbGF5U3RhdGU7XG4gIH0gZWxzZSB7XG4gICAgbmV3RGlzcGxheVN0YXRlLl9pZHggPSB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5cy5wdXNoKG5ld0Rpc3BsYXlTdGF0ZSk7XG4gICAgd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNCeUlkW2Rpc3BsYXlJZF0gPSBuZXdEaXNwbGF5U3RhdGU7XG4gIH1cbiAgd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNDb25uZWN0ZWQgPSBbXTtcbiAgd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNDb25uZWN0ZWRCeVNsdWcgPSB7fTtcbiAgd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNQcmVzZW50aW5nID0gW107XG4gIHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzUHJlc2VudGluZ0J5U2x1ZyA9IHt9O1xuICBPYmplY3Qua2V5cyh3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5cykuZm9yRWFjaChmdW5jdGlvbiAob3RoZXJEaXNwbGF5SWQpIHtcbiAgICBvdGhlckRpc3BsYXlTdGF0ZSA9IHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzW290aGVyRGlzcGxheUlkXTtcbiAgICBpZiAob3RoZXJEaXNwbGF5U3RhdGUuaXNDb25uZWN0ZWQpIHtcbiAgICAgIHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzQ29ubmVjdGVkLnB1c2gob3RoZXJEaXNwbGF5U3RhdGUpO1xuICAgICAgaWYgKHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzQ29ubmVjdGVkQnlTbHVnW290aGVyRGlzcGxheVN0YXRlLmRpc3BsYXlTbHVnXSkge1xuICAgICAgICB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c0Nvbm5lY3RlZEJ5U2x1Z1tvdGhlckRpc3BsYXlTdGF0ZS5kaXNwbGF5U2x1Z10ucHVzaChvdGhlckRpc3BsYXlTdGF0ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c0Nvbm5lY3RlZEJ5U2x1Z1tvdGhlckRpc3BsYXlTdGF0ZS5kaXNwbGF5U2x1Z10gPSBbb3RoZXJEaXNwbGF5U3RhdGVdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3RoZXJEaXNwbGF5U3RhdGUuaXNQcmVzZW50aW5nKSB7XG4gICAgICB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c1ByZXNlbnRpbmcucHVzaChvdGhlckRpc3BsYXlTdGF0ZSk7XG4gICAgICBpZiAod2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNQcmVzZW50aW5nQnlTbHVnW290aGVyRGlzcGxheVN0YXRlLmRpc3BsYXlTbHVnXSkge1xuICAgICAgICB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c1ByZXNlbnRpbmdCeVNsdWdbb3RoZXJEaXNwbGF5U3RhdGUuZGlzcGxheVNsdWddLnB1c2gob3RoZXJEaXNwbGF5U3RhdGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNQcmVzZW50aW5nQnlTbHVnW290aGVyRGlzcGxheVN0YXRlLmRpc3BsYXlTbHVnXSA9IFtvdGhlckRpc3BsYXlTdGF0ZV07XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHdlYnZyQWdlbnRIb3N0LnN0YXRlO1xufTtcbndlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlJc0Nvbm5lY3RlZCA9IGZ1bmN0aW9uIChoZWFkc2V0U2x1Zykge1xuICByZXR1cm4gISEod2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNDb25uZWN0ZWRCeVNsdWdbaGVhZHNldFNsdWddICYmXG4gICAgICAgICAgICB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c0Nvbm5lY3RlZEJ5U2x1Z1toZWFkc2V0U2x1Z10ubGVuZ3RoKTtcbn07XG53ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5SXNQcmVzZW50aW5nID0gZnVuY3Rpb24gKGhlYWRzZXRTbHVnKSB7XG4gIHJldHVybiAhISh3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c1ByZXNlbnRpbmdCeVNsdWdbaGVhZHNldFNsdWddICYmXG4gICAgICAgICAgICB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c1ByZXNlbnRpbmdCeVNsdWdbaGVhZHNldFNsdWddLmxlbmd0aCk7XG59O1xud2VidnJBZ2VudEhvc3QuZ2V0RGlzcGxheUlkID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgaWYgKGRpc3BsYXkpIHtcbiAgICBpZiAoJ2Rpc3BsYXlJZCcgaW4gZGlzcGxheSkge1xuICAgICAgcmV0dXJuIFN0cmluZyhkaXNwbGF5LmRpc3BsYXlJZCk7XG4gICAgfVxuICAgIGlmICgnaWQnIGluIGRpc3BsYXkpIHtcbiAgICAgIHJldHVybiBTdHJpbmcoZGlzcGxheS5pZCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcbndlYnZyQWdlbnRIb3N0LmdldERpc3BsYXlOYW1lID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgaWYgKGRpc3BsYXkpIHtcbiAgICBpZiAoJ2Rpc3BsYXlOYW1lJyBpbiBkaXNwbGF5KSB7XG4gICAgICByZXR1cm4gZGlzcGxheS5kaXNwbGF5TmFtZTtcbiAgICB9XG4gICAgaWYgKCduYW1lJyBpbiBkaXNwbGF5KSB7XG4gICAgICByZXR1cm4gZGlzcGxheS5uYW1lO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG53ZWJ2ckFnZW50SG9zdC5wb3N0TWVzc2FnZSA9IGZ1bmN0aW9uIChtc2csIG9yaWdpbikge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGlmICh0eXBlb2YgbXNnICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBFcnJvcignYG1zZ2AgbXVzdCBiZSBhbiBvYmplY3QgZm9yIGNhbGxzIHRvIGBXZWJ2ckFnZW50I3Bvc3RNZXNzYWdlYCcpO1xuICB9XG4gIGlmICh3aW5kb3cucGFyZW50ID09PSB3aW5kb3cpIHtcbiAgICAvLyBOb3QgaW4gYW4gYDxpZnJhbWU+YC5cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdNZXNzYWdlLXByb3h5IGlmcmFtZSBub3QgZm91bmQnKSk7XG4gIH1cbiAgT2JqZWN0LmFzc2lnbihtc2csIHtzcmM6ICd3ZWJ2ci1hZ2VudCd9KTtcbiAgd2luZG93LnRvcC5wb3N0TWVzc2FnZShtc2csIG9yaWdpbiB8fCBzZWxmLm9yaWdpbkhvc3QpO1xufTtcblxudmFyIHVybCA9IGZ1bmN0aW9uIChrZXksIHBhcmFtcykge1xuICBwYXJhbXMgPSBwYXJhbXMgfHwge307XG4gIGlmIChrZXkgPT09ICdtYW5pZmVzdCcpIHtcbiAgICBpZiAocGFyYW1zLnVybCkge1xuICAgICAgcmV0dXJuIE9SSUdJTiArICcvbWFuaWZlc3Q/dXJsPScgKyBwYXJhbXMudXJsO1xuICAgIH1cbiAgfVxuICByZXR1cm4gT1JJR0lOO1xufTtcblxuaWYgKElTX1BST0QgJiYgJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xuICAvLyBDaGVjayBpZiB0aGUgYXBwbGljYXRpb24gaXMgaW5zdGFsbGVkIGJ5IGNoZWNraW5nIHRoZSBjb250cm9sbGVyLlxuICAvLyBJZiB0aGVyZSBpcyBhIFNlcnZpY2UgV29ya2VyIGNvbnRyb2xsaW5nIHRoaXMgcGFnZSwgdGhlbiBsZXQnc1xuICAvLyBhc3N1bWUgdGhlIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZC5cbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuZ2V0UmVnaXN0cmF0aW9uKCkudGhlbihmdW5jdGlvbiAocmVnaXN0cmF0aW9uKSB7XG4gICAgaWYgKCFyZWdpc3RyYXRpb24gfHwgIXJlZ2lzdHJhdGlvbi5hY3RpdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1baG9zdF0gU2VydmljZSBXb3JrZXIgYWxyZWFkeSBhY3RpdmUnKTtcbiAgICBzd0xvYWQoKTtcbiAgfSk7XG5cbiAgLy8gRHVyaW5nIGluc3RhbGxhdGlvbiwgb25jZSB0aGUgU2VydmljZSBXb3JrZXIgaXMgYWN0aXZlLCB3ZSBzaG93XG4gIC8vIHRoZSBpbWFnZSBkeW5hbWljIGxvYWRlci5cbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNvbnRyb2xsZXIuYWRkRXZlbnRMaXN0ZW5lcignc3RhdGVjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2FjdGl2YXRlZCcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgc3dMb2FkKCk7XG4gICAgfSk7XG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2hvc3RdIFNlcnZpY2UgV29ya2VyIGluc3RhbGxlZCcpO1xuICAgIHN3TG9hZCgpO1xuICB9KTtcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3NlcnZpY2Utd29ya2VyLmpzJyk7XG59XG5cbmZ1bmN0aW9uIHN3TG9hZCAoKSB7XG4gIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2hvc3RdIFNlcnZpY2UgV29ya2VyIGxvYWRlZCcpO1xufVxuXG5mdW5jdGlvbiB4aHJKU09OIChvcHRzKSB7XG4gIGlmICh0eXBlb2Ygb3B0cyA9PT0gJ3N0cmluZycpIHtcbiAgICBvcHRzID0ge3VybDogb3B0c307XG4gIH1cbiAgb3B0cyA9IG9wdHMgfHwge307XG4gIG9wdHMubWV0aG9kID0gb3B0cy5tZXRob2QgfHwgJ2dldCc7XG4gIGlmICh0eXBlb2Ygb3B0cy5kYXRhID09PSAnb2JqZWN0Jykge1xuICAgIG9wdHMuZGF0YSA9IEpTT04uc3RyaW5naWZ5KG9wdHMuZGF0YSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgeGhyLm9wZW4ob3B0cy5tZXRob2QsIG9wdHMudXJsLCAndHJ1ZScpO1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIE5PVEU6IE5vdCBwYXJzaW5nIGFzIEpTT04gdXNpbmcgYFhNTEh0dHBSZXF1ZXN0I3Jlc3BvbnNlVHlwZWAgYmVjYXVzZSBvZiBpbmNvbXBsZXRlIGJyb3dzZXIgc3VwcG9ydC5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCB8fCAne30nKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgfSk7XG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgcmVqZWN0KTtcbiAgICB4aHIuc2VuZChvcHRzLmRhdGEpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlSGFzaCAoKSB7XG4gIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArXG4gICAgd2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG59XG5cbmZ1bmN0aW9uIHNlbmREaXNwbGF5UmVxdWVzdFByZXNlbnRNc2cgKG9wdHMpIHtcbiAgaWYgKHdpbmRvdy5wYXJlbnQgPT09IHdpbmRvdykge1xuICAgIHJldHVybjtcbiAgfVxuICBvcHRzID0gb3B0cyB8fCB7fTtcbiAgd2VidnJBZ2VudEhvc3QucG9zdE1lc3NhZ2Uoe1xuICAgIGFjdGlvbjogJ2Rpc3BsYXktcmVxdWVzdC1wcmVzZW50JyxcbiAgICBkaXNwbGF5U2x1Zzogb3B0cy5kaXNwbGF5U2x1ZyxcbiAgICBkaXNwbGF5SWQ6IG9wdHMuZGlzcGxheUlkLFxuICAgIGRpc3BsYXlOYW1lOiBvcHRzLmRpc3BsYXlOYW1lXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzZW5kRGlzcGxheUV4aXRQcmVzZW50TXNnIChvcHRzKSB7XG4gIGlmICh3aW5kb3cucGFyZW50ID09PSB3aW5kb3cpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb3B0cyA9IG9wdHMgfHwge307XG4gIHdlYnZyQWdlbnRIb3N0LnBvc3RNZXNzYWdlKHtcbiAgICBhY3Rpb246ICdkaXNwbGF5LWV4aXQtcHJlc2VudCcsXG4gICAgZGlzcGxheVNsdWc6IG9wdHMuZGlzcGxheVNsdWcsXG4gICAgZGlzcGxheUlkOiBvcHRzLmRpc3BsYXlJZCxcbiAgICBkaXNwbGF5TmFtZTogb3B0cy5kaXNwbGF5TmFtZVxuICB9LCBPUklHSU4pO1xufVxuXG5mdW5jdGlvbiBnZXRTaWJsaW5ncyAoZWwsIHNlbCkge1xuICB2YXIgcGFyZW50RWwgPSBlbC5wYXJlbnROb2RlO1xuICBpZiAoIXBhcmVudEVsKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIHNlbCA9IHNlbCB8fCAnKic7XG4gIHZhciBzaWJsaW5ncyA9IHRvQXJyYXkocGFyZW50RWwucXVlcnlTZWxlY3RvckFsbChzZWwpKTtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbChzaWJsaW5ncywgZnVuY3Rpb24gKGVsKSB7XG4gICAgaWYgKGVsLnBhcmVudE5vZGUgIT09IHBhcmVudEVsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghc2VsIHx8IChlbC5tYXRjaGVzICYmIGVsLm1hdGNoZXMoc2VsKSkpIHtcbiAgICAgIHJldHVybiBlbDtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRCb3VuZGluZ0NsaWVudFJlY3RPYmplY3QgKGVsKSB7XG4gIGlmICghZWwpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICB2YXIgcmVjdDtcbiAgdHJ5IHtcbiAgICByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIHZhciBvYmogPSB7fTtcbiAgQk9VTkRJTkdfQ0xJRU5UX1JFQ1RfS0VZUy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICBpZiAodHlwZW9mIHJlY3Rba2V5XSA9PT0gJ251bWJlcicpIHtcbiAgICAgIG9ialtrZXldID0gTWF0aC5jZWlsKHJlY3Rba2V5XSkgKyAncHgnO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYmpba2V5XSA9IHJlY3Rba2V5XTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gb2JqO1xufVxuXG5kb2MubG9hZGVkLnRoZW4oZnVuY3Rpb24gKCkge1xuICB2YXIgaHRtbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgdmFyIHN1cHBvcnRzVG91Y2ggPSAnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3c7XG4gIHZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gIHZhciBoYXNoS2V5ID0gJ2RhdGEtYXJpYS1leHBhbmRlZF9fJyArIGhhc2hJZDtcbiAgLy8gdmFyIHN0ZWFtTW9kYWwgPSBGcmRpYWxvZ21vZGFsKCk7XG4gIHZhciB0b2dnbGVDbG9zZUVsO1xuICB2YXIgdG9nZ2xlSW5mb0VsO1xuICB2YXIgd2VidnJBZ2VudEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3dlYnZyLWFnZW50Jyk7XG4gIHZhciB3ZWJ2ckFnZW50SGVhZHNldHNFbCA9IHdlYnZyQWdlbnRFbC5xdWVyeVNlbGVjdG9yKCcjd2VidnItYWdlbnQtaGVhZHNldHMnKTtcblxuICB2YXIgZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBodG1sLmdldENsaWVudFJlY3RzKClbMF0uaGVpZ2h0O1xuICB9O1xuXG4gIHZhciBnZXRUb2dnbGVWUkJ1dHRvbkRpbWVuc2lvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGdldEJvdW5kaW5nQ2xpZW50UmVjdE9iamVjdCh0b2dnbGVWUkJ1dHRvbkVsKTtcbiAgfTtcblxuICB2YXIgaGFzaElkID0gaGFzaC5zdWJzdHIoMSk7XG5cbiAgdmFyIGRlZmF1bHRIZWlnaHQgPSBnZXRIZWlnaHQoKSArIDEwO1xuICB2YXIgZXhwYW5kZWRIZWlnaHQgPSAxNjA7XG4gIHZhciBsYXN0U2VudEhlaWdodCA9IG51bGw7XG5cbiAgdmFyIHRvZ2dsZVZSQnV0dG9uRWwgPSB3ZWJ2ckFnZW50RWwucXVlcnlTZWxlY3RvcignI3dlYnZyLWFnZW50LWhlYWRzZXRzLWNvbnRyb2xzJyk7XG4gIHZhciBkZWZhdWx0VG9nZ2xlVlJCdXR0b25EaW1lbnNpb25zID0gZ2V0VG9nZ2xlVlJCdXR0b25EaW1lbnNpb25zKCk7XG4gIHZhciBsYXN0U2VudFRvZ2dsZVZSQnV0dG9uRGltZW5zaW9ucyA9IG51bGw7XG5cbiAgaHRtbC5kYXRhc2V0LnN1cHBvcnRzVG91Y2ggPSBzdXBwb3J0c1RvdWNoO1xuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2VuZFJlc2l6ZUlmcmFtZU1zZygpO1xuICAgIHNlbmRSZXNpemVUb2dnbGVWUkJ1dHRvbk1zZygpO1xuICB9KTtcblxuICAvLyBzdGVhbU1vZGFsLmluaXQoKTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgZnVuY3Rpb24gKCkge1xuICAgIC8vIHN0ZWFtTW9kYWwuZGVzdHJveSgpO1xuICB9KTtcblxuICBzZW5kUmVzaXplSWZyYW1lTXNnKGRlZmF1bHRIZWlnaHQpO1xuXG4gIHNlbmRSZXNpemVUb2dnbGVWUkJ1dHRvbk1zZyhkZWZhdWx0VG9nZ2xlVlJCdXR0b25EaW1lbnNpb25zKTtcblxuICBmdW5jdGlvbiBzZW5kUmVzaXplSWZyYW1lTXNnIChoZWlnaHQsIG9yaWdpbikge1xuICAgIGlmICh3aW5kb3cucGFyZW50ID09PSB3aW5kb3cpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBoZWlnaHQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBoZWlnaHQgPSBnZXRIZWlnaHQoKTtcbiAgICB9XG4gICAgaWYgKGhlaWdodCA9PT0gbGFzdFNlbnRIZWlnaHQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgd2VidnJBZ2VudEhvc3QucG9zdE1lc3NhZ2Uoe1xuICAgICAgYWN0aW9uOiAncmVzaXplLWlmcmFtZScsXG4gICAgICBoZWlnaHQ6IGhlaWdodCArICdweCdcbiAgICB9LCBTSVRFX09SSUdJTik7XG4gICAgbGFzdFNlbnRIZWlnaHQgPSBoZWlnaHQ7XG4gICAgcmV0dXJuIGhlaWdodDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNlbmRSZXNpemVUb2dnbGVWUkJ1dHRvbk1zZyAoZGltZW5zaW9ucywgb3JpZ2luKSB7XG4gICAgaWYgKHdpbmRvdy5wYXJlbnQgPT09IHdpbmRvdykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGRpbWVuc2lvbnMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBkaW1lbnNpb25zID0gZ2V0VG9nZ2xlVlJCdXR0b25EaW1lbnNpb25zKCk7XG4gICAgfVxuICAgIGlmIChkaW1lbnNpb25zID09PSBsYXN0U2VudFRvZ2dsZVZSQnV0dG9uRGltZW5zaW9ucykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB3ZWJ2ckFnZW50SG9zdC5wb3N0TWVzc2FnZSh7XG4gICAgICBhY3Rpb246ICdyZXNpemUtdG9nZ2xlLXZyLWJ1dHRvbicsXG4gICAgICBkaW1lbnNpb25zOiBkaW1lbnNpb25zXG4gICAgfSwgb3JpZ2luIHx8IFNJVEVfT1JJR0lOKTtcbiAgICBsYXN0U2VudFRvZ2dsZVZSQnV0dG9uRGltZW5zaW9ucyA9IGRpbWVuc2lvbnM7XG4gICAgcmV0dXJuIGRpbWVuc2lvbnM7XG4gIH1cblxuICBzZW5kUmVzaXplVG9nZ2xlVlJCdXR0b25Nc2coKTtcblxuICBmdW5jdGlvbiBoYW5kbGVFeHBhbmRlcnMgKGV2dCwgaGFzaCkge1xuICAgIGhhc2ggPSBoYXNoIHx8IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgIGlmICghaGFzaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBoYXNoSWQgPSBoYXNoLnN1YnN0cigxKTtcbiAgICBoYXNoS2V5ID0gJ2RhdGEtYXJpYS1leHBhbmRlZF9fJyArIGhhc2hJZDtcbiAgICB0b2dnbGVDbG9zZUVsID0gdG9nZ2xlSW5mb0VsID0gbnVsbDtcbiAgICB2YXIgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGhhc2gpO1xuICAgIHZhciBhcmlhRXhwYW5kZWRTdGF0ZSA9IGh0bWwuZ2V0QXR0cmlidXRlKGhhc2hLZXkpIHx8IG51bGw7XG4gICAgaWYgKCFlbCB8fFxuICAgICAgICAoZWwubWF0Y2hlcyAmJiBlbC5tYXRjaGVzKCc6ZW1wdHknKSkgfHxcbiAgICAgICAgIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1thcmlhLWV4cGFuZHM9XCInICsgaGFzaElkICsgJ1wiXScpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFyaWFFeHBhbmRlZFN0YXRlID0gKGVsLmdldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcpIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICBhcmlhRXhwYW5kZWRTdGF0ZSA9IGFyaWFFeHBhbmRlZFN0YXRlID09PSAndHJ1ZScgPyB0cnVlIDogZmFsc2U7XG4gICAgaWYgKGFyaWFFeHBhbmRlZFN0YXRlICE9PSBudWxsKSB7XG4gICAgICBpZiAoZXZ0KSB7XG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgICAgYXJpYUV4cGFuZGVkU3RhdGUgPSAhYXJpYUV4cGFuZGVkU3RhdGU7XG4gICAgICBodG1sLnNldEF0dHJpYnV0ZShoYXNoS2V5LCBhcmlhRXhwYW5kZWRTdGF0ZSk7XG4gICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBhcmlhRXhwYW5kZWRTdGF0ZSk7XG4gICAgICB0b2dnbGVDbG9zZUVsID0gZ2V0U2libGluZ3MoZWwsICdbYXJpYS1yb2xlZGVzY3JpcHRpb249XCJjbG9zZVwiXScpWzBdO1xuICAgICAgdG9nZ2xlSW5mb0VsID0gZ2V0U2libGluZ3MoZWwsICdbYXJpYS1yb2xlZGVzY3JpcHRpb249XCJpbmZvXCJdJylbMF07XG4gICAgICBpZiAodG9nZ2xlQ2xvc2VFbCAmJiB0b2dnbGVJbmZvRWwpIHtcbiAgICAgICAgaWYgKGFyaWFFeHBhbmRlZFN0YXRlKSB7XG4gICAgICAgICAgdG9nZ2xlQ2xvc2VFbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcbiAgICAgICAgICB0b2dnbGVJbmZvRWwuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgZmFsc2UpO1xuICAgICAgICAgIHNlbmRSZXNpemVJZnJhbWVNc2coZXhwYW5kZWRIZWlnaHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRvZ2dsZUNsb3NlRWwuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgZmFsc2UpO1xuICAgICAgICAgIHRvZ2dsZUluZm9FbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcbiAgICAgICAgICBzZW5kUmVzaXplSWZyYW1lTXNnKGRlZmF1bHRIZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNlbmRSZXNpemVJZnJhbWVNc2coKTtcbiAgICAgICAgfSwgNTAwKTtcbiAgICAgIH1cbiAgICAgIHJlbW92ZUhhc2goKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIGhhbmRsZUV4cGFuZGVycyk7XG4gIGhhbmRsZUV4cGFuZGVycygpO1xuXG4gIHhockpTT04odXJsKCdtYW5pZmVzdCcsIHt1cmw6IFNJVEVfVVJMfSkpLnRoZW4oZnVuY3Rpb24gKG1hbmlmZXN0KSB7XG4gICAgaWYgKCFtYW5pZmVzdCB8fCAhbWFuaWZlc3QubmFtZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHdlYnZyQWdlbnRFbC5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkaW5nJyk7XG5cbiAgICB2YXIgaW1hZ2UgPSB3ZWJ2ckFnZW50RWwucXVlcnlTZWxlY3RvcignLndlYnZyLWFnZW50LWltYWdlW2RhdGEtc2V0QXR0cmlidXRlLWhyZWZdJyk7XG4gICAgdmFyIGltYWdlU3R5bGVCYWNrZ3JvdW5kSW1hZ2UgPSBpbWFnZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3R5bGUtYmFja2dyb3VuZEltYWdlJyk7XG4gICAgdmFyIGltYWdlU3R5bGVCYWNrZ3JvdW5kSW1hZ2VPYmplY3QgPSBtYW5pZmVzdFtpbWFnZVN0eWxlQmFja2dyb3VuZEltYWdlXTtcbiAgICBpZiAoaW1hZ2VTdHlsZUJhY2tncm91bmRJbWFnZU9iamVjdCkge1xuICAgICAgdmFyIGltYWdlU3R5bGVCYWNrZ3JvdW5kSW1hZ2VWYWx1ZSA9IG1hbmlmZXN0W2ltYWdlU3R5bGVCYWNrZ3JvdW5kSW1hZ2VdLnNyYztcbiAgICAgIGltYWdlLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoJHtpbWFnZVN0eWxlQmFja2dyb3VuZEltYWdlVmFsdWV9KWA7XG4gICAgfVxuXG4gICAgdmFyIGltYWdlSHJlZktleSA9IGltYWdlLmdldEF0dHJpYnV0ZSgnZGF0YS1zZXRBdHRyaWJ1dGUtaHJlZicpO1xuICAgIHZhciBpbWFnZUhyZWZWYWx1ZSA9IG1hbmlmZXN0W2ltYWdlSHJlZktleV07XG4gICAgaWYgKGltYWdlSHJlZlZhbHVlKSB7XG4gICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCBpbWFnZUhyZWZWYWx1ZSk7XG4gICAgfVxuXG4gICAgdmFyIG5hbWUgPSB3ZWJ2ckFnZW50RWwucXVlcnlTZWxlY3RvcignLndlYnZyLWFnZW50LW5hbWVbZGF0YS10ZXh0Q29udGVudF0nKTtcbiAgICB2YXIgbmFtZVRleHRDb250ZW50S2V5ID0gbmFtZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGV4dENvbnRlbnQnKTtcbiAgICB2YXIgbmFtZVZhbHVlID0gbWFuaWZlc3RbbmFtZVRleHRDb250ZW50S2V5XTtcbiAgICBpZiAobmFtZVZhbHVlKSB7XG4gICAgICBuYW1lLnRleHRDb250ZW50ID0gbmFtZVZhbHVlO1xuICAgIH1cblxuICAgIHZhciBkZXNjcmlwdGlvbiA9IHdlYnZyQWdlbnRFbC5xdWVyeVNlbGVjdG9yKCcud2VidnItYWdlbnQtZGVzY3JpcHRpb25bZGF0YS10ZXh0Q29udGVudF0nKTtcbiAgICB2YXIgZGVzY3JpcHRpb25UZXh0Q29udGVudEtleSA9IGRlc2NyaXB0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS10ZXh0Q29udGVudCcpO1xuICAgIHZhciBkZXNjcmlwdGlvblZhbHVlID0gbWFuaWZlc3RbZGVzY3JpcHRpb25UZXh0Q29udGVudEtleV07XG4gICAgaWYgKGRlc2NyaXB0aW9uVmFsdWUpIHtcbiAgICAgIGRlc2NyaXB0aW9uLmluc2VydEFkamFjZW50VGV4dCgnYWZ0ZXJiZWdpbicsIGRlc2NyaXB0aW9uVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3ZWJ2ckFnZW50RWwucXVlcnlTZWxlY3RvcignW2FyaWEtZXhwYW5kcz1cIndlYnZyLWFnZW50LWRlc2NyaXB0aW9uXCJdJykucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWV4cGFuZHMnKTtcbiAgICB9XG5cbiAgICB3ZWJ2ckFnZW50SG9zdC5wb3N0TWVzc2FnZSh7XG4gICAgICBhY3Rpb246ICdsb2FkZWQnLFxuICAgICAgdXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZlxuICAgIH0pO1xuICB9KTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgaWYgKGV2dC50YXJnZXQgIT09IGRvY3VtZW50LmJvZHkgfHwgZXZ0LnNoaWZ0S2V5IHx8IGV2dC5tZXRhS2V5IHx8IGV2dC5hbHRLZXkgfHwgZXZ0LmN0cmxLZXkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2dC5rZXlDb2RlID09PSB3ZWJ2ckFnZW50SG9zdC5rZXlzLmVzYykgeyAgLy8gYEVzY2Aga2V5LlxuICAgICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBgRXNjYCBrZXkgcHJlc3NlZCcpO1xuICAgICAgaWYgKHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzQ29ubmVjdGVkKSB7XG4gICAgICAgIGlmICh3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c1ByZXNlbnRpbmcubGVuZ3RoKSB7XG4gICAgICAgICAgc2VuZERpc3BsYXlFeGl0UHJlc2VudE1zZygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjbG9zZUluZm8oKTtcbiAgICB9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09PSB3ZWJ2ckFnZW50SG9zdC5rZXlzLmkpIHsgIC8vIGBpYCBrZXkuXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYGlgIGtleSBwcmVzc2VkJyk7XG4gICAgICB0b2dnbGVJbmZvKCk7XG4gICAgfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PT0gd2VidnJBZ2VudEhvc3Qua2V5cy5jKSB7ICAvLyBgY2Aga2V5LlxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIGBjYCBrZXkgcHJlc3NlZCcpO1xuICAgICAgY2xvc2VJbmZvKCk7XG4gICAgfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PT0gd2VidnJBZ2VudEhvc3Qua2V5cy52KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYHZgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAod2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNDb25uZWN0ZWQpIHtcbiAgICAgICAgaWYgKHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzUHJlc2VudGluZy5sZW5ndGgpIHtcbiAgICAgICAgICBzZW5kRGlzcGxheUV4aXRQcmVzZW50TXNnKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VuZERpc3BsYXlSZXF1ZXN0UHJlc2VudE1zZygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PT0gd2VidnJBZ2VudEhvc3Qua2V5cy5mKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2VidnItYWdlbnRdW2NsaWVudF0gYGZgIGtleSBwcmVzc2VkJyk7XG4gICAgICBpZiAod2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNDb25uZWN0ZWQpIHtcbiAgICAgICAgaWYgKHdlYnZyQWdlbnRIb3N0LnN0YXRlLmRpc3BsYXlzUHJlc2VudGluZy5sZW5ndGgpIHtcbiAgICAgICAgICBzZW5kRGlzcGxheUV4aXRQcmVzZW50TXNnKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VuZERpc3BsYXlSZXF1ZXN0UHJlc2VudE1zZygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICB2YXIgaGVhZHNldHNDb250cm9sc0VsID0gd2VidnJBZ2VudEVsLnF1ZXJ5U2VsZWN0b3IoJyN3ZWJ2ci1hZ2VudC1oZWFkc2V0cy1jb250cm9scycpO1xuICBpZiAoaGVhZHNldHNDb250cm9sc0VsKSB7XG4gICAgYXJpYUxpc3Rib3goaGVhZHNldHNDb250cm9sc0VsLCB7XG4gICAgICBuZXh0S2V5czogW1xuICAgICAgICAncycsXG4gICAgICAgICdkJyxcbiAgICAgICAgMzcsXG4gICAgICAgIDM4XG4gICAgICBdLFxuICAgICAgcHJldktleXM6IFtcbiAgICAgICAgJ2EnLFxuICAgICAgICAndycsXG4gICAgICAgIDM5LFxuICAgICAgICA0MFxuICAgICAgXVxuICAgIH0pO1xuICB9XG5cbiAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldnQpIHtcbiAgICB2YXIgZWwgPSBldnQudGFyZ2V0O1xuXG4gICAgaWYgKCFlbCB8fCAhZWwuY2xvc2VzdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChlbC5jbG9zZXN0KCcjd2VidnItYWdlbnQtZGV0YWlscycpIHx8XG4gICAgICAgIGVsLmNsb3Nlc3QoJyN3ZWJ2ci1hZ2VudC1kZXNjcmlwdGlvbicpKSB7XG4gICAgICB2YXIgYXJpYUV4cGFuZHNFbHMgPSB3ZWJ2ckFnZW50RWwucXVlcnlTZWxlY3RvckFsbCgnW2FyaWEtZXhwYW5kc10nKTtcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoYXJpYUV4cGFuZHNFbHMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBoYW5kbGVFeHBhbmRlcnMoZXZ0LCAnIycgKyBlbC5nZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kcycpKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgY2xvc2VkSW5mbyA9IGNsb3NlSW5mbygpO1xuICAgICAgaWYgKGNsb3NlZEluZm8pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChlbC5jbG9zZXN0KCdbZGF0YS1oZWFkc2V0LXNsdWddJykpIHtcbiAgICAgIHZhciBkaXNwbGF5SWQgPSBlbC5jbG9zZXN0KCdbZGF0YS1oZWFkc2V0LXNsdWddJykuZ2V0QXR0cmlidXRlKCdkYXRhLWhlYWRzZXQtaWQnKTtcbiAgICAgIHZhciBkaXNwbGF5ID0gd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNCeUlkW2Rpc3BsYXlJZF07XG4gICAgICB2YXIgZGlzcGxheU9wdHMgPSB7XG4gICAgICAgIGRpc3BsYXlTbHVnOiBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVhZHNldC1zbHVnJyksXG4gICAgICAgIGRpc3BsYXlOYW1lOiBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVhZHNldC1uYW1lJyksXG4gICAgICAgIGRpc3BsYXlJZDogZGlzcGxheUlkLFxuICAgICAgICBpc0Nvbm5lY3RlZDogZGlzcGxheSAmJiAnaXNDb25uZWN0ZWQnIGluIGRpc3BsYXkgPyBkaXNwbGF5LmlzQ29ubmVjdGVkIDogZmFsc2UsXG4gICAgICAgIGlzUHJlc2VudGluZzogZGlzcGxheSAmJiAnaXNQcmVzZW50aW5nJyBpbiBkaXNwbGF5ID8gZGlzcGxheS5pc1ByZXNlbnRpbmcgOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIGlmIChkaXNwbGF5T3B0cy5pc1ByZXNlbnRpbmcpIHtcbiAgICAgICAgc2VuZERpc3BsYXlFeGl0UHJlc2VudE1zZyhkaXNwbGF5T3B0cyk7XG4gICAgICB9IGVsc2UgaWYgKGRpc3BsYXlPcHRzLmlzQ29ubmVjdGVkKSB7XG4gICAgICAgIHNlbmREaXNwbGF5UmVxdWVzdFByZXNlbnRNc2coZGlzcGxheU9wdHMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChlbC5jbG9zZXN0KCcjd2VidnItYWdlbnQtc3RlYW0tbGluaycpKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGVsLmJsdXIoKTtcbiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5mb2N1cygpO1xuICAgICAgLy8gVE9ETzogQXV0aGVudGljYXRlIGFnYWluc3QgUkVTVCBBUEkgKGAvc3RlYW0vYXV0aGApLlxuICAgIH1cbiAgfSk7XG5cbiAgdmFyIHN0ZWFtRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3ZWJ2ci1hZ2VudC1mb3JtLXN0ZWFtJyk7XG4gIHN0ZWFtRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHdlYnZyQWdlbnRIb3N0LnN0ZWFtLnVzZXJuYW1lID0gc3RlYW1Gb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJzdGVhbV91c2VybmFtZVwiXScpLnZhbHVlO1xuICAgIC8vIHdlYnZyQWdlbnRIb3N0LnN0ZWFtLnBhc3N3b3JkID0gc3RlYW1Gb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJzdGVhbV9wYXNzd29yZFwiXScpLnZhbHVlO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53ZWJ2ci1hZ2VudC1zdGVhbS1sYWJlbCcpLnRleHRDb250ZW50ID0gJ1NpZ25lZCBpbiBhcyBjdmFudyc7XG4gICAgY29uc29sZS5sb2cod2VidnJBZ2VudEhvc3Quc3RlYW0pO1xuICAgIHdlYnZyQWdlbnRIb3N0LnBvc3RNZXNzYWdlKHtcbiAgICAgIGFjdGlvbjogJ3N0ZWFtLXVzZXItYXV0aGVudGljYXRlZCcsXG4gICAgICB1c2VybmFtZTogd2VidnJBZ2VudEhvc3Quc3RlYW0udXNlcm5hbWUsXG4gICAgICBzcmM6ICd3ZWJ2ci1hZ2VudCdcbiAgICB9LCBTSVRFX09SSUdJTik7XG4gICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcbiAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgIH1cbiAgICBkb2N1bWVudC5ib2R5LmZvY3VzKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIGNsb3NlSW5mbyAoKSB7XG4gICAgdmFyIGNsb3NlRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd2VidnItYWdlbnQtZGV0YWlscy10b2dnbGUtY2xvc2VbYXJpYS1leHBhbmRlZD1cInRydWVcIl0nKTtcbiAgICBpZiAoY2xvc2VFbCkge1xuICAgICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBIaWRpbmcgZGVzY3JpcHRpb24nKTtcbiAgICAgIGNsb3NlRWwuY2xpY2soKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBvcGVuSW5mbyAoKSB7XG4gICAgdmFyIG9wZW5FbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3ZWJ2ci1hZ2VudC1kZXRhaWxzLXRvZ2dsZS1pbmZvW2FyaWEtZXhwYW5kZWQ9XCJ0cnVlXCJdJyk7XG4gICAgaWYgKG9wZW5FbCkge1xuICAgICAgY29uc29sZS5sb2coJ1t3ZWJ2ci1hZ2VudF1bY2xpZW50XSBPcGVuaW5nIGRlc2NyaXB0aW9uJyk7XG4gICAgICBvcGVuRWwuY2xpY2soKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVJbmZvICgpIHtcbiAgICBjb25zb2xlLmxvZygnW3dlYnZyLWFnZW50XVtjbGllbnRdIFRvZ2dsaW5nIGRlc2NyaXB0aW9uJyk7XG4gICAgdmFyIHRvZ2dsZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndlYnZyLWFnZW50LWRldGFpbHMtdG9nZ2xlW2FyaWEtZXhwYW5kZWQ9XCJ0cnVlXCJdJyk7XG4gICAgaWYgKHRvZ2dsZUVsKSB7XG4gICAgICB0b2dnbGVFbC5jbGljaygpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBoZWFkc2V0c1ByZXNlbnRFbCA9IHdlYnZyQWdlbnRFbC5xdWVyeVNlbGVjdG9yKCcjd2VidnItYWdlbnQtaGVhZHNldHMtcHJlc2VudCcpO1xuXG4gIGZ1bmN0aW9uIHVwZGF0ZUhlYWRzZXRzIChjb25uZWN0ZWREaXNwbGF5SWZBdmFpbGFibGUsIHJldHJ5KSB7XG4gICAgaWYgKHR5cGVvZiByZXRyeSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHJ5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgaGVhZHNldEVscyA9IHdlYnZyQWdlbnRFbC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1oZWFkc2V0LXNsdWddJyk7XG5cbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGhlYWRzZXRFbHMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgdmFyIGhlYWRzZXRTbHVnID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLWhlYWRzZXQtc2x1ZycpO1xuICAgICAgdmFyIGhlYWRzZXRMYWJlbEVudGVyVlJFbCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy53ZWJ2ci1hZ2VudC1oZWFkc2V0LWxhYmVsLWVudGVyLXZyJyk7XG4gICAgICB2YXIgaGVhZHNldExhYmVsRXhpdFZSRWwgPSBlbC5xdWVyeVNlbGVjdG9yKCcud2VidnItYWdlbnQtaGVhZHNldC1sYWJlbC1leGl0LXZyJyk7XG4gICAgICB2YXIgZGlzcGxheUlzQ29ubmVjdGVkID0gd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheUlzQ29ubmVjdGVkKGhlYWRzZXRTbHVnKTtcbiAgICAgIHZhciBkaXNwbGF5SXNQcmVzZW50aW5nID0gd2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheUlzUHJlc2VudGluZyhoZWFkc2V0U2x1Zyk7XG4gICAgICBpZiAoY29ubmVjdGVkRGlzcGxheUlmQXZhaWxhYmxlICYmIGNvbm5lY3RlZERpc3BsYXlJZkF2YWlsYWJsZS5kaXNwbGF5U2x1ZyA9PT0gaGVhZHNldFNsdWcpIHtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLWhlYWRzZXQtaWQnLCBjb25uZWN0ZWREaXNwbGF5SWZBdmFpbGFibGUuZGlzcGxheUlkKTtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLWhlYWRzZXQtbmFtZScsIGNvbm5lY3RlZERpc3BsYXlJZkF2YWlsYWJsZS5kaXNwbGF5TmFtZSk7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBjb25uZWN0ZWREaXNwbGF5SWZBdmFpbGFibGUuZGlzcGxheU5hbWUpO1xuICAgICAgfVxuICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLWhlYWRzZXQtY29ubmVjdGVkJywgZGlzcGxheUlzQ29ubmVjdGVkKTtcbiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS1oZWFkc2V0LXByZXNlbnRpbmcnLCBkaXNwbGF5SXNQcmVzZW50aW5nKTtcbiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS1oZWFkc2V0LXJlYWR5JywgZGlzcGxheUlzQ29ubmVjdGVkICYmICFkaXNwbGF5SXNQcmVzZW50aW5nKTtcbiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS1oZWFkc2V0LXRpbWVvdXQnLCBkaXNwbGF5SXNDb25uZWN0ZWQpO1xuICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIGRpc3BsYXlJc0Nvbm5lY3RlZCB8fCBkaXNwbGF5SXNQcmVzZW50aW5nID8gJ2ZhbHNlJyA6ICd0cnVlJyk7XG4gICAgICBpZiAoaGVhZHNldExhYmVsRW50ZXJWUkVsKSB7XG4gICAgICAgIGhlYWRzZXRMYWJlbEVudGVyVlJFbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgZGlzcGxheUlzUHJlc2VudGluZyA/ICd0cnVlJyA6ICdmYWxzZScpO1xuICAgICAgfVxuICAgICAgaWYgKGhlYWRzZXRMYWJlbEV4aXRWUkVsKSB7XG4gICAgICAgIGhlYWRzZXRMYWJlbEV4aXRWUkVsLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCBkaXNwbGF5SXNQcmVzZW50aW5nID8gJ2ZhbHNlJyA6ICd0cnVlJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgYW55RGlzcGxheXNDb25uZWN0ZWQgPSB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c0Nvbm5lY3RlZC5sZW5ndGggPiAwO1xuICAgIHZhciBhbnlEaXNwbGF5c1ByZXNlbnRpbmcgPSB3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c1ByZXNlbnRpbmcubGVuZ3RoID4gMDtcblxuICAgIHZhciBqc29uRGlzcGxheXNDb25uZWN0ZWQgPSBKU09OLnN0cmluZ2lmeSh3ZWJ2ckFnZW50SG9zdC5zdGF0ZS5kaXNwbGF5c0Nvbm5lY3RlZCk7XG5cbiAgICBpZiAoYW55RGlzcGxheXNDb25uZWN0ZWQpIHtcbiAgICAgIGh0bWwuc2V0QXR0cmlidXRlKCdkYXRhLWNvbm5lY3RlZC1kaXNwbGF5cycsIGpzb25EaXNwbGF5c0Nvbm5lY3RlZCk7XG4gICAgICBodG1sLnNldEF0dHJpYnV0ZSgnZGF0YS1taXNzaW5nLWRpc3BsYXlzJywgJ2ZhbHNlJyk7XG4gICAgICBodG1sLnNldEF0dHJpYnV0ZSgnZGF0YS10aW1lb3V0LWRpc3BsYXlzJywgJ2ZhbHNlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGh0bWwucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWNvbm5lY3RlZC1kaXNwbGF5cycpO1xuICAgICAgaGVhZHNldHNQcmVzZW50RWwuaW5uZXJIVE1MID0gJ0RldGVjdGluZyBWUiBoZWFkc2V0JmhlbGxpcDsnO1xuICAgIH1cblxuICAgIGlmIChhbnlEaXNwbGF5c1ByZXNlbnRpbmcpIHtcbiAgICAgIHZhciBqc29uRGlzcGxheXNQcmVzZW50aW5nID0gSlNPTi5zdHJpbmdpZnkod2VidnJBZ2VudEhvc3Quc3RhdGUuZGlzcGxheXNQcmVzZW50aW5nKTtcbiAgICAgIGh0bWwuc2V0QXR0cmlidXRlKCdkYXRhLXByZXNlbnRpbmctZGlzcGxheXMnLCBqc29uRGlzcGxheXNQcmVzZW50aW5nKTtcbiAgICAgIGh0bWwucmVtb3ZlQXR0cmlidXRlKCdkYXRhLXJlYWR5LWRpc3BsYXlzJyk7XG4gICAgICBodG1sLnNldEF0dHJpYnV0ZSgnZGF0YS1taXNzaW5nLWRpc3BsYXlzJywgJ2ZhbHNlJyk7XG4gICAgICBoZWFkc2V0c1ByZXNlbnRFbC5pbm5lckhUTUwgPSAnJztcbiAgICB9IGVsc2Uge1xuICAgICAgaHRtbC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtcHJlc2VudGluZy1kaXNwbGF5cycpO1xuICAgICAgaWYgKGFueURpc3BsYXlzQ29ubmVjdGVkKSB7XG4gICAgICAgIGh0bWwuc2V0QXR0cmlidXRlKCdkYXRhLXJlYWR5LWRpc3BsYXlzJywganNvbkRpc3BsYXlzQ29ubmVjdGVkKTtcbiAgICAgICAgaGVhZHNldHNQcmVzZW50RWwuaW5uZXJIVE1MID0gJyc7XG4gICAgICB9IGVsc2UgaWYgKCFyZXRyeSkge1xuICAgICAgICBodG1sLnNldEF0dHJpYnV0ZSgnZGF0YS1taXNzaW5nLWRpc3BsYXlzJywgJ3RydWUnKTtcbiAgICAgICAgaHRtbC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtcmVhZHktZGlzcGxheXMnKTtcbiAgICAgICAgaGVhZHNldHNQcmVzZW50RWwuaW5uZXJIVE1MID0gJ05vIFZSIGhlYWRzZXQgZGV0ZWN0ZWQnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZXRyeSkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHVwZGF0ZUhlYWRzZXRzKGNvbm5lY3RlZERpc3BsYXlJZkF2YWlsYWJsZSwgZmFsc2UpO1xuICAgICAgfSwgd2VidnJBZ2VudEhvc3QuaGVhZHNldHNQcmVzZW50VGltZW91dCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheUNvbm5lY3RlZCAoZGlzcGxheVN0YXRlKSB7XG4gICAgd2VidnJBZ2VudEhvc3QudXBkYXRlU3RhdGUoZGlzcGxheVN0YXRlLmRpc3BsYXlJZCwgZGlzcGxheVN0YXRlKTtcblxuICAgIHVwZGF0ZUhlYWRzZXRzKGRpc3BsYXlTdGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVEaXNwbGF5RGlzY29ubmVjdGVkIChkaXNwbGF5U3RhdGUpIHtcbiAgICB3ZWJ2ckFnZW50SG9zdC51cGRhdGVTdGF0ZShkaXNwbGF5U3RhdGUuZGlzcGxheUlkLCBkaXNwbGF5U3RhdGUpO1xuXG4gICAgdXBkYXRlSGVhZHNldHMoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZURpc3BsYXlQcmVzZW50U3RhcnQgKGRpc3BsYXlTdGF0ZSkge1xuICAgIHdlYnZyQWdlbnRIb3N0LnVwZGF0ZVN0YXRlKGRpc3BsYXlTdGF0ZS5kaXNwbGF5SWQsIGRpc3BsYXlTdGF0ZSk7XG5cbiAgICB1cGRhdGVIZWFkc2V0cyhkaXNwbGF5U3RhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheVByZXNlbnRFbmQgKGRpc3BsYXlTdGF0ZSkge1xuICAgIHdlYnZyQWdlbnRIb3N0LnVwZGF0ZVN0YXRlKGRpc3BsYXlTdGF0ZS5kaXNwbGF5SWQsIGRpc3BsYXlTdGF0ZSk7XG5cbiAgICB1cGRhdGVIZWFkc2V0cygpO1xuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIGRhdGEgPSBldnQuZGF0YTtcbiAgICB2YXIgYWN0aW9uID0gZGF0YS5hY3Rpb247XG4gICAgdmFyIHNyYyA9IGRhdGEuc3JjO1xuICAgIGlmIChzcmMgIT09ICd3ZWJ2ci1hZ2VudCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGFjdGlvbiA9PT0gJ2xvYWRlZCcpIHtcbiAgICAgIHVwZGF0ZUhlYWRzZXRzKCk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdvcGVuLWluZm8nKSB7XG4gICAgICBvcGVuSW5mbygpO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnY2xvc2UtaW5mbycpIHtcbiAgICAgIGNsb3NlSW5mbygpO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAndG9nZ2xlLWluZm8nKSB7XG4gICAgICB0b2dnbGVJbmZvKCk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdkaXNwbGF5LWNvbm5lY3RlZCcpIHtcbiAgICAgIHVwZGF0ZURpc3BsYXlDb25uZWN0ZWQoZGF0YSk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdkaXNwbGF5LWRpc2Nvbm5lY3RlZCcpIHtcbiAgICAgIHVwZGF0ZURpc3BsYXlEaXNjb25uZWN0ZWQoZGF0YSk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdkaXNwbGF5LXByZXNlbnQtc3RhcnQnKSB7XG4gICAgICB1cGRhdGVEaXNwbGF5UHJlc2VudFN0YXJ0KGRhdGEpO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnZGlzcGxheS1wcmVzZW50LWVuZCcpIHtcbiAgICAgIHVwZGF0ZURpc3BsYXlQcmVzZW50RW5kKGRhdGEpO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnbW91c2VlbnRlci10b2dnbGUtdnItYnV0dG9uJykge1xuICAgICAgaWYgKHdlYnZyQWdlbnRIZWFkc2V0c0VsKSB7XG4gICAgICAgIHdlYnZyQWdlbnRIZWFkc2V0c0VsLmNsYXNzTGlzdC5hZGQoJ2hvdmVyJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdtb3VzZWxlYXZlLXRvZ2dsZS12ci1idXR0b24nKSB7XG4gICAgICBpZiAod2VidnJBZ2VudEhlYWRzZXRzRWwpIHtcbiAgICAgICAgd2VidnJBZ2VudEhlYWRzZXRzRWwuY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXInKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3B1YmxpYy9ob3N0LmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;(function(factory) {\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :\n\t\t\t\t__WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))\n  } else if (typeof exports === 'object' && typeof module === 'object') {\n    module.exports = factory\n  } else {\n    window.ariaListbox = factory()\n  }\n})(function() {\n\n  return function(el, opts) {\n    if (!(el instanceof HTMLElement)) {\n      throw new Error('The listbox container element must be the first parameter to AriaListbox')\n    }\n\n    function normalizeKeyOptions(keys, defaults) {\n      if (!Array.isArray(keys)) {\n        keys = keys ? [keys] : defaults\n      }\n      return keys.map(function(k) {\n        return typeof k === 'string' && !Number(k) ? k.charCodeAt(0) : Number(k)\n      })\n    }\n\n    el.setAttribute('role', 'listbox')\n    opts = opts || {}\n    opts.prevKeys = normalizeKeyOptions(opts.prevKeys, [38])\n    opts.nextKeys = normalizeKeyOptions(opts.nextKeys, [40])\n    opts.selectKeys = normalizeKeyOptions(opts.selectKeys, [13, 32])\n\n    var firstSelected = el.querySelector('[aria-selected=\"true\"]')\n    if (firstSelected) {\n      firstSelected.setAttribute('tabindex', '0')\n    } else {\n      var options = el.querySelectorAll('[role=\"option\"]:not([aria-disabled=\"true\"])')\n      if (options.length) {\n        options[0].setAttribute('tabindex', '0')\n      }\n    }\n\n    function clearTabIndexes() {\n      Array.prototype.forEach.call(el.querySelectorAll('[tabindex]'), function(n) {\n        n.removeAttribute('tabindex')\n      })\n    }\n\n    function select(child) {\n      if (child.getAttribute('aria-disabled') === 'true') return\n      var multiselect = el.getAttribute('aria-multiselect') === 'true', nextSelected\n\n      if (!multiselect) {\n        Array.prototype.forEach.call(el.querySelectorAll('[aria-selected=\"true\"]'), function(n) {\n          n.removeAttribute('aria-selected')\n        })\n      }\n\n      var evt = document.createEvent('CustomEvent')\n      evt.initEvent('selection-changed', true, true)\n\n      if (multiselect && child.getAttribute('aria-selected') === 'true') {\n        child.removeAttribute('aria-selected')\n        evt.removed = child\n      } else {\n        clearTabIndexes()\n        child.setAttribute('aria-selected', 'true')\n        child.setAttribute('tabindex', '0')\n        child.focus()\n        if (multiselect) {\n          evt.added = child\n        }\n      }\n\n      evt.selection = multiselect ? el.querySelectorAll('[aria-selected=\"true\"]') : child\n      el.dispatchEvent(evt)\n    }\n\n    function optionNode(e) {\n      var optionEl = e.target\n      while (optionEl && optionEl.getAttribute('role') !== 'option') {\n        optionEl = optionEl.parentElement\n      }\n      return optionEl\n    }\n\n    el.addEventListener('click', function(e) {\n      var optionEl = optionNode(e)\n      if (optionEl) {\n        select(optionEl)\n      }\n    })\n\n    function handleKey(optionEl, code, keys, delta) {\n      if (keys.indexOf(code) !== -1) {\n        var optionEls = el.querySelectorAll('[role=\"option\"]:not([aria-disabled=\"true\"])'),\n            idx = Array.prototype.indexOf.call(optionEls, optionEl)\n\n        var next = optionEls[idx + delta]\n        if (next) {\n          clearTabIndexes()\n          next.setAttribute('tabindex', 0)\n          next.focus()\n        }\n      }\n    }\n\n    el.addEventListener('keydown', function(e) {\n      var optionEl = optionNode(e),\n          code = e.keyCode || e.code\n\n      if (!optionEl) return\n\n      if (opts.selectKeys.indexOf(code) !== -1) {\n        select(optionEl)\n      } else if (e.target && e.target.getAttribute('role') === 'option') {\n        handleKey(optionEl, code, opts.nextKeys, 1)\n        handleKey(optionEl, code, opts.prevKeys, -1)\n      }\n    })\n  }\n\n})//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2FyaWEtbGlzdGJveC9hcmlhLWxpc3Rib3guanM/OGVmZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQSxDQUFDIiwiZmlsZSI6IjMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKGZhY3RvcnkpXG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LmFyaWFMaXN0Ym94ID0gZmFjdG9yeSgpXG4gIH1cbn0pKGZ1bmN0aW9uKCkge1xuXG4gIHJldHVybiBmdW5jdGlvbihlbCwgb3B0cykge1xuICAgIGlmICghKGVsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBsaXN0Ym94IGNvbnRhaW5lciBlbGVtZW50IG11c3QgYmUgdGhlIGZpcnN0IHBhcmFtZXRlciB0byBBcmlhTGlzdGJveCcpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbm9ybWFsaXplS2V5T3B0aW9ucyhrZXlzLCBkZWZhdWx0cykge1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGtleXMpKSB7XG4gICAgICAgIGtleXMgPSBrZXlzID8gW2tleXNdIDogZGVmYXVsdHNcbiAgICAgIH1cbiAgICAgIHJldHVybiBrZXlzLm1hcChmdW5jdGlvbihrKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgayA9PT0gJ3N0cmluZycgJiYgIU51bWJlcihrKSA/IGsuY2hhckNvZGVBdCgwKSA6IE51bWJlcihrKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBlbC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbGlzdGJveCcpXG4gICAgb3B0cyA9IG9wdHMgfHwge31cbiAgICBvcHRzLnByZXZLZXlzID0gbm9ybWFsaXplS2V5T3B0aW9ucyhvcHRzLnByZXZLZXlzLCBbMzhdKVxuICAgIG9wdHMubmV4dEtleXMgPSBub3JtYWxpemVLZXlPcHRpb25zKG9wdHMubmV4dEtleXMsIFs0MF0pXG4gICAgb3B0cy5zZWxlY3RLZXlzID0gbm9ybWFsaXplS2V5T3B0aW9ucyhvcHRzLnNlbGVjdEtleXMsIFsxMywgMzJdKVxuXG4gICAgdmFyIGZpcnN0U2VsZWN0ZWQgPSBlbC5xdWVyeVNlbGVjdG9yKCdbYXJpYS1zZWxlY3RlZD1cInRydWVcIl0nKVxuICAgIGlmIChmaXJzdFNlbGVjdGVkKSB7XG4gICAgICBmaXJzdFNlbGVjdGVkLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBvcHRpb25zID0gZWwucXVlcnlTZWxlY3RvckFsbCgnW3JvbGU9XCJvcHRpb25cIl06bm90KFthcmlhLWRpc2FibGVkPVwidHJ1ZVwiXSknKVxuICAgICAgaWYgKG9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgIG9wdGlvbnNbMF0uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJylcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhclRhYkluZGV4ZXMoKSB7XG4gICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ1t0YWJpbmRleF0nKSwgZnVuY3Rpb24obikge1xuICAgICAgICBuLnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZWxlY3QoY2hpbGQpIHtcbiAgICAgIGlmIChjaGlsZC5nZXRBdHRyaWJ1dGUoJ2FyaWEtZGlzYWJsZWQnKSA9PT0gJ3RydWUnKSByZXR1cm5cbiAgICAgIHZhciBtdWx0aXNlbGVjdCA9IGVsLmdldEF0dHJpYnV0ZSgnYXJpYS1tdWx0aXNlbGVjdCcpID09PSAndHJ1ZScsIG5leHRTZWxlY3RlZFxuXG4gICAgICBpZiAoIW11bHRpc2VsZWN0KSB7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZWwucXVlcnlTZWxlY3RvckFsbCgnW2FyaWEtc2VsZWN0ZWQ9XCJ0cnVlXCJdJyksIGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgICBuLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcpXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIHZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKVxuICAgICAgZXZ0LmluaXRFdmVudCgnc2VsZWN0aW9uLWNoYW5nZWQnLCB0cnVlLCB0cnVlKVxuXG4gICAgICBpZiAobXVsdGlzZWxlY3QgJiYgY2hpbGQuZ2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJykgPT09ICd0cnVlJykge1xuICAgICAgICBjaGlsZC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnKVxuICAgICAgICBldnQucmVtb3ZlZCA9IGNoaWxkXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjbGVhclRhYkluZGV4ZXMoKVxuICAgICAgICBjaGlsZC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCAndHJ1ZScpXG4gICAgICAgIGNoaWxkLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpXG4gICAgICAgIGNoaWxkLmZvY3VzKClcbiAgICAgICAgaWYgKG11bHRpc2VsZWN0KSB7XG4gICAgICAgICAgZXZ0LmFkZGVkID0gY2hpbGRcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBldnQuc2VsZWN0aW9uID0gbXVsdGlzZWxlY3QgPyBlbC5xdWVyeVNlbGVjdG9yQWxsKCdbYXJpYS1zZWxlY3RlZD1cInRydWVcIl0nKSA6IGNoaWxkXG4gICAgICBlbC5kaXNwYXRjaEV2ZW50KGV2dClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvcHRpb25Ob2RlKGUpIHtcbiAgICAgIHZhciBvcHRpb25FbCA9IGUudGFyZ2V0XG4gICAgICB3aGlsZSAob3B0aW9uRWwgJiYgb3B0aW9uRWwuZ2V0QXR0cmlidXRlKCdyb2xlJykgIT09ICdvcHRpb24nKSB7XG4gICAgICAgIG9wdGlvbkVsID0gb3B0aW9uRWwucGFyZW50RWxlbWVudFxuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdGlvbkVsXG4gICAgfVxuXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgb3B0aW9uRWwgPSBvcHRpb25Ob2RlKGUpXG4gICAgICBpZiAob3B0aW9uRWwpIHtcbiAgICAgICAgc2VsZWN0KG9wdGlvbkVsKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVLZXkob3B0aW9uRWwsIGNvZGUsIGtleXMsIGRlbHRhKSB7XG4gICAgICBpZiAoa2V5cy5pbmRleE9mKGNvZGUpICE9PSAtMSkge1xuICAgICAgICB2YXIgb3B0aW9uRWxzID0gZWwucXVlcnlTZWxlY3RvckFsbCgnW3JvbGU9XCJvcHRpb25cIl06bm90KFthcmlhLWRpc2FibGVkPVwidHJ1ZVwiXSknKSxcbiAgICAgICAgICAgIGlkeCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwob3B0aW9uRWxzLCBvcHRpb25FbClcblxuICAgICAgICB2YXIgbmV4dCA9IG9wdGlvbkVsc1tpZHggKyBkZWx0YV1cbiAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICBjbGVhclRhYkluZGV4ZXMoKVxuICAgICAgICAgIG5leHQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApXG4gICAgICAgICAgbmV4dC5mb2N1cygpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIG9wdGlvbkVsID0gb3B0aW9uTm9kZShlKSxcbiAgICAgICAgICBjb2RlID0gZS5rZXlDb2RlIHx8IGUuY29kZVxuXG4gICAgICBpZiAoIW9wdGlvbkVsKSByZXR1cm5cblxuICAgICAgaWYgKG9wdHMuc2VsZWN0S2V5cy5pbmRleE9mKGNvZGUpICE9PSAtMSkge1xuICAgICAgICBzZWxlY3Qob3B0aW9uRWwpXG4gICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgncm9sZScpID09PSAnb3B0aW9uJykge1xuICAgICAgICBoYW5kbGVLZXkob3B0aW9uRWwsIGNvZGUsIG9wdHMubmV4dEtleXMsIDEpXG4gICAgICAgIGhhbmRsZUtleShvcHRpb25FbCwgY29kZSwgb3B0cy5wcmV2S2V5cywgLTEpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG59KVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hcmlhLWxpc3Rib3gvYXJpYS1saXN0Ym94LmpzXG4vLyBtb2R1bGUgaWQgPSAzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 4 */
/***/ (function(module, exports) {

eval("/* global module */\n\n/*\n\n// Sample usage:\n\nwindow.addEventListener('gamepad.buttonvaluechange', function (e) {\n  console.log('[%s]', window.performance.now().toFixed(3), e.type, '• Gamepad', e.gamepad, '• Button', e.button);\n});\n\nwindow.addEventListener('gamepad.buttondown', function (e) {\n  console.log('[%s]', window.performance.now().toFixed(3), e.type, '• Gamepad', e.gamepad, '• Button', e.button);\n});\n\nwindow.addEventListener('gamepad.buttonup', function (e) {\n  console.log('[%s]', window.performance.now().toFixed(3), e.type, '• Gamepad', e.gamepad, '• Button', e.button);\n});\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.b0', function (e) {\n  console.log('[%s]', window.performance.now().toFixed(3), e.type, '• Gamepad', e.gamepad, '• Button', e.button);\n});\n\n*/\n\nvar DEFAULTS = {\n  autostart: true,\n  buttonThreshold: 0.1,\n  emitEventsOnWindow: true,\n  postMessageEventsOn: null,\n  mappings: {\n    'Oculus Remote': {\n      'b0': 'center',\n      'b1': 'back',\n      'b2': 'up',\n      'b3': 'down',\n      'b5': 'right',\n      'b4': 'left'\n    }\n  }\n};\n\nfunction slugify (str) {\n  return (str || '').toLowerCase().replace(/[^\\w]/g, '').replace(/\\(.+\\)/, '');\n}\n\nfunction formatEvent (name, detail) {\n  var event = new CustomEvent(name, {detail: detail});\n  Object.keys(detail).forEach(function (key) {\n    event[key] = detail[key];\n  });\n  return event;\n}\n\nfunction Gamepads (settings) {\n  var self = this;\n  this.supported = window.requestAnimationFrame && navigator.getGamepads;\n\n  if (typeof settings === 'string') {\n    this.settings = {select: settings};\n  } else {\n    this.settings = settings || {};\n  }\n\n  this.start = function () {\n    if (navigator.getGamepads()[0]) {\n      startLoop();\n    } else {\n      window.addEventListener('gamepadconnected', startLoop);\n    }\n  };\n\n  this.stop = function () {\n    window.removeEventListener('gamepadconnected', startLoop);\n    window.cancelAnimationFrame(this.raf);\n  };\n\n  this.DEFAULTS = DEFAULTS;\n\n  if (this.supported) {\n    this.settings.mappings = Object.assign({}, DEFAULTS.mappings, this.settings.mappings);\n    this.settings = Object.assign({}, DEFAULTS, this.settings);\n\n    this.state = {};\n    this.previousState = {};\n\n    // In Firefox Nightly and Chromium builds, you must first query the VR\n    // devices for Gamepads to be exposed.\n    if (navigator.vr && navigator.vr.getDisplays) {\n      navigator.vr.getDisplays()\n        .then(function () {})\n        .catch(console.error.bind(console));\n    }\n    if (navigator.getVRDisplays) {\n      navigator.getVRDisplays()\n        .then(function () {})\n        .catch(console.error.bind(console));\n    }\n\n    if (this.settings.autostart) {\n      this.start();\n    }\n  }\n\n  function loop () {\n    self.poll();\n    self.raf = window.requestAnimationFrame(loop);\n  }\n\n  function startLoop () {\n    self.raf = window.requestAnimationFrame(loop);\n    window.removeEventListener('gamepadconnected', startLoop);\n  }\n}\n\nGamepads.prototype.poll = function () {\n  var self = this;\n  if (!this.supported) { return; }\n  this.gamepads = navigator.getGamepads();\n  var gp;\n  var btn;\n  var btnState;\n  var len;\n  var previousBtnState;\n\n  for (var i = 0; i < navigator.getGamepads().length; ++i) {\n    gp = navigator.getGamepads()[i];\n    if (!gp) { continue; }\n    if (this.select && this.select !== gp.id) { continue; }\n    this.state[gp.id] = {};\n    if (!this.previousState[gp.id]) {\n      this.previousState[gp.id] = {};\n    }\n    if (gp.buttons) {\n      len = gp.buttons.length;\n      for (var j = 0; j < len; ++j) {\n        btn = gp.buttons[j];\n\n        previousBtnState = this.previousState[gp.id]['b' + j] = this.previousState[gp.id]['b' + j] || {\n          gamepad: {\n            index: i,\n            id: gp.id\n          },\n          button: {\n            index: j,\n            value: 0,\n            pressed: false,\n            name: this.buttonName(gp, j),\n            count: 0\n          }\n        };\n\n        btnState = this.state[gp.id]['b' + j] = {\n          gamepad: {\n            index: gp.index,\n            id: gp.id\n          },\n          button: {\n            index: j,\n            value: this.buttonValue(btn),\n            pressed: this.buttonPressed(btn),\n            name: this.buttonName(gp, j),\n            count: previousBtnState.button.count\n          }\n        };\n\n        if (previousBtnState.button.value !== btnState.button.value) {\n          emitEvent(['gamepad.buttonvaluechange', btnState]);\n        }\n\n        if (previousBtnState.button.pressed && btnState.button.pressed) {\n          this.state[gp.id]['b' + j].button.count++;\n          if (this.state[gp.id]['b' + j].button.count >= 50) {\n            emitEvent(['gamepad.buttonhold', btnState]);\n            this.state[gp.id]['b' + j].button.count = 0;\n          }\n        }\n\n        if (!previousBtnState.button.pressed && btnState.button.pressed) {\n          this.state[gp.id]['b' + j].button.count = 0;\n          emitEvent(['gamepad.buttondown', btnState]);\n        }\n\n        if (previousBtnState.button.pressed && !btnState.button.pressed) {\n          emitEvent(['gamepad.buttonup', btnState]);\n          this.state[gp.id]['b' + j].button.count = 0;\n        }\n      }\n    }\n  }\n\n  function emitEvent (eventToEmit) {\n    var name = eventToEmit[0];\n    var detail = Object.assign({}, eventToEmit[1]);\n\n    if (detail.button && detail.button.count) {\n      // TODO: Actually store timestamps and compare.\n      detail.button.seconds = Math.ceil(detail.button.count / 30);\n    }\n\n    // Emit `gamepad.buttondown`, for example.\n    self.emit(formatEvent(name, detail));\n\n    name += '.' + self.gamepadSlug(detail.gamepad);\n\n    // Emit `gamepad.buttondown.oculusremote`, for example.\n    self.emit(formatEvent(name, detail));\n\n    if (detail.button) {\n      // Emit `gamepad.buttondown.oculusremote.b1`, for example.\n      self.emit(formatEvent(name + '.b' + detail.button.index, detail));\n\n      if (detail.button.name) {\n        // Emit `gamepad.buttondown.oculusremote.back`, for example.\n        self.emit(formatEvent(name + '.' + detail.button.name, detail));\n      }\n    }\n  }\n\n  this.previousState = Object.assign({}, this.state);\n};\n\nGamepads.prototype.buttonValue = function (btn) {\n  if (!this.supported) { return 0; }\n  return typeof btn === 'number' ? btn : btn.value;\n};\n\nGamepads.prototype.buttonPressed = function (btn) {\n  if (!this.supported) { return false; }\n  return (typeof btn === 'number' ? btn : btn.value) > this.settings.buttonThreshold;\n};\n\nGamepads.prototype.buttonName = function (gp, btnIndex) {\n  if (!this.supported) { return; }\n  return this.settings.mappings[gp.id] && this.settings.mappings[gp.id]['b' + btnIndex];\n};\n\nGamepads.prototype.gamepadSlug = function (gp) {\n  if (!this.supported) { return ''; }\n  return slugify(gp.id);\n};\n\nGamepads.prototype.emit = function (event) {\n  if (!this.supported) { return; }\n  if (this.settings.emitEventsOnWindow) {\n    console.log('gamepad', event);\n    window.dispatchEvent(event);\n  }\n  if (this.settings.postMessageEventsOn) {\n    var el = this.settings.postMessageEventsOn;\n    if (typeof el === 'string') {\n      el = document.querySelector(this.settings.postMessageEventsOn);\n    }\n    if (el) {\n      el.postMessage({type: 'event', data: {type: event.type, detail: event}}, '*');\n    }\n  }\n};\n\n// if (typeof define === 'function' && define.amd) {\n//   define('GAMEPADS', GAMEPADS);\n// } else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {\n//   module.exports = GAMEPADS;\n// } else if (window) {\n//   window.GAMEPADS = GAMEPADS;\n// }\n\n// 'use strict';\n\nfunction toArray (obj) {\n  return Array.prototype.slice.apply(obj);\n}\n\nfunction $ (selector, parent) {\n  parent = parent || document;\n  return parent.querySelector(selector);\n}\n\nfunction $$ (selector, parent) {\n  parent = parent || document;\n  return toArray(parent.querySelectorAll(selector));\n}\n\nwindow.addEventListener('keypress', function (e) {\n  if (e.keyCode === 112) {  // `P`\n    sounds.toggle();\n  }\n});\n\nfunction Sounds () {\n  var self = this;\n\n  self.muted = false;\n\n  self.toggle = function () {\n    if (self.muted) {\n      self.play();\n    } else {\n      self.stop();\n    }\n  };\n\n  self.playEl = function (el) {\n    el.components.sound.sound.autoplay = el.components.sound.sound._autoplay;\n    el.components.sound.sound.src = el.components.sound.sound._src;\n    el.components.sound.play();\n  };\n\n  self.stopEl = function (el) {\n    el.components.sound.pause();\n    el.components.sound.sound._autoplay = el.components.sound.sound._autoplay;\n    el.components.sound.sound.autoplay = false;\n    el.components.sound.sound._src = el.components.sound.sound.src;\n    el.components.sound.sound.src = '';\n  };\n\n  self.play = function () {\n    self.muted = false;\n    self.remember();\n    $$('a-scene [sound]').forEach(self.playEl);\n  };\n\n  self.stop = function () {\n    self.muted = true;\n    self.remember();\n    $$('a-scene [sound]').forEach(self.stopEl);\n  };\n\n  self.remember = function () {\n    try {\n      localStorage.audioMuted = self.muted ? 'true' : 'false';\n    } catch (e) {\n    }\n  };\n\n  self.muteOnLoad = function () {\n    try {\n      return localStorage.audioMuted === 'true';\n    } catch (e) {\n      return null;\n    }\n  };\n\n  if (self.muteOnLoad()) {\n    self.stop();\n  }\n}\n\nvar sounds = new Sounds();\n\nwindow.addEventListener('gamepad.buttonhold.oculusremote.center', function () {\n  window.location.reload();\n});\n\nwindow.addEventListener('gamepad.buttonhold.oculusremote.back', function () {\n  window.location.href = OCULUS_SETTINGS.urls.root;\n});\n\nwindow.addEventListener('gamepad.buttonhold.oculusremote.left', function () {\n  window.history.back();\n});\n\nwindow.addEventListener('gamepad.buttonhold.oculusremote.right', function () {\n  window.history.forward();\n});\n\nwindow.addEventListener('gamepad.buttondown.oculustouchleft', function (evt) {\n  console.log('gamepad oculus touch (left)', evt);\n});\n\nwindow.addEventListener('gamepad.buttondown.oculustouchright', function (evt) {\n  console.log('gamepad oculus touch (right)', evt);\n});\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.center', fire('mousedown'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.center', fire('mouseup'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.center', fire('click'));\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.center', fire('cursor-mousedown'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.center', fire('cursor-mouseup'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.center', fire('cursor-click'));\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.up', fireKey('down', 'w'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.up', fireKey('up', 'w'));\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.left', fireKey('down', 'a'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.left', fireKey('up', 'a'));\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.right', fireKey('down', 'd'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.right', fireKey('up', 'd'));\n\nwindow.addEventListener('gamepad.buttondown.oculusremote.down', fireKey('down', 's'));\nwindow.addEventListener('gamepad.buttonup.oculusremote.down', fireKey('up', 's'));\n\nfunction fireKey (keyEventNameSuffix, key) {\n  var keyUpper = key.toUpperCase();\n  return function () {\n    var e = new CustomEvent('key' + keyEventNameSuffix, {bubbles: true});\n    e.keyCode = e.key = keyUpper.charCodeAt(0);\n    document.body.dispatchEvent(e);\n  };\n}\n\nfunction fire (eventName) {\n  return function () {\n    var e = new CustomEvent(eventName, {bubbles: true});\n    var target = $('a-scene canvas') || document.body;\n    target.dispatchEvent(e);\n  };\n}\n\nvar GAMEPADS = new Gamepads(window.GAMEPADS_SETTINGS);\n\nmodule.exports = GAMEPADS;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wdWJsaWMvbGliL2dhbWVwYWRzLmpzPzJhNjYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EscUNBQXFDLGVBQWU7QUFDcEQ7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQixHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsNkNBQTZDO0FBQzdDLG9DQUFvQzs7QUFFcEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHdCQUF3QixRQUFRO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpQkFBaUIsb0NBQW9DO0FBQ3JEO0FBQ0EsY0FBYyxVQUFVO0FBQ3hCLCtDQUErQyxVQUFVO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixTQUFTO0FBQzlCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlDQUFpQzs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUNBQXVDO0FBQ3ZDOztBQUVBO0FBQ0Esd0JBQXdCLFVBQVU7QUFDbEM7QUFDQTs7QUFFQTtBQUNBLHdCQUF3QixjQUFjO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQSx3QkFBd0IsUUFBUTtBQUNoQztBQUNBOztBQUVBO0FBQ0Esd0JBQXdCLFdBQVc7QUFDbkM7QUFDQTs7QUFFQTtBQUNBLHdCQUF3QixRQUFRO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLHNCQUFzQixpQ0FBaUM7QUFDN0U7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxjQUFjO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx3Q0FBd0MsY0FBYztBQUN0RDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSIsImZpbGUiOiI0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIG1vZHVsZSAqL1xuXG4vKlxuXG4vLyBTYW1wbGUgdXNhZ2U6XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbnZhbHVlY2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgY29uc29sZS5sb2coJ1slc10nLCB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkudG9GaXhlZCgzKSwgZS50eXBlLCAn4oCiIEdhbWVwYWQnLCBlLmdhbWVwYWQsICfigKIgQnV0dG9uJywgZS5idXR0b24pO1xufSk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbmRvd24nLCBmdW5jdGlvbiAoZSkge1xuICBjb25zb2xlLmxvZygnWyVzXScsIHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKS50b0ZpeGVkKDMpLCBlLnR5cGUsICfigKIgR2FtZXBhZCcsIGUuZ2FtZXBhZCwgJ+KAoiBCdXR0b24nLCBlLmJ1dHRvbik7XG59KTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9udXAnLCBmdW5jdGlvbiAoZSkge1xuICBjb25zb2xlLmxvZygnWyVzXScsIHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKS50b0ZpeGVkKDMpLCBlLnR5cGUsICfigKIgR2FtZXBhZCcsIGUuZ2FtZXBhZCwgJ+KAoiBCdXR0b24nLCBlLmJ1dHRvbik7XG59KTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9uZG93bi5vY3VsdXNyZW1vdGUuYjAnLCBmdW5jdGlvbiAoZSkge1xuICBjb25zb2xlLmxvZygnWyVzXScsIHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKS50b0ZpeGVkKDMpLCBlLnR5cGUsICfigKIgR2FtZXBhZCcsIGUuZ2FtZXBhZCwgJ+KAoiBCdXR0b24nLCBlLmJ1dHRvbik7XG59KTtcblxuKi9cblxudmFyIERFRkFVTFRTID0ge1xuICBhdXRvc3RhcnQ6IHRydWUsXG4gIGJ1dHRvblRocmVzaG9sZDogMC4xLFxuICBlbWl0RXZlbnRzT25XaW5kb3c6IHRydWUsXG4gIHBvc3RNZXNzYWdlRXZlbnRzT246IG51bGwsXG4gIG1hcHBpbmdzOiB7XG4gICAgJ09jdWx1cyBSZW1vdGUnOiB7XG4gICAgICAnYjAnOiAnY2VudGVyJyxcbiAgICAgICdiMSc6ICdiYWNrJyxcbiAgICAgICdiMic6ICd1cCcsXG4gICAgICAnYjMnOiAnZG93bicsXG4gICAgICAnYjUnOiAncmlnaHQnLFxuICAgICAgJ2I0JzogJ2xlZnQnXG4gICAgfVxuICB9XG59O1xuXG5mdW5jdGlvbiBzbHVnaWZ5IChzdHIpIHtcbiAgcmV0dXJuIChzdHIgfHwgJycpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cXHddL2csICcnKS5yZXBsYWNlKC9cXCguK1xcKS8sICcnKTtcbn1cblxuZnVuY3Rpb24gZm9ybWF0RXZlbnQgKG5hbWUsIGRldGFpbCkge1xuICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQobmFtZSwge2RldGFpbDogZGV0YWlsfSk7XG4gIE9iamVjdC5rZXlzKGRldGFpbCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgZXZlbnRba2V5XSA9IGRldGFpbFtrZXldO1xuICB9KTtcbiAgcmV0dXJuIGV2ZW50O1xufVxuXG5mdW5jdGlvbiBHYW1lcGFkcyAoc2V0dGluZ3MpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnN1cHBvcnRlZCA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgJiYgbmF2aWdhdG9yLmdldEdhbWVwYWRzO1xuXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MgPT09ICdzdHJpbmcnKSB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHtzZWxlY3Q6IHNldHRpbmdzfTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3MgfHwge307XG4gIH1cblxuICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMoKVswXSkge1xuICAgICAgc3RhcnRMb29wKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkY29ubmVjdGVkJywgc3RhcnRMb29wKTtcbiAgICB9XG4gIH07XG5cbiAgdGhpcy5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdnYW1lcGFkY29ubmVjdGVkJywgc3RhcnRMb29wKTtcbiAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5yYWYpO1xuICB9O1xuXG4gIHRoaXMuREVGQVVMVFMgPSBERUZBVUxUUztcblxuICBpZiAodGhpcy5zdXBwb3J0ZWQpIHtcbiAgICB0aGlzLnNldHRpbmdzLm1hcHBpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVFMubWFwcGluZ3MsIHRoaXMuc2V0dGluZ3MubWFwcGluZ3MpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUUywgdGhpcy5zZXR0aW5ncyk7XG5cbiAgICB0aGlzLnN0YXRlID0ge307XG4gICAgdGhpcy5wcmV2aW91c1N0YXRlID0ge307XG5cbiAgICAvLyBJbiBGaXJlZm94IE5pZ2h0bHkgYW5kIENocm9taXVtIGJ1aWxkcywgeW91IG11c3QgZmlyc3QgcXVlcnkgdGhlIFZSXG4gICAgLy8gZGV2aWNlcyBmb3IgR2FtZXBhZHMgdG8gYmUgZXhwb3NlZC5cbiAgICBpZiAobmF2aWdhdG9yLnZyICYmIG5hdmlnYXRvci52ci5nZXREaXNwbGF5cykge1xuICAgICAgbmF2aWdhdG9yLnZyLmdldERpc3BsYXlzKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge30pXG4gICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSkpO1xuICAgIH1cbiAgICBpZiAobmF2aWdhdG9yLmdldFZSRGlzcGxheXMpIHtcbiAgICAgIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge30pXG4gICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNldHRpbmdzLmF1dG9zdGFydCkge1xuICAgICAgdGhpcy5zdGFydCgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGxvb3AgKCkge1xuICAgIHNlbGYucG9sbCgpO1xuICAgIHNlbGYucmFmID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0TG9vcCAoKSB7XG4gICAgc2VsZi5yYWYgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdnYW1lcGFkY29ubmVjdGVkJywgc3RhcnRMb29wKTtcbiAgfVxufVxuXG5HYW1lcGFkcy5wcm90b3R5cGUucG9sbCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoIXRoaXMuc3VwcG9ydGVkKSB7IHJldHVybjsgfVxuICB0aGlzLmdhbWVwYWRzID0gbmF2aWdhdG9yLmdldEdhbWVwYWRzKCk7XG4gIHZhciBncDtcbiAgdmFyIGJ0bjtcbiAgdmFyIGJ0blN0YXRlO1xuICB2YXIgbGVuO1xuICB2YXIgcHJldmlvdXNCdG5TdGF0ZTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IG5hdmlnYXRvci5nZXRHYW1lcGFkcygpLmxlbmd0aDsgKytpKSB7XG4gICAgZ3AgPSBuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMoKVtpXTtcbiAgICBpZiAoIWdwKSB7IGNvbnRpbnVlOyB9XG4gICAgaWYgKHRoaXMuc2VsZWN0ICYmIHRoaXMuc2VsZWN0ICE9PSBncC5pZCkgeyBjb250aW51ZTsgfVxuICAgIHRoaXMuc3RhdGVbZ3AuaWRdID0ge307XG4gICAgaWYgKCF0aGlzLnByZXZpb3VzU3RhdGVbZ3AuaWRdKSB7XG4gICAgICB0aGlzLnByZXZpb3VzU3RhdGVbZ3AuaWRdID0ge307XG4gICAgfVxuICAgIGlmIChncC5idXR0b25zKSB7XG4gICAgICBsZW4gPSBncC5idXR0b25zLmxlbmd0aDtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuOyArK2opIHtcbiAgICAgICAgYnRuID0gZ3AuYnV0dG9uc1tqXTtcblxuICAgICAgICBwcmV2aW91c0J0blN0YXRlID0gdGhpcy5wcmV2aW91c1N0YXRlW2dwLmlkXVsnYicgKyBqXSA9IHRoaXMucHJldmlvdXNTdGF0ZVtncC5pZF1bJ2InICsgal0gfHwge1xuICAgICAgICAgIGdhbWVwYWQ6IHtcbiAgICAgICAgICAgIGluZGV4OiBpLFxuICAgICAgICAgICAgaWQ6IGdwLmlkXG4gICAgICAgICAgfSxcbiAgICAgICAgICBidXR0b246IHtcbiAgICAgICAgICAgIGluZGV4OiBqLFxuICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICBwcmVzc2VkOiBmYWxzZSxcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuYnV0dG9uTmFtZShncCwgaiksXG4gICAgICAgICAgICBjb3VudDogMFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBidG5TdGF0ZSA9IHRoaXMuc3RhdGVbZ3AuaWRdWydiJyArIGpdID0ge1xuICAgICAgICAgIGdhbWVwYWQ6IHtcbiAgICAgICAgICAgIGluZGV4OiBncC5pbmRleCxcbiAgICAgICAgICAgIGlkOiBncC5pZFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYnV0dG9uOiB7XG4gICAgICAgICAgICBpbmRleDogaixcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLmJ1dHRvblZhbHVlKGJ0biksXG4gICAgICAgICAgICBwcmVzc2VkOiB0aGlzLmJ1dHRvblByZXNzZWQoYnRuKSxcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuYnV0dG9uTmFtZShncCwgaiksXG4gICAgICAgICAgICBjb3VudDogcHJldmlvdXNCdG5TdGF0ZS5idXR0b24uY291bnRcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHByZXZpb3VzQnRuU3RhdGUuYnV0dG9uLnZhbHVlICE9PSBidG5TdGF0ZS5idXR0b24udmFsdWUpIHtcbiAgICAgICAgICBlbWl0RXZlbnQoWydnYW1lcGFkLmJ1dHRvbnZhbHVlY2hhbmdlJywgYnRuU3RhdGVdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwcmV2aW91c0J0blN0YXRlLmJ1dHRvbi5wcmVzc2VkICYmIGJ0blN0YXRlLmJ1dHRvbi5wcmVzc2VkKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZVtncC5pZF1bJ2InICsgal0uYnV0dG9uLmNvdW50Kys7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGVbZ3AuaWRdWydiJyArIGpdLmJ1dHRvbi5jb3VudCA+PSA1MCkge1xuICAgICAgICAgICAgZW1pdEV2ZW50KFsnZ2FtZXBhZC5idXR0b25ob2xkJywgYnRuU3RhdGVdKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVbZ3AuaWRdWydiJyArIGpdLmJ1dHRvbi5jb3VudCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFwcmV2aW91c0J0blN0YXRlLmJ1dHRvbi5wcmVzc2VkICYmIGJ0blN0YXRlLmJ1dHRvbi5wcmVzc2VkKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZVtncC5pZF1bJ2InICsgal0uYnV0dG9uLmNvdW50ID0gMDtcbiAgICAgICAgICBlbWl0RXZlbnQoWydnYW1lcGFkLmJ1dHRvbmRvd24nLCBidG5TdGF0ZV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHByZXZpb3VzQnRuU3RhdGUuYnV0dG9uLnByZXNzZWQgJiYgIWJ0blN0YXRlLmJ1dHRvbi5wcmVzc2VkKSB7XG4gICAgICAgICAgZW1pdEV2ZW50KFsnZ2FtZXBhZC5idXR0b251cCcsIGJ0blN0YXRlXSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZVtncC5pZF1bJ2InICsgal0uYnV0dG9uLmNvdW50ID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGVtaXRFdmVudCAoZXZlbnRUb0VtaXQpIHtcbiAgICB2YXIgbmFtZSA9IGV2ZW50VG9FbWl0WzBdO1xuICAgIHZhciBkZXRhaWwgPSBPYmplY3QuYXNzaWduKHt9LCBldmVudFRvRW1pdFsxXSk7XG5cbiAgICBpZiAoZGV0YWlsLmJ1dHRvbiAmJiBkZXRhaWwuYnV0dG9uLmNvdW50KSB7XG4gICAgICAvLyBUT0RPOiBBY3R1YWxseSBzdG9yZSB0aW1lc3RhbXBzIGFuZCBjb21wYXJlLlxuICAgICAgZGV0YWlsLmJ1dHRvbi5zZWNvbmRzID0gTWF0aC5jZWlsKGRldGFpbC5idXR0b24uY291bnQgLyAzMCk7XG4gICAgfVxuXG4gICAgLy8gRW1pdCBgZ2FtZXBhZC5idXR0b25kb3duYCwgZm9yIGV4YW1wbGUuXG4gICAgc2VsZi5lbWl0KGZvcm1hdEV2ZW50KG5hbWUsIGRldGFpbCkpO1xuXG4gICAgbmFtZSArPSAnLicgKyBzZWxmLmdhbWVwYWRTbHVnKGRldGFpbC5nYW1lcGFkKTtcblxuICAgIC8vIEVtaXQgYGdhbWVwYWQuYnV0dG9uZG93bi5vY3VsdXNyZW1vdGVgLCBmb3IgZXhhbXBsZS5cbiAgICBzZWxmLmVtaXQoZm9ybWF0RXZlbnQobmFtZSwgZGV0YWlsKSk7XG5cbiAgICBpZiAoZGV0YWlsLmJ1dHRvbikge1xuICAgICAgLy8gRW1pdCBgZ2FtZXBhZC5idXR0b25kb3duLm9jdWx1c3JlbW90ZS5iMWAsIGZvciBleGFtcGxlLlxuICAgICAgc2VsZi5lbWl0KGZvcm1hdEV2ZW50KG5hbWUgKyAnLmInICsgZGV0YWlsLmJ1dHRvbi5pbmRleCwgZGV0YWlsKSk7XG5cbiAgICAgIGlmIChkZXRhaWwuYnV0dG9uLm5hbWUpIHtcbiAgICAgICAgLy8gRW1pdCBgZ2FtZXBhZC5idXR0b25kb3duLm9jdWx1c3JlbW90ZS5iYWNrYCwgZm9yIGV4YW1wbGUuXG4gICAgICAgIHNlbGYuZW1pdChmb3JtYXRFdmVudChuYW1lICsgJy4nICsgZGV0YWlsLmJ1dHRvbi5uYW1lLCBkZXRhaWwpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0aGlzLnByZXZpb3VzU3RhdGUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0YXRlKTtcbn07XG5cbkdhbWVwYWRzLnByb3RvdHlwZS5idXR0b25WYWx1ZSA9IGZ1bmN0aW9uIChidG4pIHtcbiAgaWYgKCF0aGlzLnN1cHBvcnRlZCkgeyByZXR1cm4gMDsgfVxuICByZXR1cm4gdHlwZW9mIGJ0biA9PT0gJ251bWJlcicgPyBidG4gOiBidG4udmFsdWU7XG59O1xuXG5HYW1lcGFkcy5wcm90b3R5cGUuYnV0dG9uUHJlc3NlZCA9IGZ1bmN0aW9uIChidG4pIHtcbiAgaWYgKCF0aGlzLnN1cHBvcnRlZCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgcmV0dXJuICh0eXBlb2YgYnRuID09PSAnbnVtYmVyJyA/IGJ0biA6IGJ0bi52YWx1ZSkgPiB0aGlzLnNldHRpbmdzLmJ1dHRvblRocmVzaG9sZDtcbn07XG5cbkdhbWVwYWRzLnByb3RvdHlwZS5idXR0b25OYW1lID0gZnVuY3Rpb24gKGdwLCBidG5JbmRleCkge1xuICBpZiAoIXRoaXMuc3VwcG9ydGVkKSB7IHJldHVybjsgfVxuICByZXR1cm4gdGhpcy5zZXR0aW5ncy5tYXBwaW5nc1tncC5pZF0gJiYgdGhpcy5zZXR0aW5ncy5tYXBwaW5nc1tncC5pZF1bJ2InICsgYnRuSW5kZXhdO1xufTtcblxuR2FtZXBhZHMucHJvdG90eXBlLmdhbWVwYWRTbHVnID0gZnVuY3Rpb24gKGdwKSB7XG4gIGlmICghdGhpcy5zdXBwb3J0ZWQpIHsgcmV0dXJuICcnOyB9XG4gIHJldHVybiBzbHVnaWZ5KGdwLmlkKTtcbn07XG5cbkdhbWVwYWRzLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGlmICghdGhpcy5zdXBwb3J0ZWQpIHsgcmV0dXJuOyB9XG4gIGlmICh0aGlzLnNldHRpbmdzLmVtaXRFdmVudHNPbldpbmRvdykge1xuICAgIGNvbnNvbGUubG9nKCdnYW1lcGFkJywgZXZlbnQpO1xuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgfVxuICBpZiAodGhpcy5zZXR0aW5ncy5wb3N0TWVzc2FnZUV2ZW50c09uKSB7XG4gICAgdmFyIGVsID0gdGhpcy5zZXR0aW5ncy5wb3N0TWVzc2FnZUV2ZW50c09uO1xuICAgIGlmICh0eXBlb2YgZWwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zZXR0aW5ncy5wb3N0TWVzc2FnZUV2ZW50c09uKTtcbiAgICB9XG4gICAgaWYgKGVsKSB7XG4gICAgICBlbC5wb3N0TWVzc2FnZSh7dHlwZTogJ2V2ZW50JywgZGF0YToge3R5cGU6IGV2ZW50LnR5cGUsIGRldGFpbDogZXZlbnR9fSwgJyonKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbi8vICAgZGVmaW5lKCdHQU1FUEFEUycsIEdBTUVQQURTKTtcbi8vIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4vLyAgIG1vZHVsZS5leHBvcnRzID0gR0FNRVBBRFM7XG4vLyB9IGVsc2UgaWYgKHdpbmRvdykge1xuLy8gICB3aW5kb3cuR0FNRVBBRFMgPSBHQU1FUEFEUztcbi8vIH1cblxuLy8gJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiB0b0FycmF5IChvYmopIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShvYmopO1xufVxuXG5mdW5jdGlvbiAkIChzZWxlY3RvciwgcGFyZW50KSB7XG4gIHBhcmVudCA9IHBhcmVudCB8fCBkb2N1bWVudDtcbiAgcmV0dXJuIHBhcmVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbn1cblxuZnVuY3Rpb24gJCQgKHNlbGVjdG9yLCBwYXJlbnQpIHtcbiAgcGFyZW50ID0gcGFyZW50IHx8IGRvY3VtZW50O1xuICByZXR1cm4gdG9BcnJheShwYXJlbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xufVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZSkge1xuICBpZiAoZS5rZXlDb2RlID09PSAxMTIpIHsgIC8vIGBQYFxuICAgIHNvdW5kcy50b2dnbGUoKTtcbiAgfVxufSk7XG5cbmZ1bmN0aW9uIFNvdW5kcyAoKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICBzZWxmLm11dGVkID0gZmFsc2U7XG5cbiAgc2VsZi50b2dnbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHNlbGYubXV0ZWQpIHtcbiAgICAgIHNlbGYucGxheSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLnN0b3AoKTtcbiAgICB9XG4gIH07XG5cbiAgc2VsZi5wbGF5RWwgPSBmdW5jdGlvbiAoZWwpIHtcbiAgICBlbC5jb21wb25lbnRzLnNvdW5kLnNvdW5kLmF1dG9wbGF5ID0gZWwuY29tcG9uZW50cy5zb3VuZC5zb3VuZC5fYXV0b3BsYXk7XG4gICAgZWwuY29tcG9uZW50cy5zb3VuZC5zb3VuZC5zcmMgPSBlbC5jb21wb25lbnRzLnNvdW5kLnNvdW5kLl9zcmM7XG4gICAgZWwuY29tcG9uZW50cy5zb3VuZC5wbGF5KCk7XG4gIH07XG5cbiAgc2VsZi5zdG9wRWwgPSBmdW5jdGlvbiAoZWwpIHtcbiAgICBlbC5jb21wb25lbnRzLnNvdW5kLnBhdXNlKCk7XG4gICAgZWwuY29tcG9uZW50cy5zb3VuZC5zb3VuZC5fYXV0b3BsYXkgPSBlbC5jb21wb25lbnRzLnNvdW5kLnNvdW5kLl9hdXRvcGxheTtcbiAgICBlbC5jb21wb25lbnRzLnNvdW5kLnNvdW5kLmF1dG9wbGF5ID0gZmFsc2U7XG4gICAgZWwuY29tcG9uZW50cy5zb3VuZC5zb3VuZC5fc3JjID0gZWwuY29tcG9uZW50cy5zb3VuZC5zb3VuZC5zcmM7XG4gICAgZWwuY29tcG9uZW50cy5zb3VuZC5zb3VuZC5zcmMgPSAnJztcbiAgfTtcblxuICBzZWxmLnBsYXkgPSBmdW5jdGlvbiAoKSB7XG4gICAgc2VsZi5tdXRlZCA9IGZhbHNlO1xuICAgIHNlbGYucmVtZW1iZXIoKTtcbiAgICAkJCgnYS1zY2VuZSBbc291bmRdJykuZm9yRWFjaChzZWxmLnBsYXlFbCk7XG4gIH07XG5cbiAgc2VsZi5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgIHNlbGYubXV0ZWQgPSB0cnVlO1xuICAgIHNlbGYucmVtZW1iZXIoKTtcbiAgICAkJCgnYS1zY2VuZSBbc291bmRdJykuZm9yRWFjaChzZWxmLnN0b3BFbCk7XG4gIH07XG5cbiAgc2VsZi5yZW1lbWJlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgbG9jYWxTdG9yYWdlLmF1ZGlvTXV0ZWQgPSBzZWxmLm11dGVkID8gJ3RydWUnIDogJ2ZhbHNlJztcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgfVxuICB9O1xuXG4gIHNlbGYubXV0ZU9uTG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5hdWRpb011dGVkID09PSAndHJ1ZSc7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG4gIGlmIChzZWxmLm11dGVPbkxvYWQoKSkge1xuICAgIHNlbGYuc3RvcCgpO1xuICB9XG59XG5cbnZhciBzb3VuZHMgPSBuZXcgU291bmRzKCk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbmhvbGQub2N1bHVzcmVtb3RlLmNlbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xufSk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbmhvbGQub2N1bHVzcmVtb3RlLmJhY2snLCBmdW5jdGlvbiAoKSB7XG4gIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gT0NVTFVTX1NFVFRJTkdTLnVybHMucm9vdDtcbn0pO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b25ob2xkLm9jdWx1c3JlbW90ZS5sZWZ0JywgZnVuY3Rpb24gKCkge1xuICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG59KTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9uaG9sZC5vY3VsdXNyZW1vdGUucmlnaHQnLCBmdW5jdGlvbiAoKSB7XG4gIHdpbmRvdy5oaXN0b3J5LmZvcndhcmQoKTtcbn0pO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b25kb3duLm9jdWx1c3RvdWNobGVmdCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgY29uc29sZS5sb2coJ2dhbWVwYWQgb2N1bHVzIHRvdWNoIChsZWZ0KScsIGV2dCk7XG59KTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9uZG93bi5vY3VsdXN0b3VjaHJpZ2h0JywgZnVuY3Rpb24gKGV2dCkge1xuICBjb25zb2xlLmxvZygnZ2FtZXBhZCBvY3VsdXMgdG91Y2ggKHJpZ2h0KScsIGV2dCk7XG59KTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9uZG93bi5vY3VsdXNyZW1vdGUuY2VudGVyJywgZmlyZSgnbW91c2Vkb3duJykpO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9udXAub2N1bHVzcmVtb3RlLmNlbnRlcicsIGZpcmUoJ21vdXNldXAnKSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b251cC5vY3VsdXNyZW1vdGUuY2VudGVyJywgZmlyZSgnY2xpY2snKSk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbmRvd24ub2N1bHVzcmVtb3RlLmNlbnRlcicsIGZpcmUoJ2N1cnNvci1tb3VzZWRvd24nKSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b251cC5vY3VsdXNyZW1vdGUuY2VudGVyJywgZmlyZSgnY3Vyc29yLW1vdXNldXAnKSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b251cC5vY3VsdXNyZW1vdGUuY2VudGVyJywgZmlyZSgnY3Vyc29yLWNsaWNrJykpO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b25kb3duLm9jdWx1c3JlbW90ZS51cCcsIGZpcmVLZXkoJ2Rvd24nLCAndycpKTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbnVwLm9jdWx1c3JlbW90ZS51cCcsIGZpcmVLZXkoJ3VwJywgJ3cnKSk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbmRvd24ub2N1bHVzcmVtb3RlLmxlZnQnLCBmaXJlS2V5KCdkb3duJywgJ2EnKSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZC5idXR0b251cC5vY3VsdXNyZW1vdGUubGVmdCcsIGZpcmVLZXkoJ3VwJywgJ2EnKSk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbmRvd24ub2N1bHVzcmVtb3RlLnJpZ2h0JywgZmlyZUtleSgnZG93bicsICdkJykpO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9udXAub2N1bHVzcmVtb3RlLnJpZ2h0JywgZmlyZUtleSgndXAnLCAnZCcpKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVwYWQuYnV0dG9uZG93bi5vY3VsdXNyZW1vdGUuZG93bicsIGZpcmVLZXkoJ2Rvd24nLCAncycpKTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkLmJ1dHRvbnVwLm9jdWx1c3JlbW90ZS5kb3duJywgZmlyZUtleSgndXAnLCAncycpKTtcblxuZnVuY3Rpb24gZmlyZUtleSAoa2V5RXZlbnROYW1lU3VmZml4LCBrZXkpIHtcbiAgdmFyIGtleVVwcGVyID0ga2V5LnRvVXBwZXJDYXNlKCk7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGUgPSBuZXcgQ3VzdG9tRXZlbnQoJ2tleScgKyBrZXlFdmVudE5hbWVTdWZmaXgsIHtidWJibGVzOiB0cnVlfSk7XG4gICAgZS5rZXlDb2RlID0gZS5rZXkgPSBrZXlVcHBlci5jaGFyQ29kZUF0KDApO1xuICAgIGRvY3VtZW50LmJvZHkuZGlzcGF0Y2hFdmVudChlKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZmlyZSAoZXZlbnROYW1lKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGUgPSBuZXcgQ3VzdG9tRXZlbnQoZXZlbnROYW1lLCB7YnViYmxlczogdHJ1ZX0pO1xuICAgIHZhciB0YXJnZXQgPSAkKCdhLXNjZW5lIGNhbnZhcycpIHx8IGRvY3VtZW50LmJvZHk7XG4gICAgdGFyZ2V0LmRpc3BhdGNoRXZlbnQoZSk7XG4gIH07XG59XG5cbnZhciBHQU1FUEFEUyA9IG5ldyBHYW1lcGFkcyh3aW5kb3cuR0FNRVBBRFNfU0VUVElOR1MpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdBTUVQQURTO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9wdWJsaWMvbGliL2dhbWVwYWRzLmpzXG4vLyBtb2R1bGUgaWQgPSA0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(1);
module.exports = __webpack_require__(2);


/***/ })
/******/ ]);